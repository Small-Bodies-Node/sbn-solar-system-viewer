!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("julian")):"function"==typeof define&&define.amd?define(["exports","three","julian"],t):t((e=e||self).SbnSolarSystemViewer={},e.THREE,e.julian)}(this,(function(e,t,n){"use strict";function r(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var s=e.apply(t,n);function a(e){r(s,o,i,a,c,"next",e)}function c(e){r(s,o,i,a,c,"throw",e)}a(void 0)}))}}function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var c=function(e,t){return function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var o=Object.create((t&&t.prototype instanceof h?t:h).prototype),i=new T(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var a=w(s,n);if(a){if(a===u)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,i),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function h(){}function p(){}function d(){}var f={};f[o]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(x([])));g&&g!==t&&n.call(g,o)&&(f=g);var y=d.prototype=h.prototype=Object.create(f);function b(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){var r;this._invoke=function(o,i){function s(){return new t((function(r,s){!function r(o,i,s,a){var c=l(e[o],e,i);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,a)}))}a(c.arg)}(o,i,r,s)}))}return r=r?r.then(s,s):s()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function x(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:M}}function M(){return{value:void 0,done:!0}}return p.prototype=y.constructor=d,d.constructor=p,p.displayName=a(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(v.prototype),v.prototype[i]=function(){return this},e.AsyncIterator=v,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var s=new v(c(t,n,r,o),i);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},b(y),a(y,s,"Generator"),y[o]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=x,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var a=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:x(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(t={exports:{}}),t.exports}();const l={type:"change"},u={type:"start"},h={type:"end"};class p extends t.EventDispatcher{constructor(e,n){super(),void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=n,this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=Infinity,this.minZoom=0,this.maxZoom=Infinity,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-Infinity,this.maxAzimuthAngle=Infinity,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.touches={ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",z),this._domElementKeyEvents=e},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(l),r.update(),i=o.NONE},this.update=function(){const n=new t.Vector3,u=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),h=u.clone().invert(),m=new t.Vector3,g=new t.Quaternion,y=2*Math.PI;return function(){const e=r.object.position;n.copy(e).sub(r.target),n.applyQuaternion(u),a.setFromVector3(n),r.autoRotate&&i===o.NONE&&M(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(a.theta+=c.theta*r.dampingFactor,a.phi+=c.phi*r.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let t=r.minAzimuthAngle,b=r.maxAzimuthAngle;return isFinite(t)&&isFinite(b)&&(t<-Math.PI?t+=y:t>Math.PI&&(t-=y),b<-Math.PI?b+=y:b>Math.PI&&(b-=y),a.theta=t<=b?Math.max(t,Math.min(b,a.theta)):a.theta>(t+b)/2?Math.max(t,a.theta):Math.min(b,a.theta)),a.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=p,a.radius=Math.max(r.minDistance,Math.min(r.maxDistance,a.radius)),!0===r.enableDamping?r.target.addScaledVector(d,r.dampingFactor):r.target.add(d),n.setFromSpherical(a),n.applyQuaternion(h),e.copy(r.target).add(n),r.object.lookAt(r.target),!0===r.enableDamping?(c.theta*=1-r.dampingFactor,c.phi*=1-r.dampingFactor,d.multiplyScalar(1-r.dampingFactor)):(c.set(0,0,0),d.set(0,0,0)),p=1,!!(f||m.distanceToSquared(r.object.position)>s||8*(1-g.dot(r.object.quaternion))>s)&&(r.dispatchEvent(l),m.copy(r.object.position),g.copy(r.object.quaternion),f=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",Z),r.domElement.removeEventListener("pointerdown",G),r.domElement.removeEventListener("wheel",F),r.domElement.removeEventListener("touchstart",K),r.domElement.removeEventListener("touchend",Y),r.domElement.removeEventListener("touchmove",X),r.domElement.ownerDocument.removeEventListener("pointermove",V),r.domElement.ownerDocument.removeEventListener("pointerup",j),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",z)};const r=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=o.NONE;const s=1e-6,a=new t.Spherical,c=new t.Spherical;let p=1;const d=new t.Vector3;let f=!1;const m=new t.Vector2,g=new t.Vector2,y=new t.Vector2,b=new t.Vector2,v=new t.Vector2,w=new t.Vector2,_=new t.Vector2,E=new t.Vector2,T=new t.Vector2;function x(){return Math.pow(.95,r.zoomSpeed)}function M(e){c.theta-=e}function S(e){c.phi-=e}const A=function(){const e=new t.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),d.add(e)}}(),P=function(){const e=new t.Vector3;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),d.add(e)}}(),L=function(){const e=new t.Vector3;return function(t,n){const o=r.domElement;if(r.object.isPerspectiveCamera){e.copy(r.object.position).sub(r.target);let i=e.length();i*=Math.tan(r.object.fov/2*Math.PI/180),A(2*t*i/o.clientHeight,r.object.matrix),P(2*n*i/o.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(A(t*(r.object.right-r.object.left)/r.object.zoom/o.clientWidth,r.object.matrix),P(n*(r.object.top-r.object.bottom)/r.object.zoom/o.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function R(e){r.object.isPerspectiveCamera?p/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function O(e){r.object.isPerspectiveCamera?p*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function I(e){m.set(e.clientX,e.clientY)}function k(e){b.set(e.clientX,e.clientY)}function N(e){1==e.touches.length?m.set(e.touches[0].pageX,e.touches[0].pageY):m.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY))}function C(e){1==e.touches.length?b.set(e.touches[0].pageX,e.touches[0].pageY):b.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY))}function D(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);_.set(0,r)}function U(e){1==e.touches.length?g.set(e.touches[0].pageX,e.touches[0].pageY):g.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY)),y.subVectors(g,m).multiplyScalar(r.rotateSpeed);const t=r.domElement;M(2*Math.PI*y.x/t.clientHeight),S(2*Math.PI*y.y/t.clientHeight),m.copy(g)}function B(e){1==e.touches.length?v.set(e.touches[0].pageX,e.touches[0].pageY):v.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY)),w.subVectors(v,b).multiplyScalar(r.panSpeed),L(w.x,w.y),b.copy(v)}function H(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);E.set(0,o),T.set(0,Math.pow(E.y/_.y,r.zoomSpeed)),R(T.y),_.copy(E)}function G(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){let n;switch(e.preventDefault(),r.domElement.focus?r.domElement.focus():window.focus(),e.button){case 0:n=r.mouseButtons.LEFT;break;case 1:n=r.mouseButtons.MIDDLE;break;case 2:n=r.mouseButtons.RIGHT;break;default:n=-1}switch(n){case t.MOUSE.DOLLY:if(!1===r.enableZoom)return;!function(e){_.set(e.clientX,e.clientY)}(e),i=o.DOLLY;break;case t.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;k(e),i=o.PAN}else{if(!1===r.enableRotate)return;I(e),i=o.ROTATE}break;case t.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;I(e),i=o.ROTATE}else{if(!1===r.enablePan)return;k(e),i=o.PAN}break;default:i=o.NONE}i!==o.NONE&&(r.domElement.ownerDocument.addEventListener("pointermove",V),r.domElement.ownerDocument.addEventListener("pointerup",j),r.dispatchEvent(u))}(e)}}function V(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1!==r.enabled)switch(e.preventDefault(),i){case o.ROTATE:if(!1===r.enableRotate)return;!function(e){g.set(e.clientX,e.clientY),y.subVectors(g,m).multiplyScalar(r.rotateSpeed);const t=r.domElement;M(2*Math.PI*y.x/t.clientHeight),S(2*Math.PI*y.y/t.clientHeight),m.copy(g),r.update()}(e);break;case o.DOLLY:if(!1===r.enableZoom)return;!function(e){E.set(e.clientX,e.clientY),T.subVectors(E,_),T.y>0?R(x()):T.y<0&&O(x()),_.copy(E),r.update()}(e);break;case o.PAN:if(!1===r.enablePan)return;!function(e){v.set(e.clientX,e.clientY),w.subVectors(v,b).multiplyScalar(r.panSpeed),L(w.x,w.y),b.copy(v),r.update()}(e)}}(e)}}function j(e){switch(e.pointerType){case"mouse":case"pen":r.domElement.ownerDocument.removeEventListener("pointermove",V),r.domElement.ownerDocument.removeEventListener("pointerup",j),!1!==r.enabled&&(r.dispatchEvent(h),i=o.NONE)}}function F(e){!1===r.enabled||!1===r.enableZoom||i!==o.NONE&&i!==o.ROTATE||(e.preventDefault(),r.dispatchEvent(u),function(e){e.deltaY<0?O(x()):e.deltaY>0&&R(x()),r.update()}(e),r.dispatchEvent(h))}function z(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:L(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:L(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:L(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:L(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function K(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(r.touches.ONE){case t.TOUCH.ROTATE:if(!1===r.enableRotate)return;N(e),i=o.TOUCH_ROTATE;break;case t.TOUCH.PAN:if(!1===r.enablePan)return;C(e),i=o.TOUCH_PAN;break;default:i=o.NONE}break;case 2:switch(r.touches.TWO){case t.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&D(e),r.enablePan&&C(e)}(e),i=o.TOUCH_DOLLY_PAN;break;case t.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&D(e),r.enableRotate&&N(e)}(e),i=o.TOUCH_DOLLY_ROTATE;break;default:i=o.NONE}break;default:i=o.NONE}i!==o.NONE&&r.dispatchEvent(u)}}function X(e){if(!1!==r.enabled)switch(e.preventDefault(),i){case o.TOUCH_ROTATE:if(!1===r.enableRotate)return;U(e),r.update();break;case o.TOUCH_PAN:if(!1===r.enablePan)return;B(e),r.update();break;case o.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&H(e),r.enablePan&&B(e)}(e),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&H(e),r.enableRotate&&U(e)}(e),r.update();break;default:i=o.NONE}}function Y(e){!1!==r.enabled&&(r.dispatchEvent(h),i=o.NONE)}function Z(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",Z),r.domElement.addEventListener("pointerdown",G),r.domElement.addEventListener("wheel",F,{passive:!1}),r.domElement.addEventListener("touchstart",K,{passive:!1}),r.domElement.addEventListener("touchend",Y),r.domElement.addEventListener("touchmove",X,{passive:!1}),this.update()}}function d(e){return"\n\n   ______________________________    . \\  | / .\n  /                            / \\     \\ \\ / /\n |                            | ==========  - -\n  \\____________________________\\_/     / / \\ \\\n  ______________________________      \\  | / | \\\n /                            / \\     \\ \\ / /.   .\n|                            | ==========  - -\n \\____________________________\\_/     / / \\ \\    /\n   ______________________________   / |\\  | /  .\n  /                            / \\     \\ \\ / /\n |                            | ==========  -  - -\n  \\____________________________\\_/     / / \\ \\\n                                     .  / | \\  .\n\n  Are you trying to wreak havoc on the Universe!?!\n\n  "+e+"\n\n  Idiot.\n\n  "}function f(e){return 149597870700*e}var m,g,y=0,b=function(){return"sbn-solar-system-viewer-"+ ++y},v="loader-div-id-"+b(),w=!1,_=function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,[" >>> ",+new Date-+Rt()," >>> "].concat(n))},E=f(1e-5),T=f(3e3),x=function(){function e(e){var n=this;if(this._containerId=e,this._scene=new t.Scene,this._canvas=document.createElement("canvas"),this._clock=new t.Clock(!1),this._initialViewingVector=new t.Vector3,this._isSceneReady=!1,this._isRendering=!1,this._isHelpersShown=!1,this._isInit=!1,this._isLoaderVisible=!0,this._fps=60,this._camera=new t.PerspectiveCamera(60,2,E,T),this._sceneEntities=[],this._preInitHook=function(){},this._postInitHook=function(){},this._destroyHook=function(){},this.updateCamera=function(){},this.registerSceneEntities=function(e){e.forEach((function(e){return n._sceneEntities.push(e)}))},this.setHelpersVisibility=function(e){n._isHelpersShown=!!e,n._scene.traverse((function(e){return e.userData.isHelper&&(e.visible=n._isHelpersShown)}))},this.toggleHelpersVisibility=function(){n._isHelpersShown=!n._isHelpersShown,n.setHelpersVisibility(n._isHelpersShown)},this._updateCameraAspect=function(){n._canvas.style.width="100%",n._canvas.style.height="100%";var e=n._canvas.offsetWidth||1,t=n._canvas.offsetHeight||1;n._camera.aspect=e/t,n._camera.updateProjectionMatrix(),n._renderer.setSize(e,t)},this.destroy=function(){window.removeEventListener("resize",n._updateCameraAspect),n._stopRendering(),n._destroyHook()},this._render=function(){n._isRendering&&setTimeout((function(){n._requestAnimationFrameId=requestAnimationFrame(n._render),n._update()}),1e3/n._fps)},this._startRendering=function(){_("Starting animation..."),n._isRendering=!0,n._clock.start(),n._render()},this._stopRendering=function(){_("Stopping animation..."),n._isRendering=!1,n._clock.stop()},this._container=document.getElementById(this._containerId),!this._container)throw new Error("No container found with id: "+this._containerId);this._canvas.style.width="100%",this._canvas.style.height="100%",this._container.append(this._canvas),this._container.style.setProperty("position","relative"),this._container.style.setProperty("font-family",'"Odibee Sans", cursive'),this._container.style.setProperty("background-color","black"),function(e){if(!w){w=!0;var t=document.createElement("div"),n=document.createElement("div");e.append(t),t.append(n),t.id=v,t.style.setProperty("position","absolute"),t.style.setProperty("top","0px"),t.style.setProperty("left","0px"),t.style.setProperty("bottom","0px"),t.style.setProperty("right","0px"),t.style.setProperty("display","flex"),t.style.setProperty("align-items","center"),t.style.setProperty("justify-content","center"),t.style.setProperty("pointer-events","none");var r=t.offsetWidth,o=t.offsetHeight,i=r<o?r:o;n.style.setProperty("width",.25*i+"px"),n.style.setProperty("height",.25*i+"px"),n.style.setProperty("border","5px solid #f3f3f3"),n.style.setProperty("border-top","5px solid #3498db"),n.style.setProperty("border-radius","100px"),n.style.setProperty("animation","sbn-solar-system-viewer-loader-spin 2000ms linear infinite")}}(this._container)}var n=e.prototype;return n.init=function(){var e=o(c.mark((function e(){var n,r=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isInit){e.next=2;break}return e.abrupt("return");case 2:if(this._isInit=!0,Lt(new Date),this._preInitHook(),window.addEventListener("resize",this._updateCameraAspect),n=window.devicePixelRatio?window.devicePixelRatio:1,this._renderer=new t.WebGLRenderer({canvas:this._canvas,antialias:!0,alpha:!0}),this._renderer.setPixelRatio(n),this._renderer.sortObjects=!1,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=t.PCFSoftShadowMap,this._renderer.outputEncoding=t.GammaEncoding,this._camera.position.copy(this._initialViewingVector),this._camera.up=new t.Vector3(0,0,1),this._camera.lookAt(0,0,0),this._controls=new p(this._camera,this._renderer.domElement),this._controls.enableDamping=!0,this._controls.dampingFactor=.25,this._controls.target=new t.Vector3,this._sceneEntities.length){e.next=22;break}throw new Error(d("You have no scene entities!"));case 22:return e.next=24,Promise.all(this._sceneEntities.map(function(){var e=o(c.mark((function e(t){var n;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.init();case 2:if((n=e.sent)&&n.children.length){e.next=5;break}throw new Error(d('\n            -----------------------------------------------------------------------------\n            The scene entity "'+t.constructor.name+'" has empty sceneEntityGroup\n            after initialization!!!\n            -----------------------------------------------------------------------------\n            '));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return new Promise((function(t){return setTimeout((function(){return t(e)}),100)}))})).then((function(e){return e}));case 24:e.sent.forEach((function(e){return r._scene.add(e)})),this.setHelpersVisibility(!1),this._updateCameraAspect(),this._startRendering(),this._postInitHook(),this.setIsLoaderDivVisible(!1),_("Finished initiating scene.");case 32:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.setIsLoaderDivVisible=function(e,t){void 0===t&&(t=3e3),this._isLoaderVisible=e,function(e,t){void 0===t&&(t=3e3);var n=document.getElementById(v);null==n||n.style.setProperty("transition","opacity "+t+"ms ease-in-out"),null==n||n.style.setProperty("opacity",""+(e?1:0))}(this._isLoaderVisible,t)},n.setFramesPerSecond=function(e){e<=0||e>100||(this._fps=e)},n._update=function(){var e=this;if(this._sceneEntities.forEach((function(t){return t.update(e._camera,e._clock.elapsedTime)})),this.updateCamera(),!this._camera||!this._renderer)throw new Error("Poor Logic");this._requestAnimationFrameId&&this._renderer.render(this._scene,this._camera)},e}(),M=function(e,n){return new Promise((function(r,o){(new t.TextureLoader).load(e,(function(e){e.encoding=t.GammaEncoding,setTimeout((function(){return r(e)}),5)}),(function(e){return console.log(n+" "+e.loaded/e.total*100+"%")}),(function(){console.log("Failed to load: ",e),o(new Error("Failed to load: "+e))}))}))},S={SUN:{radiusMeters:696342e3,periodDays:void 0},MERCURY:{radiusMeters:2439700,periodDays:87.9691},VENUS:{radiusMeters:6051800,periodDays:224.701},EARTH:{radiusMeters:6378e3,periodDays:365.256},MARS:{radiusMeters:3389500,periodDays:686.971},CERES:{radiusMeters:47e4,periodDays:1683.14570801},JUPITER:{radiusMeters:71492e3,periodDays:4332.59},SATURN:{radiusMeters:60268e3,periodDays:10759.22},URANUS:{radiusMeters:25362e3,periodDays:30688.5},NEPTUNE:{radiusMeters:24764e3,periodDays:60182},PLUTO:{radiusMeters:1188300,periodDays:90560},HAUMEA:{radiusMeters:62e4,periodDays:103410},MAKEMAKE:{radiusMeters:72e4,periodDays:111845},ERIS:{radiusMeters:1163e3,periodDays:204199},MOON:{radiusMeters:35e4,periodDays:29.5}},A={__sbnViewer__isPlanetsLoadedBeforeAnimationBegins:!0,__sbnViewer__isBeltLoadedBeforeAnimationBegins:!0,__sbnViewer__isBeltAbundanceToyModel:!0,__sbnViewer__beltAbundanceMaxObjects:100,__sbnViewer__beltAbundanceHThreshold:-10};m=Object.keys(A),g=i({},localStorage),Object.keys(g).forEach((function(e){m.includes(e)||localStorage.removeItem(e)})),m.forEach((function(e){var t=localStorage.getItem(e);if(t)try{typeof JSON.parse(t)!=typeof A[e]&&localStorage.setItem(e,JSON.stringify(A[e]))}catch(e){return void console.log("Local-storage mishap")}else localStorage.setItem(e,JSON.stringify(A[e]))}));var P=function(){var e={};return Object.keys(A).forEach((function(t){var n=localStorage.getItem(t);if(n)try{var r=JSON.parse(n);e[t]=r}catch(e){return}})),i({},A,e)},L=function e(){var n=this;this._isAsyncLoad=function(){return e._isAsyncLoad},this._sceneEntityGroup=new t.Group,this.getSceneEntityGroup=function(){return n._sceneEntityGroup}};L._isAsyncLoad=P().__sbnViewer__isPlanetsLoadedBeforeAnimationBegins;var R=function(e){function n(n){var r;return(r=e.call(this)||this)._toyScale=n,r._toyGroup=[],r._realScale=1,r._isZoomToToyScale=!1,r.isLogScale=!1,r.logTransitionClock=new t.Clock,r}s(n,e);var r=n.prototype;return r.setIsZoomToToyScale=function(e){this._isZoomToToyScale=e},r.setToyScale=function(e){this._toyScale=e},r.getScale=function(){return this._isZoomToToyScale?this._toyScale:this._realScale},r._setToToyScale=function(){var e=this;this._isZoomToToyScale=!0,this._toyGroup.forEach((function(t){var n=e._toyScale;t.scale.set(n,n,n)}))},r.setIsLogScale=function(e){this.isLogScale=e,this.logTransitionClock=new t.Clock(!0),this.logTransitionClock.start(),this.setToyScale(this.isLogScale?1e3:3e3)},r.toggleIsLogScale=function(){this.setIsLogScale(!this.isLogScale)},r.getLogInterpolationParam=function(){var e=this.logTransitionClock.getElapsedTime()/2,t=e<1?e:1;return this.isLogScale?t:1-t},r._updateModelScale=function(){var e=this;this._toyGroup.forEach((function(t){var n=e._isZoomToToyScale?e._toyScale:e._realScale,r=t.scale,o=r.x,i=r.y,s=r.z;if(o!==n){var a=e._toyScale/20;o<n&&t.scale.set(o+a,i+a,s+a),o>n&&t.scale.set(o-a,i-a,s-a),Math.abs(o-n)<a&&t.scale.set(n,n,n)}}))},n}(L),O=I();function I(){return"https://sbn-solar-system-viewer.s3.amazonaws.com"}var k,N=f(1),C=function(e){function n(){var n;return(n=e.call(this,30)||this).NAME="SUN",n.position=new t.Vector3(0,0,0),n.sunRadiusMeters=S.SUN.radiusMeters,n.model=new t.Group,n.sprite=new t.Sprite(new t.SpriteMaterial({blending:t.AdditiveBlending,transparent:!0,visible:!1})),n.getRadius=function(){return n.sunRadiusMeters},n.getPosition=function(){return n.position},n.sprite.scale.multiplyScalar(20*n.sunRadiusMeters),n.model.add(n.sprite),n.helper=new t.LineSegments(new t.EdgesGeometry(new t.SphereGeometry(n.sunRadiusMeters,32)),new t.LineBasicMaterial({color:new t.Color("cyan")})),n.helper.userData.isHelper=!0,n.helper.rotateX(Math.PI/2),n.model.add(n.helper),n}s(n,e);var r=n.prototype;return r.init=function(){var e=o(c.mark((function e(){var t=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=o(c.mark((function e(n){var r,o;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O+"/stars/sun3-sprite-512.png",o=function(e){t.sprite.material.map=e,t.sprite.material.needsUpdate=!0,t.sprite.material.visible=!0},!t._isAsyncLoad()){e.next=6;break}M(r,"SUN SPRITE IMAGE").then(o).catch((function(e){return null})),e.next=11;break;case 6:return e.t0=o,e.next=9,M(r).catch((function(e){return null}));case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:t._toyGroup.push(t.model),t._sceneEntityGroup.name=t.NAME,t._sceneEntityGroup.add(t.model),_("RESOLVED SUN"),n(t._sceneEntityGroup);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.update=function(){this._updateModelScale()},n}(R);!function(e){e.PLANET="PLANET",e.DWARF_PLANET="DWARF_PLANET",e.SUN="SUN",e.ASTEROID="ASTEROID"}(k||(k={}));class D extends t.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new V(e)})),this.register((function(e){return new F(e)})),this.register((function(e){return new z(e)})),this.register((function(e){return new j(e)})),this.register((function(e){return new H(e)})),this.register((function(e){return new K(e)}))}load(e,n,r,o){const i=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:t.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){o?o(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},c=new t.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,(function(t){try{i.parse(t,s,(function(t){n(t),i.manager.itemEnd(e)}),a)}catch(e){a(e)}}),r,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,r,o){let i;const s={},a={};if("string"==typeof e)i=e;else if(t.LoaderUtils.decodeText(new Uint8Array(e,0,4))===X){try{s[B.KHR_BINARY_GLTF]=new Y(e)}catch(e){return void(o&&o(e))}i=s[B.KHR_BINARY_GLTF].content}else i=t.LoaderUtils.decodeText(new Uint8Array(e));const c=JSON.parse(i);if(void 0===c.asset||c.asset.version[0]<2)return void(o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new fe(c,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);a[t.name]=t,s[t.name]=!0}if(c.extensionsUsed)for(let e=0;e<c.extensionsUsed.length;++e){const t=c.extensionsUsed[e],n=c.extensionsRequired||[];switch(t){case B.KHR_MATERIALS_UNLIT:s[t]=new G;break;case B.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[t]=new J;break;case B.KHR_DRACO_MESH_COMPRESSION:s[t]=new Z(c,this.dracoLoader);break;case B.KHR_TEXTURE_TRANSFORM:s[t]=new q;break;case B.KHR_MESH_QUANTIZATION:s[t]=new Q;break;default:n.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(a),l.parse(r,o)}}function U(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const B={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class H{constructor(e){this.parser=e,this.name=B.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const n=this.parser,r="light:"+e;let o=n.cache.get(r);if(o)return o;const i=n.json,s=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let a;const c=new t.Color(16777215);void 0!==s.color&&c.fromArray(s.color);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new t.DirectionalLight(c),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new t.PointLight(c),a.distance=l;break;case"spot":a=new t.SpotLight(c),a.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,void 0!==s.intensity&&(a.intensity=s.intensity),a.name=n.createUniqueName(s.name||"light_"+e),o=Promise.resolve(a),n.cache.add(r,o),o}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then((function(e){return n._getNodeRef(t.cache,o,e)}))}}class G{constructor(){this.name=B.KHR_MATERIALS_UNLIT}getMaterialType(){return t.MeshBasicMaterial}extendParams(e,n,r){const o=[];e.color=new t.Color(1,1,1),e.opacity=1;const i=n.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==i.baseColorTexture&&o.push(r.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(o)}}class V{constructor(e){this.parser=e,this.name=B.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,n){const r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],s=o.extensions[this.name];if(void 0!==s.clearcoatFactor&&(n.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&i.push(r.assignTexture(n,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(n.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&i.push(r.assignTexture(n,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(i.push(r.assignTexture(n,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new t.Vector2(e,-e)}return Promise.all(i)}}class j{constructor(e){this.parser=e,this.name=B.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],i=r.extensions[this.name];return void 0!==i.transmissionFactor&&(t.transmission=i.transmissionFactor),void 0!==i.transmissionTexture&&o.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(o)}}class F{constructor(e){this.parser=e,this.name=B.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const o=n.images[r.extensions[this.name].source],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,i)}}class z{constructor(e){this.parser=e,this.name=B.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;const i=r.images[o.extensions[t].source];let s=n.textureLoader;if(i.uri){const e=n.options.manager.getHandler(i.uri);null!==e&&(s=e)}return this.detectSupport().then((function(o){if(o)return n.loadTextureImage(e,i,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class K{constructor(e){this.name=B.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,o.ready]).then((function(t){const n=e.byteOffset||0,r=e.byteLength||0,i=e.count,s=e.byteStride,a=new ArrayBuffer(i*s),c=new Uint8Array(t[0],n,r);return o.decodeGltfBuffer(new Uint8Array(a),i,s,c,e.mode,e.filter),a}))}return null}}const X="glTF";class Y{constructor(e){this.name=B.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,12);if(this.header={magic:t.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==X)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,o=new DataView(e,12);let i=0;for(;i<r;){const n=o.getUint32(i,!0);i+=4;const r=o.getUint32(i,!0);if(i+=4,1313821514===r){const r=new Uint8Array(e,12+i,n);this.content=t.LoaderUtils.decodeText(r)}else if(5130562===r){const t=12+i;this.body=e.slice(t,t+n)}i+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Z{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=B.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,s={},a={},c={};for(const e in i){const t=oe[e]||e.toLowerCase();s[t]=i[e]}for(const t in e.attributes){const r=oe[t]||t.toLowerCase();if(void 0!==i[t]){const o=n.accessors[e.attributes[t]];c[r]=ee[o.componentType],a[r]=!0===o.normalized}}return t.getDependency("bufferView",o).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],r=a[t];void 0!==r&&(n.normalized=r)}t(e)}),s,c)}))}))}}class q{constructor(){this.name=B.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e}}class W extends t.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const n=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new t.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(const t in a)e.uniforms[t]=a[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",n).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class J{constructor(){this.name=B.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return W}extendParams(e,n,r){const o=n.extensions[this.name];e.color=new t.Color(1,1,1),e.opacity=1;const i=[];if(Array.isArray(o.diffuseFactor)){const t=o.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==o.diffuseTexture&&i.push(r.assignTexture(e,"map",o.diffuseTexture)),e.emissive=new t.Color(0,0,0),e.glossiness=void 0!==o.glossinessFactor?o.glossinessFactor:1,e.specular=new t.Color(1,1,1),Array.isArray(o.specularFactor)&&e.specular.fromArray(o.specularFactor),void 0!==o.specularGlossinessTexture){const t=o.specularGlossinessTexture;i.push(r.assignTexture(e,"glossinessMap",t)),i.push(r.assignTexture(e,"specularMap",t))}return Promise.all(i)}createMaterial(e){const n=new W(e);return n.fog=!0,n.color=e.color,n.map=void 0===e.map?null:e.map,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=void 0===e.aoMap?null:e.aoMap,n.aoMapIntensity=1,n.emissive=e.emissive,n.emissiveIntensity=1,n.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,n.bumpMap=void 0===e.bumpMap?null:e.bumpMap,n.bumpScale=1,n.normalMap=void 0===e.normalMap?null:e.normalMap,n.normalMapType=t.TangentSpaceNormalMap,e.normalScale&&(n.normalScale=e.normalScale),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=void 0===e.specularMap?null:e.specularMap,n.specular=e.specular,n.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,n.glossiness=e.glossiness,n.alphaMap=null,n.envMap=void 0===e.envMap?null:e.envMap,n.envMapIntensity=1,n.refractionRatio=.98,n}}class Q{constructor(){this.name=B.KHR_MESH_QUANTIZATION}}class $ extends t.Interpolant{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[o+e];return t}}$.prototype.beforeStart_=$.prototype.copySampleValue_,$.prototype.afterEnd_=$.prototype.copySampleValue_,$.prototype.interpolate_=function(e,t,n,r){const o=this.resultBuffer,i=this.sampleValues,s=this.valueSize,a=2*s,c=3*s,l=r-t,u=(n-t)/l,h=u*u,p=h*u,d=e*c,f=d-c,m=-2*p+3*h,g=p-h,y=1-m,b=g-h+u;for(let e=0;e!==s;e++)o[e]=y*i[f+e+s]+b*(i[f+e+a]*l)+m*i[d+e+s]+g*(i[d+e]*l);return o};const ee={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},te={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},ne={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},re={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},oe={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ie={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},se={CUBICSPLINE:void 0,LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete};function ae(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function ce(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function le(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function ue(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function he(e){const t=e.extensions&&e.extensions[B.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+pe(t.attributes):e.indices+":"+pe(e.attributes)+":"+e.mode,n}function pe(e){let t="";const n=Object.keys(e).sort();for(let r=0,o=n.length;r<o;r++)t+=n[r]+":"+e[n[r]]+";";return t}function de(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class fe{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new U,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},this.textureLoader="undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?new t.ImageBitmapLoader(this.options.manager):new t.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new t.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const i={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};ce(o,i,r),le(i,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(i)}))).then((function(){e(i)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n].joints;for(let t=0,n=r.length;t<n;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(n[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone();return r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const o=e(t[r]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[B.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,o){n.load(ae(t.uri,r.path),e,void 0,(function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteOffset||0;return e.slice(n,n+(t.byteLength||0))}))}loadAccessor(e){const n=this,r=this.json,o=this.json.accessors[e];if(void 0===o.bufferView&&void 0===o.sparse)return Promise.resolve(null);const i=[];return i.push(void 0!==o.bufferView?this.getDependency("bufferView",o.bufferView):null),void 0!==o.sparse&&(i.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(i).then((function(e){const i=e[0],s=re[o.type],a=ee[o.componentType],c=a.BYTES_PER_ELEMENT,l=o.byteOffset||0,u=void 0!==o.bufferView?r.bufferViews[o.bufferView].byteStride:void 0,h=!0===o.normalized;let p,d;if(u&&u!==c*s){const e=Math.floor(l/u),r="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+e+":"+o.count;let f=n.cache.get(r);f||(p=new a(i,e*u,o.count*u/c),f=new t.InterleavedBuffer(p,u/c),n.cache.add(r,f)),d=new t.InterleavedBufferAttribute(f,s,l%u/c,h)}else p=null===i?new a(o.count*s):new a(i,l,o.count*s),d=new t.BufferAttribute(p,s,h);if(void 0!==o.sparse){const n=o.sparse.values.byteOffset||0,r=new(0,ee[o.sparse.indices.componentType])(e[1],o.sparse.indices.byteOffset||0,o.sparse.count*re.SCALAR),c=new a(e[2],n,o.sparse.count*s);null!==i&&(d=new t.BufferAttribute(d.array.slice(),d.itemSize,d.normalized));for(let e=0,t=r.length;e<t;e++){const t=r[e];if(d.setX(t,c[e*s]),s>=2&&d.setY(t,c[e*s+1]),s>=3&&d.setZ(t,c[e*s+2]),s>=4&&d.setW(t,c[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d}))}loadTexture(e){const t=this.json,n=t.images[t.textures[e].source];let r=this.textureLoader;if(n.uri){const e=this.options.manager.getHandler(n.uri);null!==e&&(r=e)}return this.loadTextureImage(e,n,r)}loadTextureImage(e,n,r){const o=this,i=this.json,s=this.options,a=i.textures[e],c=self.URL||self.webkitURL;let l=n.uri,u=!1,h=!0;if("image/jpeg"===n.mimeType&&(h=!1),void 0!==n.bufferView)l=o.getDependency("bufferView",n.bufferView).then((function(e){if("image/png"===n.mimeType){const t=new DataView(e,25,1).getUint8(0,!1);h=6===t||4===t||3===t}u=!0;const t=new Blob([e],{type:n.mimeType});return l=c.createObjectURL(t),l}));else if(void 0===n.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");return Promise.resolve(l).then((function(e){return new Promise((function(n,o){let i=n;!0===r.isImageBitmapLoader&&(i=function(e){n(new t.CanvasTexture(e))}),r.load(ae(e,s.path),i,void 0,o)}))})).then((function(n){!0===u&&c.revokeObjectURL(l),n.flipY=!1,a.name&&(n.name=a.name),h||(n.format=t.RGBFormat);const r=(i.samplers||{})[a.sampler]||{};return n.magFilter=te[r.magFilter]||t.LinearFilter,n.minFilter=te[r.minFilter]||t.LinearMipmapLinearFilter,n.wrapS=ne[r.wrapS]||t.RepeatWrapping,n.wrapT=ne[r.wrapT]||t.RepeatWrapping,o.associations.set(n,{type:"textures",index:e}),n}))}assignTexture(e,t,n){const r=this;return this.getDependency("texture",n.index).then((function(o){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[B.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[B.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(o);o=r.extensions[B.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),r.associations.set(o,t)}}e[t]=o}))}assignFinalMaterial(e){const n=e.geometry;let r=e.material;const o=void 0!==n.attributes.tangent,i=void 0!==n.attributes.color,s=void 0===n.attributes.normal,a=!0===e.isSkinnedMesh,c=Object.keys(n.morphAttributes).length>0,l=c&&void 0!==n.morphAttributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let n=this.cache.get(e);n||(n=new t.PointsMaterial,t.Material.prototype.copy.call(n,r),n.color.copy(r.color),n.map=r.map,n.sizeAttenuation=!1,this.cache.add(e,n)),r=n}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let n=this.cache.get(e);n||(n=new t.LineBasicMaterial,t.Material.prototype.copy.call(n,r),n.color.copy(r.color),this.cache.add(e,n)),r=n}if(o||i||s||a||c){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),a&&(e+="skinning:"),o&&(e+="vertex-tangents:"),i&&(e+="vertex-colors:"),s&&(e+="flat-shading:"),c&&(e+="morph-targets:"),l&&(e+="morph-normals:");let t=this.cache.get(e);t||(t=r.clone(),a&&(t.skinning=!0),i&&(t.vertexColors=!0),s&&(t.flatShading=!0),c&&(t.morphTargets=!0),l&&(t.morphNormals=!0),o&&(t.vertexTangents=!0,t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===n.attributes.uv2&&void 0!==n.attributes.uv&&n.setAttribute("uv2",n.attributes.uv),e.material=r}getMaterialType(){return t.MeshStandardMaterial}loadMaterial(e){const n=this,r=this.extensions,o=this.json.materials[e];let i;const s={},a=o.extensions||{},c=[];if(a[B.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=r[B.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=e.getMaterialType(),c.push(e.extendParams(s,o,n))}else if(a[B.KHR_MATERIALS_UNLIT]){const e=r[B.KHR_MATERIALS_UNLIT];i=e.getMaterialType(),c.push(e.extendParams(s,o,n))}else{const r=o.pbrMetallicRoughness||{};if(s.color=new t.Color(1,1,1),s.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;s.color.fromArray(e),s.opacity=e[3]}void 0!==r.baseColorTexture&&c.push(n.assignTexture(s,"map",r.baseColorTexture)),s.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,s.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(c.push(n.assignTexture(s,"metalnessMap",r.metallicRoughnessTexture)),c.push(n.assignTexture(s,"roughnessMap",r.metallicRoughnessTexture))),i=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)}))))}!0===o.doubleSided&&(s.side=t.DoubleSide);const l=o.alphaMode||"OPAQUE";return"BLEND"===l?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,"MASK"===l&&(s.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&i!==t.MeshBasicMaterial&&(c.push(n.assignTexture(s,"normalMap",o.normalTexture)),s.normalScale=new t.Vector2(1,-1),void 0!==o.normalTexture.scale&&s.normalScale.set(o.normalTexture.scale,-o.normalTexture.scale)),void 0!==o.occlusionTexture&&i!==t.MeshBasicMaterial&&(c.push(n.assignTexture(s,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(s.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&i!==t.MeshBasicMaterial&&(s.emissive=(new t.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&i!==t.MeshBasicMaterial&&c.push(n.assignTexture(s,"emissiveMap",o.emissiveTexture)),Promise.all(c).then((function(){let a;return a=i===W?r[B.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new i(s),o.name&&(a.name=o.name),a.map&&(a.map.encoding=t.sRGBEncoding),a.emissiveMap&&(a.emissiveMap.encoding=t.sRGBEncoding),le(a,o),n.associations.set(a,{type:"materials",index:e}),o.extensions&&ce(r,a,o),a}))}createUniqueName(e){const n=t.PropertyBinding.sanitizeNodeName(e||"");let r=n;for(let e=1;this.nodeNamesUsed[r];++e)r=n+"_"+e;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){const n=this,r=this.extensions,o=this.primitiveCache;function i(e){return r[B.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,n).then((function(t){return ge(t,e,n)}))}const s=[];for(let r=0,a=e.length;r<a;r++){const a=e[r],c=he(a),l=o[c];if(l)s.push(l.promise);else{let e;e=a.extensions&&a.extensions[B.KHR_DRACO_MESH_COMPRESSION]?i(a):ge(new t.BufferGeometry,a,n),o[c]={primitive:a,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const n=this,r=this.extensions,o=this.json.meshes[e],i=o.primitives,s=[];for(let e=0,n=i.length;e<n;e++){const n=void 0===i[e].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new t.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:t.FrontSide})),a.DefaultMaterial):this.getDependency("material",i[e].material);s.push(n)}var a;return s.push(n.loadGeometries(i)),Promise.all(s).then((function(s){const a=s.slice(0,s.length-1),c=s[s.length-1],l=[];for(let s=0,u=c.length;s<u;s++){const u=c[s],h=i[s];let p;const d=a[s];if(4===h.mode||5===h.mode||6===h.mode||void 0===h.mode)p=!0===o.isSkinnedMesh?new t.SkinnedMesh(u,d):new t.Mesh(u,d),!0!==p.isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),5===h.mode?p.geometry=ye(p.geometry,t.TriangleStripDrawMode):6===h.mode&&(p.geometry=ye(p.geometry,t.TriangleFanDrawMode));else if(1===h.mode)p=new t.LineSegments(u,d);else if(3===h.mode)p=new t.Line(u,d);else if(2===h.mode)p=new t.LineLoop(u,d);else{if(0!==h.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);p=new t.Points(u,d)}Object.keys(p.geometry.morphAttributes).length>0&&ue(p,o),p.name=n.createUniqueName(o.name||"mesh_"+e),le(p,o),h.extensions&&ce(r,p,h),n.assignFinalMaterial(p),l.push(p)}if(1===l.length)return l[0];const u=new t.Group;for(let e=0,t=l.length;e<t;e++)u.add(l[e]);return u}))}loadCamera(e){let n;const r=this.json.cameras[e],o=r[r.type];if(o)return"perspective"===r.type?n=new t.PerspectiveCamera(t.MathUtils.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):"orthographic"===r.type&&(n=new t.OrthographicCamera(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),r.name&&(n.name=this.createUniqueName(r.name)),le(n,r),Promise.resolve(n);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const n=this.json.animations[e],r=[],o=[],i=[],s=[],a=[];for(let e=0,t=n.channels.length;e<t;e++){const t=n.channels[e],c=n.samplers[t.sampler],l=t.target,u=void 0!==n.parameters?n.parameters[c.input]:c.input,h=void 0!==n.parameters?n.parameters[c.output]:c.output;r.push(this.getDependency("node",void 0!==l.node?l.node:l.id)),o.push(this.getDependency("accessor",u)),i.push(this.getDependency("accessor",h)),s.push(c),a.push(l)}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(i),Promise.all(s),Promise.all(a)]).then((function(r){const o=r[0],i=r[1],s=r[2],a=r[3],c=r[4],l=[];for(let e=0,n=o.length;e<n;e++){const n=o[e],r=i[e],u=s[e],h=a[e],p=c[e];if(void 0===n)continue;let d;switch(n.updateMatrix(),n.matrixAutoUpdate=!0,ie[p.path]){case ie.weights:d=t.NumberKeyframeTrack;break;case ie.rotation:d=t.QuaternionKeyframeTrack;break;case ie.position:case ie.scale:default:d=t.VectorKeyframeTrack}const f=n.name?n.name:n.uuid,m=void 0!==h.interpolation?se[h.interpolation]:t.InterpolateLinear,g=[];ie[p.path]===ie.weights?n.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(f);let y=u.array;if(u.normalized){const e=de(y.constructor),t=new Float32Array(y.length);for(let n=0,r=y.length;n<r;n++)t[n]=y[n]*e;y=t}for(let e=0,t=g.length;e<t;e++){const t=new d(g[e]+"."+ie[p.path],r.array,y,m);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){return new $(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(t)}}return new t.AnimationClip(n.name?n.name:"animation_"+e,void 0,l)}))}createNodeMesh(e){const t=this,n=this.json.nodes[e];return void 0===n.mesh?null:t.getDependency("mesh",n.mesh).then((function(e){const r=t._getNodeRef(t.meshCache,n.mesh,e);return void 0!==n.weights&&r.traverse((function(e){if(e.isMesh)for(let t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t]})),r}))}loadNode(e){const n=this.extensions,r=this,o=this.json.nodes[e],i=o.name?r.createUniqueName(o.name):"";return function(){const t=[],n=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==o.camera&&t.push(r.getDependency("camera",o.camera).then((function(e){return r._getNodeRef(r.cameraCache,o.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(s){let a;if(a=!0===o.isBone?new t.Bone:s.length>1?new t.Group:1===s.length?s[0]:new t.Object3D,a!==s[0])for(let e=0,t=s.length;e<t;e++)a.add(s[e]);if(o.name&&(a.userData.name=o.name,a.name=i),le(a,o),o.extensions&&ce(n,a,o),void 0!==o.matrix){const e=new t.Matrix4;e.fromArray(o.matrix),a.applyMatrix4(e)}else void 0!==o.translation&&a.position.fromArray(o.translation),void 0!==o.rotation&&a.quaternion.fromArray(o.rotation),void 0!==o.scale&&a.scale.fromArray(o.scale);return r.associations.set(a,{type:"nodes",index:e}),a}))}loadScene(e){const n=this.json,r=this.extensions,o=this.json.scenes[e],i=this,s=new t.Group;o.name&&(s.name=i.createUniqueName(o.name)),le(s,o),o.extensions&&ce(r,s,o);const a=o.nodes||[],c=[];for(let e=0,t=a.length;e<t;e++)c.push(me(a[e],s,n,i));return Promise.all(c).then((function(){return s}))}}function me(e,n,r,o){const i=r.nodes[e];return o.getDependency("node",e).then((function(e){if(void 0===i.skin)return e;let n;return o.getDependency("skin",i.skin).then((function(e){n=e;const t=[];for(let e=0,r=n.joints.length;e<r;e++)t.push(o.getDependency("node",n.joints[e]));return Promise.all(t)})).then((function(r){return e.traverse((function(e){if(!e.isMesh)return;const o=[],i=[];for(let e=0,s=r.length;e<s;e++){const s=r[e];if(s){o.push(s);const r=new t.Matrix4;void 0!==n.inverseBindMatrices&&r.fromArray(n.inverseBindMatrices.array,16*e),i.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[e])}e.bind(new t.Skeleton(o,i),e.matrixWorld)})),e}))})).then((function(e){n.add(e);const t=[];if(i.children){const n=i.children;for(let i=0,s=n.length;i<s;i++)t.push(me(n[i],e,r,o))}return Promise.all(t)}))}function ge(e,n,r){const o=n.attributes,i=[];function s(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in o){const n=oe[t]||t.toLowerCase();n in e.attributes||i.push(s(o[t],n))}if(void 0!==n.indices&&!e.index){const t=r.getDependency("accessor",n.indices).then((function(t){e.setIndex(t)}));i.push(t)}return le(e,n),function(e,n,r){const o=n.attributes,i=new t.Box3;if(void 0===o.POSITION)return;{const e=r.json.accessors[o.POSITION],n=e.min,s=e.max;if(void 0===n||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new t.Vector3(n[0],n[1],n[2]),new t.Vector3(s[0],s[1],s[2])),e.normalized){const t=de(ee[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}const s=n.targets;if(void 0!==s){const e=new t.Vector3,n=new t.Vector3;for(let t=0,o=s.length;t<o;t++){const o=s[t];if(void 0!==o.POSITION){const t=r.json.accessors[o.POSITION],i=t.min,s=t.max;if(void 0!==i&&void 0!==s){if(n.setX(Math.max(Math.abs(i[0]),Math.abs(s[0]))),n.setY(Math.max(Math.abs(i[1]),Math.abs(s[1]))),n.setZ(Math.max(Math.abs(i[2]),Math.abs(s[2]))),t.normalized){const e=de(ee[t.componentType]);n.multiplyScalar(e)}e.max(n)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;const a=new t.Sphere;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=a}(e,n,r),Promise.all(i).then((function(){return void 0!==n.targets?function(e,t,n){let r=!1,o=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(r=!0),void 0!==n.NORMAL&&(o=!0),r&&o)break}if(!r&&!o)return Promise.resolve(e);const i=[],s=[];for(let a=0,c=t.length;a<c;a++){const c=t[a];if(r){const t=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;i.push(t)}if(o){const t=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal;s.push(t)}}return Promise.all([Promise.all(i),Promise.all(s)]).then((function(t){const n=t[1];return r&&(e.morphAttributes.position=t[0]),o&&(e.morphAttributes.normal=n),e.morphTargetsRelative=!0,e}))}(e,n.targets,r):e}))}function ye(e,n){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const o=r.count-2,i=[];if(n===t.TriangleFanDrawMode)for(let e=1;e<=o;e++)i.push(r.getX(0)),i.push(r.getX(e)),i.push(r.getX(e+1));else for(let e=0;e<o;e++)e%2==0?(i.push(r.getX(e)),i.push(r.getX(e+1)),i.push(r.getX(e+2))):(i.push(r.getX(e+2)),i.push(r.getX(e+1)),i.push(r.getX(e)));i.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(i),s}function be(e,n,r,o){return new Promise((function(i,s){(new D).load(e,(function(e){var s=e.scene;n&&function(e,n){var r=Math.pow(10,-10);e.traverse((function(e){e instanceof t.Mesh&&(e.geometry.computeBoundingSphere(),e.geometry&&e.geometry.boundingSphere&&e.geometry.boundingSphere.radius>r&&(r=e.geometry.boundingSphere.radius))}));var o=n/r;e.scale.set(o,o,o)}(s,n),r&&function(e){var n=(new t.Box3).setFromObject(e).getCenter(new t.Vector3).toArray(),r=n[0],o=n[1],i=n[2],s=e.position.clone().toArray();e.position.set(s[0]-r,s[1]-o,s[2]-i)}(s),o&&function(e){e.traverse((function(e){"Mesh"===e.type&&(e.castShadow=!0,e.receiveShadow=!0)}))}(s),setTimeout((function(){return i(s)}),5)}),(function(e){return!1}),(function(e){console.log("Loading error occurred:",e.message),s()}))}))}var ve=new Set(["a","e","i","q","epoch","period","tp","ma","n","L","om","w","wBar","GM"]),we=new Set(["i","ma","n","L","om","w","wBar"]);function _e(e){return void 0!==e}var Ee=function(){function e(e,t,n){var r=this;void 0===t&&(t="rad"),void 0===n&&(n=!1),this._locked=!1,this._attrs=i({},e),this._locked=!1,e&&Object.keys(e).forEach((function(n){var o=we.has(n)?t:void 0,i=e[n];i&&r.set(n,i,o)})),void 0===this._attrs.GM&&(this._attrs.GM=Te.SUN),this.fill(),this.get("e")>.9&&void 0===this.get("tp")&&console.warn('You must specify "tp" (time of perihelion) for highly eccentric orbits'),this._locked=n}var t=e.prototype;return t.set=function(e,t,n){if(void 0===n&&(n="rad"),this._locked)throw new Error("Attempted to modify locked (immutable) Ephem object");return ve.has(e)?(this._attrs[e]="deg"===n?t*Math.PI/180:t,!0):(console.warn("Invalid ephem attr: "+e),!1)},t.get=function(e,t){void 0===t&&(t="rad");var n=this._attrs[e];return"deg"===t?180*n/Math.PI:n},t.getAttrs=function(){return this._attrs},t.fill=function(){var e=this.get("e");if(!_e(e))throw new Error('Must define eccentricity "e" in an orbit');var t=this.get("a"),n=this.get("q");if(_e(t)){if(!_e(n)){if(e>=1)throw new Error('Must provide perihelion distance "q" if eccentricity "e" is greater than 1');this.set("q",n=t*(1-e))}}else{if(!_e(n))throw new Error('Must define semimajor axis "a" or perihelion distance "q" in an orbit');this.set("a",t=n/(1-e))}var r=this.get("w"),o=this.get("wBar"),i=this.get("om");_e(r)&&_e(i)&&!_e(o)?this.set("wBar",o=r+i):_e(o)&&_e(i)&&!_e(r)?this.set("w",r=o-i):_e(r)&&_e(o)&&!_e(i)&&this.set("om",i=o-r);var s=149597870700*t,a=this.get("n"),c=this.get("GM"),l=this.get("period");if(!_e(l)&&_e(t)&&(l=2*Math.PI*Math.sqrt(s*s*s/c)/86400,this.set("period",l)),e<1)if(_e(l)&&!_e(a)){var u=2*Math.PI/l;this.set("n",u)}else _e(a)&&!_e(l)&&this.set("period",2*Math.PI/a);var h=this.get("ma"),p=this.get("L");!_e(p)&&_e(i)&&_e(r)&&_e(h)&&this.set("L",p=i+r+h),_e(h)||this.set("ma",p-o)},t.lock=function(){this._locked=!0},t.copy=function(){return new e({GM:this.get("GM"),epoch:this.get("epoch"),a:this.get("a"),e:this.get("e"),i:this.get("i"),om:this.get("om"),ma:this.get("ma"),w:this.get("w")},"rad")},e}(),Te={SUN:0x731c14d13d71fc000,MERCURY:22031780000000.02,VENUS:324858592000000.06,EARTH_MOON:403503235502259.8,MARS:42828375214000.02,JUPITER:0x1c22c96966960d0,SATURN:379405852e8,URANUS:5794548600000008,NEPTUNE:6836527100580024,PLUTO_CHARON:977000000000.0007},xe={MERCURY:new Ee({epoch:2458426.5,a:.3870968969437096,e:.2056515875393916,i:7.003891682749818,om:48.30774804443502,w:29.17940253442659,ma:256.190975209273},"deg",!0),VENUS:new Ee({epoch:2458426.5,a:.7233458663591554,e:.006762510759617694,i:3.394567787211735,om:76.62534150657346,w:54.74567447560867,ma:275.6687596099721},"deg",!0),EARTH:new Ee({epoch:2451545,a:1.00000261,e:.01671123,i:-1531e-8,om:0,wBar:102.93768193,L:100.46457166},"deg",!0),MOON:new Ee({GM:398600,epoch:2458621.5,a:.002582517063772124,e:.04582543645168888,i:5.102060246928811,om:108.5916732144811,w:61.80561793729225,ma:50.53270083636792},"deg",!0),MARS:new Ee({epoch:2458426.5,a:1.52371401537107,e:.09336741335309606,i:1.848141099825311,om:49.50420572080223,w:286.6965847685386,ma:25.38237617924876},"deg",!0),CERES:new Ee({epoch:2459200.5,a:2.7660891,e:.0781685,i:10.5879,om:80.27236,w:73.72487,ma:205.54542},"deg",!0),JUPITER:new Ee({epoch:2458426.5,a:5.20180355911023,e:.0489912558249006,i:1.303560894624275,om:100.5203828847816,w:273.736301845404,ma:231.939544389401},"deg",!0),SATURN:new Ee({epoch:2458426.5,a:9.577177295536776,e:.05101889921719987,i:2.482782449972317,om:113.6154964073247,w:339.4422648650336,ma:187.0970898012944},"deg",!0),URANUS:new Ee({epoch:2458426.5,a:19.14496966635462,e:.04832662948112808,i:.7697511134483724,om:74.14239045667875,w:99.42704504702185,ma:220.2603033874267},"deg",!0),NEPTUNE:new Ee({epoch:2458426.5,a:30.0962226342805,e:.00736257118719377,i:1.774569249829094,om:131.8695882492132,w:258.6226409499831,ma:315.2804988924479},"deg",!0),PLUTO:new Ee({epoch:2454000.5,a:39.4450697257,e:.250248713478,i:17.0890009196,om:110.376957955,w:112.597141677,ma:25.2471897122},"deg",!0),HAUMEA:new Ee({epoch:2459200.5,a:43.116,e:.19642,i:28.2137,om:122.167,w:239.041,ma:218.205},"deg",!0),MAKEMAKE:new Ee({epoch:2458900.5,a:45.43,e:.16126,i:28.9835,om:79.62,w:294.834,ma:165.514},"deg",!0),ERIS:new Ee({epoch:2459000.5,a:67.864,e:.43607,i:44.04,om:35.951,w:151.639,ma:205.989},"deg",!0)};function Me(e,t,n){return[1*e,1*t,1*n]}function Se(e,t,n,r,o,i){if(void 0===e)throw"data object is undefined";if(!Array.isArray(e))throw"data object must be an array";if(n>=r)throw"first row must be greater than last row";if(n<0)throw"first row must be greater than zero";if(r>e.length-1)throw"last row must be ";if(!Array.isArray(e[n]))throw"data in rows must be array data";var s=e[0].length-1;if(o<0||o>s)throw"xIndex has to be between 0 and "+s+": "+o;if(i<0||i>s)throw"yIndex has to be between 0 and "+s+": "+i;for(var a=0,c=n;c<=r;c++){for(var l=1,u=n;u<=r;u++)u!==c&&(l*=(t-e[u][o])/(e[c][o]-e[u][o]));a+=l*e[c][i]}return a}var Ae,Pe=function(e,t){return e-t},Le=function(e,t){return e[0]-t},Re={distance:"au",time:"day"},Oe=new Set(["km","au"]),Ie=new Set(["cartesianposvel"]),ke=new Set(["lagrange"]),Ne=new Set(["day","sec"]),Ce=function(){function e(e){if(this._units=i({},Re),this._ephemType="cartesianposvel",this._interpolationType="lagrange",this._interpolationOrder=5,!e)throw"EphemerisTable must be initialized with an ephemeris data structure";if(!e.data||!Array.isArray(e.data)||0===e.data.length||!Array.isArray(e.data[0]))throw"EphemerisTable must be initialized with a structure containing an array of arrays of ephemeris data";if(this._data=[].concat(e.data),e.distanceUnits){if(!Oe.has(e.distanceUnits))throw"Unknown distance units: "+e.distanceUnits;this._units.distance=e.distanceUnits}if(e.timeUnits){if(!Ne.has(e.timeUnits))throw"Unknown time units: "+e.timeUnits;this._units.time=e.timeUnits}if(e.ephemerisType){if(!Ie.has(e.ephemerisType))throw"Unknown ephemeris type: "+e.ephemerisType;this._ephemType=e.ephemerisType}if(e.interpolationType){if(!ke.has(e.interpolationType))throw"Unknown interpolation type: "+e.interpolationType;this._interpolationType=e.interpolationType}if(void 0!==e.interpolationOrder){if(e.interpolationOrder<1||e.interpolationOrder>20)throw"Interpolation order must be >0 and <20: "+e.interpolationOrder;this._interpolationOrder=e.interpolationOrder}if(this._units.distance!==Re.distance||this._units.time!==Re.time){var t=this.calcDistanceMultiplier(this._units.distance),n=this.calcTimeMultiplier(this._units.time);this._data.forEach((function(e){e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t*n,e[5]*=t*n,e[6]*=t*n}))}}var t=e.prototype;return t.getPositionAtTime=function(e){if(e<=this._data[0][0])return[this._data[0][1],this._data[0][2],this._data[0][3]];var t=this._data[this._data.length-1];if(e>=t[0])return[t[1],t[2],t[3]];var n=this.calcBoundingIndices(e),r=n.startIndex,o=n.stopIndex;return[Se(this._data,e,r,o,0,1),Se(this._data,e,r,o,0,2),Se(this._data,e,r,o,0,3)]},t.getPositions=function(e,t,n){if(e>t)throw"Requested start needs to be after requested stop";if(n<=0)throw"Step days needs to be greater than zero";for(var r=[],o=e;o<=t;o+=n)r.push(this.getPositionAtTime(o));return r},t.calcDistanceMultiplier=function(e){switch(e){case"au":return 1;case"km":return 1/149597870.7;default:throw new Error("Unknown distance unit type: "+e)}},t.calcTimeMultiplier=function(e){switch(e){case"day":return 1;case"sec":return 1/86400;default:throw new Error("Unknown time unit type: "+e)}},t.calcBoundingIndices=function(e){var t=Math.floor(this._interpolationOrder/2),n=function(e,t,n){if(void 0===n&&(n=Pe),void 0===e)throw"data object is undefined";if(!Array.isArray(e))throw"data object must be an array";if(void 0===t)throw"value object must be defined";if(void 0===n)throw"comparer must be defined";for(var r=0,o=e.length;r<=o;){var i=Math.floor((r+o)/2);if(i===e.length)return i;var s=n(e[i],t);if(s<0)r=i+1;else{if(!(s>0))return i;o=i-1}}return~r}(this._data,e,Le);n<0&&(n=~n-1);var r=n-t;r<0&&(r=0);var o=r+Number(this._interpolationOrder);return o>=this._data.length&&(o=this._data.length-1,this._data.length>t&&(r=o-t)),{startIndex:r,stopIndex:o}},e}(),De=Math.sin,Ue=Math.cos,Be=Math.sqrt;function He(e){return Math.exp(Math.log(e)/3)}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PARABOLIC=1]="PARABOLIC",e[e.HYPERBOLIC=2]="HYPERBOLIC",e[e.ELLIPTICAL=3]="ELLIPTICAL",e[e.TABLE=4]="TABLE"}(Ae||(Ae={}));var Ge=function(){function e(e,t){this._ephem=e,this._orbitStart=0,this._orbitStop=0,this._options=i({color:"white",eclipticLineColor:"cyan"},t,{orbitPathSettings:i({leadDurationYears:1,trailDurationYears:1,numberSamplePoints:36},t.orbitPathSettings)}),this._orbitType=function(e){if(e instanceof Ce)return Ae.TABLE;var t=e.get("e");return t>.9&&t<1.2?Ae.PARABOLIC:t>1.2?Ae.HYPERBOLIC:Ae.ELLIPTICAL}(this._ephem)}var r=e.prototype;return r.getPositionAtTime=function(e,t){switch(void 0===t&&(t=!1),this._orbitType){case Ae.PARABOLIC:return this.getPositionAtTimeNearParabolic(e,t);case Ae.HYPERBOLIC:return this.getPositionAtTimeHyperbolic(e,t);case Ae.ELLIPTICAL:return this.getPositionAtTimeElliptical(e,t);case Ae.TABLE:return this.getPositionAtTimeTable(e,t)}throw new Error("No handler for this type of orbit")},r.getPositionAtTimeParabolic=function(e,t){var n=this._ephem;if(n instanceof Ce)throw new Error("Poor logic allowing table type here");var r=n.get("q"),o=(e-n.get("tp"))*(.01720209895/Be(2))/Be(r*r*r)*1.5,i=Be(1+o*o),s=He(i+o)-He(i-o),a=2*Math.atan(s);return this.vectorToHeliocentric(a,r*(1+s*s))},r.getPositionAtTimeNearParabolic=function(e,t){var n=this._ephem;if(n instanceof Ce)throw new Error("Poor logic allowing table type here");var r=n.get("e"),o=n.get("q"),i=.75*(e-n.get("tp"))*.01720209895*Be((1+r)/(o*o*o)),s=Be(1+i*i),a=He(s+i)-He(s-i),c=(1-r)/(1+r),l=a*a/(1+a*a),u=c*l*l,h=a*(1+c*l*(2/3+.4*a*a+(1.4+33/35*a*a+37/175*Math.pow(a,4))*u+a*a*(432/175+956/1125*a*a+84/1575*Math.pow(a,4))*u*u)),p=2*Math.atan(h);return this.vectorToHeliocentric(p,o*(1+h*h)/(1+h*h*c))},r.getPositionAtTimeHyperbolic=function(e,t){var n=this._ephem;if(n instanceof Ce)throw new Error("Poor logic allowing table type here");for(var r=n.get("e"),o=n.get("a"),i=n.get("ma")+n.get("n","rad")*(e-n.get("epoch")),s=i,a=0;a<100;a++){var c=(i+r*(s*Math.cosh(s)-Math.sinh(s)))/(r*Math.cosh(s)-1),l=Math.abs(c-s);if(s=c,l<1e-7)break}var u=s,h=2*Math.atan(Be((r+1)/(r-1)))*Math.tanh(u/2),p=o*(1-r*r)/(1+r*Ue(h));return this.vectorToHeliocentric(h,p)},r.getPositionAtTimeElliptical=function(e,t){void 0===t&&(t=!1);var n=this._ephem;if(n instanceof Ce)throw new Error("Poor logic allowing table type here");var r=n.get("e"),o=n.get("ma","rad"),i=n.get("n","rad"),s=e-n.get("epoch"),a=o+i*s;t&&(console.info("period=",n.get("period")),console.info("n=",i),console.info("ma=",o),console.info("d=",s),console.info("M=",a));for(var c=a,l=0;l<100;l++){var u=a+r*De(c),h=Math.abs(u-c);if(c=u,h<1e-7)break}var p=c,d=2*Math.atan(Be((1+r)/(1-r))*Math.tan(p/2)),f=n.get("a")*(1-r*r)/(1+r*Ue(d));return this.vectorToHeliocentric(d,f)},r.getPositionAtTimeTable=function(e,t){if(this._ephem instanceof Ee)throw new Error("Poor logic allowing non-table type here");var n=this._ephem.getPositionAtTime(e);return Me(n[0],n[1],n[2])},r.vectorToHeliocentric=function(e,t){var n=this._ephem;if(n instanceof Ce)throw new Error("Poor logic allowing table type here");var r=n.get("i","rad"),o=n.get("om","rad"),i=n.get("wBar","rad");return Me(t*(Ue(o)*Ue(e+i-o)-De(o)*De(e+i-o)*Ue(r)),t*(De(o)*Ue(e+i-o)+Ue(o)*De(e+i-o)*Ue(r)),t*(De(e+i-o)*De(r)))},r.needsUpdateForTime=function(e){return this._orbitType===Ae.TABLE&&(e<this._orbitStart||e>this._orbitStop)},r.getOrbitShape=function(e,t){if(this._orbitType===Ae.ELLIPTICAL)return this.getEllipseGeometry();this._orbitType===Ae.TABLE||this._ephem.get("tp");var r=n.toJulianDay(new Date),o=r-365.25*this._options.orbitPathSettings.trailDurationYears,i=r+365.25*this._options.orbitPathSettings.leadDurationYears,s=(i-o)/this._options.orbitPathSettings.numberSamplePoints;switch(this._orbitStart=o,this._orbitStop=i,this._orbitType){case Ae.HYPERBOLIC:return this.getLine(this.getPositionAtTimeHyperbolic.bind(this),o,i,s);case Ae.PARABOLIC:return this.getLine(this.getPositionAtTimeNearParabolic.bind(this),o,i,s)}throw new Error("Unknown orbit shape")},r.getLine=function(e,n,r,o){for(var i=[],s=n;s<=r;s+=o){var a=e(s);a[0]=f(a[0]),a[1]=f(a[1]),a[2]=f(a[2]),i.push(new t.Vector3(a[0],a[1],a[2]))}var c=new t.BufferGeometry;return c.setFromPoints(i),c},r.getTableOrbit=function(e,n,r){if(this._ephem instanceof Ee)throw new Error("Poor logic allowing non-table type here");var o=this._ephem.getPositions(e,n,r).map((function(e){return[1*(t=e)[0],1*t[1],1*t[2]];var t})).map((function(e){return new t.Vector3(e[0],e[1],e[2])})),i=new t.BufferGeometry;return i.setFromPoints(o),this.generateAndCacheOrbitShape(i)},r.getEllipse=function(){var e=this.getEllipseGeometry();return this.generateAndCacheOrbitShape(e)},r.getEllipseGeometry=function(){var e=this._ephem;if(e instanceof Ce)throw new Error("Poor logic allowing table type here");e.get("period");for(var n=e.get("a"),r=e.get("e"),o=2*Math.PI,i=o/90,s=[],a=0;a<o;a+=i){var c=2*Math.atan(Be((1+r)/(1-r))*Math.tan(a/2)),l=n*(1-r*r)/(1+r*Ue(c)),u=this.vectorToHeliocentric(c,l);(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))&&(console.error("NaN position value - you may have bad or incomplete data in the following ephemeris:",c,l,n,r),console.error(e)),s.push(new t.Vector3(f(u[0]),f(u[1]),f(u[2])))}s.push(s[0]);var h=new t.BufferGeometry;return h.setFromPoints(s),h},r.generateAndCacheOrbitShape=function(e){return this._orbitPoints=e,this._orbitShape=new t.Line(e,new t.LineBasicMaterial({color:new t.Color(this._options.color||4473924)})),this._orbitShape},r.getLinesToEcliptic=function(){if(this._eclipticDropLines)return this._eclipticDropLines;this._orbitPoints||this.getOrbitShape();var e=this._orbitPoints,n=new t.BufferGeometry;if(!e)throw new Error("Poor logic letting point be undefined here");return this._eclipticDropLines=new t.LineSegments(n,new t.LineBasicMaterial({color:this._options.eclipticLineColor||3355443,blending:t.AdditiveBlending})),this._eclipticDropLines},r.getHexColor=function(){var e;return null==(e=this._orbitShape)?void 0:e.material.color.getHex()},r.setHexColor=function(e){var n,r;null!=(n=this._orbitShape)&&null!=(r=n.material)&&r.color&&(this._orbitShape.material.color=new t.Color(e))},r.getVisibility=function(){var e;return null==(e=this._orbitShape)?void 0:e.visible},r.setVisibility=function(e){this._orbitShape&&(this._orbitShape.visible=e)},e}();class Ve{static computeTangents(e){e.computeTangents(),console.warn("THREE.BufferGeometryUtils: .computeTangents() has been removed. Use BufferGeometry.computeTangents() instead.")}static mergeBufferGeometries(e,n=!1){const r=null!==e[0].index,o=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),s={},a={},c=e[0].morphTargetsRelative,l=new t.BufferGeometry;let u=0;for(let t=0;t<e.length;++t){const h=e[t];let p=0;if(r!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in h.attributes){if(!o.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[e]&&(s[e]=[]),s[e].push(h.attributes[e]),p++}if(p!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". Make sure all geometries have the same number of attributes."),null;if(c!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in h.morphAttributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===a[e]&&(a[e]=[]),a[e].push(h.morphAttributes[e])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(h.userData),n){let e;if(r)e=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". The geometry must have either an index or a position attribute"),null;e=h.attributes.position.count}l.addGroup(u,e,t),u+=e}}if(r){let t=0;const n=[];for(let r=0;r<e.length;++r){const o=e[r].index;for(let e=0;e<o.count;++e)n.push(o.getX(e)+t);t+=e[r].attributes.position.count}l.setIndex(n)}for(const e in s){const t=this.mergeBufferAttributes(s[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" attribute."),null;l.setAttribute(e,t)}for(const e in a){const t=a[e][0].length;if(0===t)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[e]=[];for(let n=0;n<t;++n){const t=[];for(let r=0;r<a[e].length;++r)t.push(a[e][r][n]);const r=this.mergeBufferAttributes(t);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+e+" morphAttribute."),null;l.morphAttributes[e].push(r)}}return l}static mergeBufferAttributes(e){let n,r,o,i=0;for(let t=0;t<e.length;++t){const s=e[t];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===n&&(n=s.array.constructor),n!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===r&&(r=s.itemSize),r!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===o&&(o=s.normalized),o!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=s.array.length}const s=new n(i);let a=0;for(let t=0;t<e.length;++t)s.set(e[t].array,a),a+=e[t].array.length;return new t.BufferAttribute(s,r,o)}static interleaveAttributes(e){let n,r=0,o=0;for(let t=0,i=e.length;t<i;++t){const i=e[t];if(void 0===n&&(n=i.array.constructor),n!==i.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;r+=i.array.length,o+=i.itemSize}const i=new t.InterleavedBuffer(new n(r),o);let s=0;const a=[],c=["getX","getY","getZ","getW"],l=["setX","setY","setZ","setW"];for(let n=0,r=e.length;n<r;n++){const r=e[n],o=r.itemSize,u=r.count,h=new t.InterleavedBufferAttribute(i,o,s,r.normalized);a.push(h),s+=o;for(let e=0;e<u;e++)for(let t=0;t<o;t++)h[l[t]](e,r[c[t]](e))}return a}static estimateBytesUsed(e){let t=0;for(const n in e.attributes){const r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}static mergeVertices(e,n=1e-4){n=Math.max(n,Number.EPSILON);const r={},o=e.getIndex(),i=e.getAttribute("position"),s=o?o.count:i.count;let a=0;const c=Object.keys(e.attributes),l={},u={},h=[],p=["getX","getY","getZ","getW"];for(let t=0,n=c.length;t<n;t++){const n=c[t];l[n]=[];const r=e.morphAttributes[n];r&&(u[n]=new Array(r.length).fill().map(()=>[]))}const d=Math.log10(1/n),f=Math.pow(10,d);for(let t=0;t<s;t++){const n=o?o.getX(t):t;let i="";for(let t=0,r=c.length;t<r;t++){const r=e.getAttribute(c[t]),o=r.itemSize;for(let e=0;e<o;e++)i+=~~(r[p[e]](n)*f)+","}if(i in r)h.push(r[i]);else{for(let t=0,r=c.length;t<r;t++){const r=c[t],o=e.getAttribute(r),i=e.morphAttributes[r],s=o.itemSize,a=l[r],h=u[r];for(let e=0;e<s;e++){const t=p[e];if(a.push(o[t](n)),i)for(let e=0,r=i.length;e<r;e++)h[e].push(i[e][t](n))}}r[i]=a,h.push(a),a++}}const m=e.clone();for(let n=0,r=c.length;n<r;n++){const r=c[n],o=e.getAttribute(r),i=new o.array.constructor(l[r]),s=new t.BufferAttribute(i,o.itemSize,o.normalized);if(m.setAttribute(r,s),r in u)for(let n=0;n<u[r].length;n++){const o=e.morphAttributes[r][n],i=new o.array.constructor(u[r][n]),s=new t.BufferAttribute(i,o.itemSize,o.normalized);m.morphAttributes[r][n]=s}}return m.setIndex(h),m}static toTrianglesDrawMode(e,n){if(n===t.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(n===t.TriangleFanDrawMode||n===t.TriangleStripDrawMode){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const o=r.count-2,i=[];if(n===t.TriangleFanDrawMode)for(let e=1;e<=o;e++)i.push(r.getX(0)),i.push(r.getX(e)),i.push(r.getX(e+1));else for(let e=0;e<o;e++)e%2==0?(i.push(r.getX(e)),i.push(r.getX(e+1)),i.push(r.getX(e+2))):(i.push(r.getX(e+2)),i.push(r.getX(e+1)),i.push(r.getX(e)));i.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(i),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",n),e}static computeMorphedAttributes(e){if(!0!==e.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;const n=new t.Vector3,r=new t.Vector3,o=new t.Vector3,i=new t.Vector3,s=new t.Vector3,a=new t.Vector3,c=new t.Vector3,l=new t.Vector3,u=new t.Vector3;function h(e,t,h,p,d,f,m,g,y){n.fromBufferAttribute(h,f),r.fromBufferAttribute(h,m),o.fromBufferAttribute(h,g);const b=e.morphTargetInfluences;if(t.morphTargets&&p&&b){c.set(0,0,0),l.set(0,0,0),u.set(0,0,0);for(let e=0,t=p.length;e<t;e++){const t=b[e],h=p[e];0!==t&&(i.fromBufferAttribute(h,f),s.fromBufferAttribute(h,m),a.fromBufferAttribute(h,g),d?(c.addScaledVector(i,t),l.addScaledVector(s,t),u.addScaledVector(a,t)):(c.addScaledVector(i.sub(n),t),l.addScaledVector(s.sub(r),t),u.addScaledVector(a.sub(o),t)))}n.add(c),r.add(l),o.add(u)}e.isSkinnedMesh&&(e.boneTransform(f,n),e.boneTransform(m,r),e.boneTransform(g,o)),y[3*f+0]=n.x,y[3*f+1]=n.y,y[3*f+2]=n.z,y[3*m+0]=r.x,y[3*m+1]=r.y,y[3*m+2]=r.z,y[3*g+0]=o.x,y[3*g+1]=o.y,y[3*g+2]=o.z}const p=e.geometry,d=e.material;let f,m,g;const y=p.index,b=p.attributes.position,v=p.morphAttributes.position,w=p.morphTargetsRelative,_=p.attributes.normal,E=p.morphAttributes.position,T=p.groups,x=p.drawRange;let M,S,A,P,L,R,O,I;const k=new Float32Array(b.count*b.itemSize),N=new Float32Array(_.count*_.itemSize);if(null!==y)if(Array.isArray(d))for(M=0,A=T.length;M<A;M++)for(L=T[M],R=d[L.materialIndex],O=Math.max(L.start,x.start),I=Math.min(L.start+L.count,x.start+x.count),S=O,P=I;S<P;S+=3)f=y.getX(S),m=y.getX(S+1),g=y.getX(S+2),h(e,R,b,v,w,f,m,g,k),h(e,R,_,E,w,f,m,g,N);else for(O=Math.max(0,x.start),I=Math.min(y.count,x.start+x.count),M=O,A=I;M<A;M+=3)f=y.getX(M),m=y.getX(M+1),g=y.getX(M+2),h(e,d,b,v,w,f,m,g,k),h(e,d,_,E,w,f,m,g,N);else if(void 0!==b)if(Array.isArray(d))for(M=0,A=T.length;M<A;M++)for(L=T[M],R=d[L.materialIndex],O=Math.max(L.start,x.start),I=Math.min(L.start+L.count,x.start+x.count),S=O,P=I;S<P;S+=3)f=S,m=S+1,g=S+2,h(e,R,b,v,w,f,m,g,k),h(e,R,_,E,w,f,m,g,N);else for(O=Math.max(0,x.start),I=Math.min(b.count,x.start+x.count),M=O,A=I;M<A;M+=3)f=M,m=M+1,g=M+2,h(e,d,b,v,w,f,m,g,k),h(e,d,_,E,w,f,m,g,N);return{positionAttribute:b,normalAttribute:_,morphedPositionAttribute:new t.Float32BufferAttribute(k,3),morphedNormalAttribute:new t.Float32BufferAttribute(N,3)}}}function je(e){var t=e.length()/N,n=(Math.log10(t)+1)/t,r=e.clone();return r.multiplyScalar(n),r}var Fe=f(1),ze=function(){function e(e,n,r,o,i){var s=this;switch(void 0===n&&(n=k.PLANET),void 0===o&&(o="white"),void 0===i&&(i=.7),this.name=e,this.orbitalType=n,this.skephem=r,this.color=o,this.opacity=i,this.loadPlanet=function(){s.SKEph=xe[s.name],s.SKOrbit=new Ge(s.SKEph,{color:s.orbitalType===k.PLANET?"white":"pink",eclipticLineColor:void 0,orbitPathSettings:void 0}),s.SKprojectedOrbitLine=s.getMorphedOrbitLine(),s.SKprojectedOrbitLine.material.transparent=!0,s.SKprojectedOrbitLine.material.opacity=s.opacity||1,s.SKprojectedOrbitLine.material.needsUpdate=!0},this.loadAsteroid=function(){s.SKEph=s.skephem||new Ee({epoch:2458600.5,e:.994954,i:89.0608,om:283.2105,w:130.4979,q:2.916594,tp:2458043.666667},"deg"),s.SKOrbit=new Ge(s.SKEph,{color:"cyan",eclipticLineColor:void 0,orbitPathSettings:void 0}),s.SKprojectedOrbitLine=s.getMorphedOrbitLine(),s.SKprojectedOrbitLine.material.color=new t.Color("cyan"),s.SKprojectedOrbitLine.material.transparent=!0,s.SKprojectedOrbitLine.material.opacity=s.opacity||1,s.SKprojectedOrbitLine.material.needsUpdate=!0},this.getProjectedOrbitLine=function(){return s.SKprojectedOrbitLine},this.orbitalType){case k.ASTEROID:this.loadAsteroid();break;case k.PLANET:case k.DWARF_PLANET:default:this.loadPlanet()}}var n=e.prototype;return n.getMorphedOrbitLine=function(){if(this.orbitLine)return this.orbitLine;if(!this.SKOrbit)throw new Error("Poor logic mi amigo");var e=this.SKOrbit.getOrbitShape();e.morphAttributes.position=[];for(var n=e.attributes.position,r=[],o=0;o<n.count;o++){var i=n.getX(o),s=n.getY(o),a=n.getZ(o),c=je(new t.Vector3(i,s,a));r.push(c.x,c.y,c.z)}return e.morphAttributes.position[0]=new t.Float32BufferAttribute(r,3),this.orbitLine=new t.Line(e,new t.LineBasicMaterial({color:new t.Color(this.color||4473924),morphTargets:!0})),this.orbitLine},n.getXyzMeters=function(e){var t;void 0===e&&(e=0);var n=null==(t=this.SKOrbit)?void 0:t.getPositionAtTime(e);return n?{x:f(n[0]),y:f(n[1]),z:f(n[2])}:{x:0,y:0,z:0}},n.getPosition=function(e){void 0===e&&(e=0);var n=this.getXyzMeters(e);return new t.Vector3(n.x,n.y,n.z)},n.getTail=function(e,n,r){void 0===n&&(n=.3*Fe),void 0===r&&(r=0);for(var o=this.getPosition(r),i=je(o),s=r,a=r,c=0,l=0,u=!0,h=!0;u||h;)h=l<n,(u=c<n)&&(c=o.distanceTo(this.getPosition(s+=5))),h&&(l=i.distanceTo(je(this.getPosition(a+=5))));for(var p=(s-r)/5,d=(a-r)/5,f=e/5,m=[],g=o.clone(),y=i.clone(),b=o.clone(),v=i.clone(),w=e,_=1;_<=5;_++){var E=r+_*d;b=this.getPosition(r+_*p),v=je(this.getPosition(E));var T=w-f,x=g.distanceTo(b),M=y.distanceTo(v),S=new t.CylinderGeometry(w,T,x,3,1,!1),A=new t.CylinderGeometry(w,T,M,3,1,!1),P=g.x,L=g.y,R=g.z,O=new t.Matrix4;O.makeTranslation(P,L,R),O.lookAt(g,b,new t.Vector3(0,0,1)),S.translate(0,-x/2,0),S.rotateX(Math.PI/2),S.applyMatrix4(O);var I=y.x,k=y.y,N=y.z,C=new t.Matrix4;C.makeTranslation(I,k,N),C.lookAt(y,v,new t.Vector3(0,0,1)),A.translate(0,-M/2,0),A.rotateX(Math.PI/2),A.applyMatrix4(C),m.push({realSegmentGeometry:S,loggedSegmentGeometry:A}),g=b,y=v,w=T}return{realGeometry:Ve.mergeBufferGeometries(m.map((function(e){return e.realSegmentGeometry})),!0),loggedGeometry:Ve.mergeBufferGeometries(m.map((function(e){return e.loggedSegmentGeometry})),!0)}},e}(),Ke=["MERCURY","VENUS","EARTH","MARS","CERES","PLUTO"],Xe=["HAUMEA","MAKEMAKE","ERIS"],Ye=["CERES","PLUTO","HAUMEA","MAKEMAKE","ERIS"],Ze=function(e){function n(n){var r,i;return(r=e.call(this,"PLUTO"===(i=n)||"CERES"===i?1e4:"HAUMEA"===i||"MAKEMAKE"===i||"ERIS"===i?15e3:3e3)||this).NAME=n,r.model=new t.Group,r.loadPlanetAsObject=o(c.mark((function e(){var n,o,i,s;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.NAME.toLowerCase(),o=O+"/planets/"+n+"/"+n+".glb",(i=new t.Mesh(new t.SphereGeometry(r.radius,32,32),new t.MeshPhongMaterial)).rotateX(Math.PI/2),r.model.add(i),s=function(e){i.visible=!1,e&&r.model.add(e)},!r._isAsyncLoad()){e.next=10;break}be(o,r.radius).then(s).catch((function(e){return s(null)})),e.next=15;break;case 10:return e.t0=s,e.next=13,be(o,r.radius).catch((function(e){return null}));case 13:e.t1=e.sent,(0,e.t0)(e.t1);case 15:case"end":return e.stop()}}),e)}))),r.loadPlanetAsTexturedSphere=o(c.mark((function e(){var n,o,i,s,a,l,u,h,p;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.NAME.toLowerCase(),o=O+"/planets/"+n+"/"+n+"-map-1024.jpg",i=O+"/planets/"+n+"/"+n+"-bump-1024.png",s=Ke.includes(r.NAME),a="EARTH"===r.NAME,l=Promise.resolve(null),(u=new t.Mesh(new t.SphereGeometry(r.radius,32,32),new t.MeshPhongMaterial({shininess:a?25:2}))).rotateX(Math.PI/2),r.model.add(u),h=function(e){var n=e[0],o=e[1],i=e[2],s="fulfilled"===o.status?o.value:null,a="fulfilled"===i.status?i.value:null;u.material.map="fulfilled"===n.status?n.value:null,u.material.bumpMap=s,u.material.bumpScale=50*r.radius,u.material.needsUpdate=!0,a&&(r.clouds=new t.Mesh(new t.SphereGeometry(1.05*r.radius,32,32),new t.MeshPhongMaterial({map:a,side:t.DoubleSide,transparent:!0,opacity:.6,depthWrite:!1})),r.model.add(r.clouds))},p=[M(o,n).catch((function(e){return null})),s?M(i,n).catch((function(e){return null})):l,a?new Promise((function(e,n){var r=document.createElement("canvas");r.width=1024,r.height=512;var o=r.getContext("2d"),i=new Image;i.crossOrigin="Anonymous",i.onerror=function(e){console.log("Error: ",e),n()},i.onload=function(){var s=document.createElement("canvas");s.width=i.width,s.height=i.height;var a=s.getContext("2d");a.drawImage(i,0,0);var c=a.getImageData(0,0,s.width,s.height),l=new Image;l.crossOrigin="Anonymous",l.addEventListener("load",(function(){var u=document.createElement("canvas");u.width=l.width,u.height=l.height;var h=u.getContext("2d");h.drawImage(l,0,0);try{for(var p=h.getImageData(0,0,u.width,u.height),d=a.createImageData(s.width,s.height),f=0,m=0;f<i.height;f++)for(var g=0;g<i.width;g++,m+=4)d.data[m+0]=c.data[m+0],d.data[m+1]=c.data[m+1],d.data[m+2]=c.data[m+2],d.data[m+3]=255-p.data[m+0];o.putImageData(d,0,0)}catch(e){console.log("Error: ",e),n()}e(new t.CanvasTexture(r))})),l.src=O+"/planets/earth/earth-clouds-trans-1024.png"},i.src=O+"/planets/earth/earth-clouds-color-1024.png"})).catch((function(e){return null})):l],!r._isAsyncLoad()){e.next=15;break}Promise.allSettled(p).then(h),e.next=20;break;case 15:return e.t0=h,e.next=18,Promise.allSettled(p);case 18:e.t1=e.sent,(0,e.t0)(e.t1);case 20:case"end":return e.stop()}}),e)}))),r.getPosition=function(){return r.model.position},r.getRadius=function(){return r.radius},r.getOrbit=function(){return r.orbit},r.setIsOrbitVisible=function(e){r.SKprojectedOrbitLine.visible=e},r.radius=function(e){return S[e].radiusMeters}(n),r.orbit=new ze(r.NAME,function(e){return Ye.includes(e)?k.DWARF_PLANET:k.PLANET}(n)),r.SKprojectedOrbitLine=r.orbit.getProjectedOrbitLine(),r._sceneEntityGroup.add(r.SKprojectedOrbitLine),r._toyGroup.push(r.model),r.helper=new t.LineSegments(new t.EdgesGeometry(new t.SphereGeometry(1.2*r.radius,32)),new t.LineBasicMaterial({color:new t.Color("cyan")})),r.helper.userData.isHelper=!0,r.helper.rotateX(Math.PI/2),r.model.add(r.helper),r}s(n,e);var r=n.prototype;return r.init=function(){var e=o(c.mark((function e(){var t=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=o(c.mark((function e(n){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Xe.includes(t.NAME)){e.next=5;break}return e.next=3,t.loadPlanetAsObject();case 3:e.next=7;break;case 5:return e.next=7,t.loadPlanetAsTexturedSphere();case 7:_("RESOLVED "+t.NAME),t._sceneEntityGroup.add(t.model),n(t._sceneEntityGroup);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.getDestinationPosition=function(e){void 0===e&&(e=0);var t=this.getLogInterpolationParam(),n=this.orbit.getPosition(e),r=je(n);return n.lerp(r,t)},r.updateOrbitLine=function(){var e=this.getLogInterpolationParam();this.SKprojectedOrbitLine.morphTargetInfluences[0]=e},r.update=function(){var e=this.getDestinationPosition();this.model.position.set(e.x,e.y,e.z),this.updateOrbitLine(),this._updateModelScale(),this.model.rotateZ(.0015),this.clouds&&(this.clouds.rotateY(-1e-4),this.clouds.rotateZ(-4e-4))},n}(R),qe=function(e){function n(n){var r;return(r=e.call(this)||this).NAME="STARFIELD",r.texture=null,r.invertColor=function(){r.texture&&(r.texture=function(e,n){void 0===n&&(n=!1);var r=e.image,o=document.createElement("canvas"),i=r.width,s=r.height;o.width=i,o.height=s;var a=o.getContext("2d");a.drawImage(r,0,0);for(var c=a.getImageData(0,0,i,s),l=0,u=0;l<s;l++)for(var h=0;h<i;h++,u+=4)c.data[u+0]=255-c.data[u+0],c.data[u+1]=255-c.data[u+1],c.data[u+2]=255-c.data[u+2],n&&(c.data[u+3]=255-c.data[u+3]);return a.putImageData(c,0,0),new t.CanvasTexture(o)}(r.texture),r.material.map=r.texture,r.material.needsUpdate=!0)},r.material=new t.MeshPhongMaterial({side:t.DoubleSide,transparent:!0,color:"black",opacity:1,shininess:0}),r.mesh=new t.Mesh(new t.SphereGeometry(n,32,32),r.material),r.mesh.rotation.y=Math.PI/2,r._sceneEntityGroup.name="STARFIELD",r}s(n,e);var r=n.prototype;return r.init=function(){var e=o(c.mark((function e(){var n=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=o(c.mark((function e(r){var o;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=O+"/stars/galaxy-starfield-4096.jpg",!n._isAsyncLoad()){e.next=5;break}M(o,"star-field").then((function(e){n.texture=e,e.encoding=t.GammaEncoding,n.material.map=e,n.material.needsUpdate=!0})),e.next=11;break;case 5:return e.next=7,M(o,"star-field");case 7:n.texture=e.sent,n.material.map=n.texture,n.material.color=new t.Color,n.material.needsUpdate=!0;case 11:n._sceneEntityGroup.add(n.mesh),console.log("Starfield resolved",+new Date-+Rt()),r(n._sceneEntityGroup);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.update=function(){},n}(L),We=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).NAME="Misc Helpers",t.update=function(){},t}return s(n,e),n.prototype.init=function(){var e=o(c.mark((function e(){var n=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=new t.AxesHelper(f(100));r.userData.isHelper=!0,n._sceneEntityGroup.add(r),e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n}(L),Je=function(e){function n(t){var n;return void 0===t&&(t=.3),(n=e.call(this)||this)._defaultIntensity=t,n.NAME="Simple Light",n.setPower=function(e){n._light.intensity=e||n._defaultIntensity},n.update=function(){},n}s(n,e);var r=n.prototype;return r.init=function(){var e=o(c.mark((function e(){var n=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n._light=new t.AmbientLight(3355443,n._defaultIntensity),n._light.userData.isAmbientLight=!0,n._sceneEntityGroup.add(n._light),e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.setIsOn=function(e){this._light.visible=e},n}(L),Qe=function(e,n,r){void 0===n&&(n=.25),void 0===r&&(r=new t.Vector3);for(var o=new t.DodecahedronGeometry(e,1),i=o.getAttribute("position"),s=new t.Vector3,a={},c=0;c<i.count;c++){s.fromBufferAttribute(i,c);var l=[s.x,s.y,s.z].join(",");a[l]||(a[l]={x:s.x+=Math.random()*e*n,y:s.y+=Math.random()*e*n,z:s.z+=Math.random()*e*n});var u=a[l];i.setXYZ(c,u.x,u.y,u.z)}var h=.5+Math.random(),p=.5+Math.random(),d=.5+Math.random();o.scale(h,p,d);var f=o.clone(),m=je(r);return o.translate(r.x,r.y,r.z),f.translate(m.x,m.y,m.z),{realGeometry:o,loggedGeometry:f}},$e=function(e){function n(n,r){var o;return void 0===r&&(r=1e4),(o=e.call(this,3e6)||this).NAME=n,o.radius=r,o.model=new t.Group,o.getPosition=function(){var e=o.orbit.getXyzMeters();return new t.Vector3(e.x,e.y,e.z)},o.getRadius=function(){return o.radius},o.getOrbit=function(){return o.orbit},o.setIsOrbitVisible=function(e){o.SKprojectedOrbitLine.visible=e},o.orbit=new ze(n,k.ASTEROID),o.SKprojectedOrbitLine=o.orbit.getMorphedOrbitLine(),o._sceneEntityGroup.add(o.SKprojectedOrbitLine),o}s(n,e);var r=n.prototype;return r.init=function(){var e=o(c.mark((function e(){var n=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=o(c.mark((function e(r){var o,i,s;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=O+"/misc/asteroid-texture-1024.jpg",i=Qe(n.radius),e.t0=t.Mesh,e.t1=i.realGeometry,e.t2=t.MeshPhongMaterial,e.next=7,M(o);case 7:e.t3=e.sent,e.t4={map:e.t3,shininess:0},e.t5=new e.t2(e.t4),s=new e.t0(e.t1,e.t5),n.model.add(s),n._toyGroup.push(n.model),n._sceneEntityGroup.add(n.model),r(n._sceneEntityGroup);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.updateOrbitLine=function(){var e=this.getLogInterpolationParam();this.SKprojectedOrbitLine.morphTargetInfluences[0]=e},r.getDestinationPosition=function(e){void 0===e&&(e=0);var t=this.getLogInterpolationParam(),n=this.orbit.getPosition(e),r=je(n);return n.lerp(r,t)},r.update=function(){var e=this.getDestinationPosition();this.model.position.set(e.x,e.y,e.z),this.updateOrbitLine(),this._updateModelScale()},n}(R),et=function(e){function n(t,n){var r;return void 0===t&&(t=.3),void 0===n&&(n=1),(r=e.call(this)||this)._defaultIntensity=t,r._radius=n,r.NAME="Point Light",r.setPower=function(e){r._light.intensity=e||r._defaultIntensity},r.update=function(){},r}s(n,e);var r=n.prototype;return r.init=function(){var e=o(c.mark((function e(){var n=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n._light=new t.PointLight(3355443,n._defaultIntensity);var r=new t.PointLightHelper(n._light,n._radius,new t.Color("red"));r.userData.isHelper=!0,n._sceneEntityGroup.add(n._light),n._sceneEntityGroup.add(r),e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.setIsOn=function(e){this._light.visible=e},n}(L),tt=.1*N,nt=function(e){function n(n,r){var o;void 0===n&&(n="BIRDSEYE"),void 0===r&&(r=30),(o=e.call(this,1)||this).NAME=n,o.token=new t.Object3D,o.position=new t.Vector3(tt,tt,30*N),o.getPosition=function(){return o.token.position},o.getRadius=function(){return 1},o.position.setZ(r*N);var i=o.position;return o.token.position.set(i.x,i.y,i.z),o._sceneEntityGroup.add(o.token),o}s(n,e);var r=n.prototype;return r.init=function(){var e=o(c.mark((function e(){var t=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=o(c.mark((function e(n){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(t._sceneEntityGroup);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.update=function(){},n}(R),rt=function(e){return e instanceof nt?new t.Vector3(0,0,0):e.getPosition()},ot=["MBA","NEO1KM","NOT_NEO1KM","PHA","DISTANTOBJECT"];function it(e){switch(e){case"MBA":return"grey";case"NEO1KM":return"orange";case"NOT_NEO1KM":return"pink";case"PHA":return"red";case"DISTANTOBJECT":return"cyan";case"A":case"C":case"P":return"green"}}function st(e){return URL.createObjectURL(new Blob(['importScripts( "'+e+'" );'],{type:"text/javascript"}))}function at(e,t){return ct.apply(this,arguments)}function ct(){return(ct=o(c.mark((function e(n,r){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=o(c.mark((function e(o){var i,s,a;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i="http://localhost:3001";try{i="https://sbn-solar-system-viewer.s3.amazonaws.com/scripts"}catch(e){}return s=st(i+"/asteroid-belt-worker-0.1.0.js"),_("Start getting worker"),e.next=7,Promise.all(n.map((function(e){return new Promise((function(t){var n=new Worker(s);n.onmessage=function(n){setTimeout((function(){t({belt:e,data:n.data})}),100)},n.postMessage(e)}))})));case 7:a=e.sent,r.updateDisplayedMessage("Loading asteroids belts"),r.setIsScenePaused(!0),setTimeout((function(){var e=a.map((function(e){var n=e.belt,r=JSON.parse(e.data),o=new t.BufferGeometryLoader;return{mergedAsteroidGeometry:o.parse(r.mergedAsteroidGeometry),mergedTailsGeometry:o.parse(r.mergedTailsGeometry),belt:n}}));r.updateDisplayedMessage("Asteroids Loaded"),r.setIsScenePaused(!1),o(e)}),100);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var lt=["A","C","P"],ut=function(){return[].concat(ot,lt).reduce((function(e,n,r){return e[n]=new t.Mesh(new t.BufferGeometry,new t.MeshPhongMaterial({morphTargets:!0})),e}),{})},ht=function(e){function n(n,r){var o;return(o=e.call(this,3e3)||this).belts=n,o.parentSceneManager=r,o.isMeshesLoaded=!1,o.isBeltVisible=!0,o.mergedAsteroidsMeshes=ut(),o.mergedTailsMeshes=ut(),o.getPosition=function(){return new t.Vector3},o.getRadius=function(){return 1},o.NAME="BELTS",o.belts.forEach((function(e){o._sceneEntityGroup.add(o.mergedAsteroidsMeshes[e]),o._sceneEntityGroup.add(o.mergedTailsMeshes[e])})),o.parentSceneManager.updateDisplayedMessage("Building asteroid belt"),o}s(n,e);var r=n.prototype;return r.init=function(){var e=o(c.mark((function e(){var n=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=o(c.mark((function e(r){var o,i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=O+"/misc/rock-texture-512.png",e.next=3,M(o).catch((function(e){return null}));case 3:i=e.sent,at(n.belts,n.parentSceneManager).then((function(e){e.forEach((function(e){var r=e.belt,o=e.mergedAsteroidGeometry,s=e.mergedTailsGeometry,a=it(r);n.mergedAsteroidsMeshes[r].geometry=o,n.mergedAsteroidsMeshes[r].material=new t.MeshPhongMaterial({color:new t.Color(a),map:i,shininess:0,transparent:!0,morphTargets:!0}),n.mergedAsteroidsMeshes[r].material.needsUpdate=!0,n.mergedAsteroidsMeshes[r].morphTargetInfluences=[0],n.mergedTailsMeshes[r].geometry=s,n.mergedTailsMeshes[r].material=new t.MeshPhongMaterial({color:new t.Color(a),transparent:!0,morphTargets:!0}),n.mergedTailsMeshes[r].material.needsUpdate=!0,n.mergedTailsMeshes[r].morphTargetInfluences=[0],_(n.NAME+" LOADED"),n.isMeshesLoaded=!0}))})),_("RESOLVED "+n.NAME),r(n._sceneEntityGroup);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.updateMeshes=function(){var e=this,t=this.getLogInterpolationParam();this.belts.forEach((function(n){e.mergedAsteroidsMeshes[n].morphTargetInfluences[0]=t,e.mergedTailsMeshes[n].morphTargetInfluences[0]=t}))},r.setIsBeltVisible=function(e){var t=this;this.isBeltVisible=e,this.belts.forEach((function(e){t.mergedAsteroidsMeshes[e].visible=t.isBeltVisible,t.mergedTailsMeshes[e].visible=t.isBeltVisible}))},r.toggleIsBeltVisible=function(){this.setIsBeltVisible(!this.isBeltVisible)},r.update=function(e){var n=this;if(this._updateModelScale(),this.isMeshesLoaded&&this.updateMeshes(),e){var r=e.position.distanceTo(new t.Vector3),o=0;(o=(r-4*N)/(.5*N))<0&&(o=0),o>1&&(o=1),this.belts.forEach((function(e){n.isBeltVisible&&(n.mergedTailsMeshes[e].material.opacity=o,n.mergedTailsMeshes[e].visible=0!==o,n.mergedTailsMeshes[e].material.needsUpdate=!0)}))}},n}(R),pt=function(e){Object.keys(e).forEach((function(t){localStorage.setItem(t,JSON.stringify(e[t]))}))},dt=function(e){void 0===e&&(e="placeholder-id"+b());var t=document.createElement("div");t.classList.add("three-column-container"),t.style.setProperty("overflow-x","scroll"),t.style.setProperty("width","100%"),t.style.setProperty("height","34px"),t.style.setProperty("display","flex"),t.style.setProperty("white-space","nowrap"),t.id=e;var n=document.createElement("div");n.classList.add("first-column"),n.style.setProperty("display","flex"),n.style.setProperty("align-items","center"),n.style.setProperty("justify-content","right"),n.style.setProperty("flex","1 0 280px"),n.style.setProperty("padding-right","10px"),n.style.setProperty("overflow-x","scroll"),t.append(n);var r=document.createElement("div");r.classList.add("second-column"),r.style.setProperty("display","flex"),r.style.setProperty("align-items","center"),r.style.setProperty("justify-content","center"),r.style.setProperty("flex","0 0 70px"),t.append(r);var o=document.createElement("div");return o.classList.add("third-column"),o.style.setProperty("display","flex"),o.style.setProperty("align-items","center"),o.style.setProperty("justify-content","left"),o.style.setProperty("flex","1 0 calc(100% - 70px - 280px - 20px)"),o.style.setProperty("padding-left","10px"),t.append(o),{threeColumnContainerDiv:t,firstColumnDiv:n,secondColumnDiv:r,thirdColumnDiv:o}},ft=function(e,t,n,r,o){void 0===o&&(o=function(e){});var i,s=dt(),a=s.threeColumnContainerDiv,c=s.firstColumnDiv,l=s.secondColumnDiv,u=s.thirdColumnDiv,h=(i=P(),{__sbnViewer__isBeltAbundanceToyModel:i.__sbnViewer__isBeltAbundanceToyModel,__sbnViewer__isBeltLoadedBeforeAnimationBegins:i.__sbnViewer__isBeltLoadedBeforeAnimationBegins,__sbnViewer__isPlanetsLoadedBeforeAnimationBegins:i.__sbnViewer__isPlanetsLoadedBeforeAnimationBegins})[r];c.innerHTML="<span>"+e+"</span>",u.innerHTML="<span>"+(h?t:n)+"</span>";var p=document.createElement("label");p.classList.add("switch"),l.append(p);var d=document.createElement("input");d.type="checkbox",d.checked=h,p.append(d);var f=document.createElement("span");return f.classList.add("slider"),p.append(f),d.addEventListener("click",(function(){setTimeout((function(){var e;pt(((e={})[r]=!P()[r],e));var i=d.checked;u.innerHTML=""+(i?t:n),o(i)}),0)})),a},mt=function(e,t){var n=dt(),r=n.threeColumnContainerDiv,o=n.secondColumnDiv;n.firstColumnDiv.innerHTML="<span>"+e+"</span>";var i,s=document.createElement("input");return s.style.setProperty("min-width","10px"),s.style.setProperty("max-width","50px"),s.style.setProperty("min-height","10px"),s.style.setProperty("height","30px"),s.id="input-id-123",s.value=(i=P(),{__sbnViewer__beltAbundanceHThreshold:i.__sbnViewer__beltAbundanceHThreshold,__sbnViewer__beltAbundanceMaxObjects:i.__sbnViewer__beltAbundanceMaxObjects})[t]+"",o.append(s),s.oninput=function(){setTimeout((function(){try{var e,n=parseInt(s.value);pt(((e={})[t]=n,e))}catch(e){alert("Something went horribly wrong with your logic")}}),0)},r};function gt(){var e=document.createElement("div");return e.style.setProperty("width","100%"),e.style.setProperty("height","1px"),e.style.setProperty("background-color","black"),e}var yt,bt="settings-panel-id-"+b(),vt="max-objects-container-div-id-"+b(),wt="threshold-H-container-div-id-"+b(),_t=!1,Et=function(e){function n(n){var r;(r=e.call(this,n)||this).sun=new C,r.isToyScale=!0,r.isOrbitsVisible=!0,r.isLogScale=!0,r.logScalables=[],r.zoomables=[],r.zoomableOrbitals=[],r.zoomTarget=r.sun,r.isZoomingPosition=!1,r.isZoomingAngle=!1,r.zoomTraversalFraction=0,r.zoomClock=new t.Clock,r.isScenePaused=!1,r.updateDisplayedMessage=function(){console.log("denied!")},r.setIsToyScale=function(e){r.isToyScale=!!e,r.toyScalables.forEach((function(e){return e.setIsZoomToToyScale(r.isToyScale)}))},r.toggleIsToyScale=function(){r.isToyScale=!r.isToyScale,r.setIsToyScale(r.isToyScale)},r.setIsOrbitsVisible=function(e){r.isOrbitsVisible=!!e,r.zoomableOrbitals.forEach((function(e){return e instanceof $e||e.setIsOrbitVisible(r.isOrbitsVisible)}))},r.toggleIsOrbitsVisible=function(){r.isOrbitsVisible=!r.isOrbitsVisible,r.setIsOrbitsVisible(r.isOrbitsVisible)},r.toggleAsteroids=function(){r.asteroidBelts.forEach((function(e){return e.toggleIsBeltVisible()}))},r.setIsLogScale=function(e){r.isLogScale=!!e,r.logScalables.forEach((function(e){return e.toggleIsLogScale()})),r.tryToStartZooming(r.isLogScale?"BIRDSEYELOG":"BIRDSEYE")},r.toggleIsLogScale=function(){r.isLogScale=!r.isLogScale,r.setIsLogScale(r.isLogScale)},r.tryToStartZooming=function(e){var n=e.toUpperCase(),o=r.zoomables.find((function(e){return e.NAME===n}));o&&(r.isZoomingPosition=!0,r.isZoomingAngle=!0,r.zoomTarget=o,r.zoomClock=new t.Clock(!0),r._controls.enabled=!0)},r.tryToStopZooming=function(){r.isZoomingAngle||r.isZoomingPosition||(r._controls.target=r.zoomTarget instanceof nt?new t.Vector3(0,0,0):r.zoomTarget.getPosition(),r._controls.enabled=!0)},r.updateCamera=function(){var e,n,o,i,s,a,c,l,u,h,p,d,f,m;if(r._clock.getElapsedTime(),r.isZoomingPosition||r.isZoomingAngle){if(r.zoomTraversalFraction=((n=(e=r.zoomClock.getElapsedTime())*e*e*.01)<0&&(n=0),n>1&&(n=1),n),r.isZoomingPosition&&(r.isZoomingPosition=(s=r._camera,a=r.zoomTraversalFraction,c=function(e){var n=e.getScale(),r=e.getRadius();if("SUN"===e.NAME){var o=e.getPosition();return new t.Vector3(o.x+3*r*n,o.y+3*r*n,o.z)}if(e instanceof nt)return e.getPosition();var i=e.getPosition().clone(),s=2*r*n/i.length(),a=Math.asin(s);i.applyAxisAngle(new t.Vector3(0,0,1),a);var c=(i.length()+4*r*n)/i.length();return i.multiplyScalar(c),i}(r.zoomTarget),d=new t.Vector3((l=c.x)-(p=s.position).x,(u=c.y)-p.y,(h=c.z)-p.z),m=!0,(o=f=new t.Vector3(p.x+d.x*a,p.y+d.y*a,p.z+d.z*a),i=new t.Vector3(l,u,h),new t.Vector3(i.x-o.x,i.y-o.y,i.z-o.z)).length()<1e-4*N&&(m=!1,f=new t.Vector3(l,u,h)),s.position.set(f.x,f.y,f.z),m)),r.isZoomingAngle)r.isZoomingAngle=function(e,n,r){var o=e.position,i=rt(n),s=new t.Vector3(i.x-o.x,i.y-o.y,i.z-o.z),a=e.getWorldDirection(new t.Vector3);a.multiplyScalar(s.length());var c=new t.Vector3(s.x-a.x,s.y-a.y,s.z-a.z),l=new t.Vector3(e.position.x+a.x+c.x*r,e.position.y+a.y+c.y*r,e.position.z+a.z+c.z*r),u=!0;return s.angleTo(a)<.0025&&(u=!1,l=i),e.lookAt(l.x,l.y,l.z),u}(r._camera,r.zoomTarget,r.zoomTraversalFraction);else{var g=rt(r.zoomTarget);r._camera.lookAt(g.x,g.y,g.z)}r.tryToStopZooming()}else r._controls.update()};var o,s,c,l,u,h,p=((l=document.createElement("div")).id="message-field",l.style.setProperty("position","absolute"),l.style.setProperty("left","0%"),l.style.setProperty("right","0px"),l.style.setProperty("bottom","0px"),l.style.setProperty("height","40px"),l.style.setProperty("display","flex"),l.style.setProperty("justify-content","flex-end"),l.style.setProperty("align-items","center"),l.style.setProperty("padding-right","10px"),l.style.setProperty("background-color","rgba(255,255,255,0.1)"),l.style.setProperty("color","white"),{displayMessageDiv:l,updateMessageCb:function(e){l.innerHTML=e}}),d=p.updateMessageCb;r._container.append(p.displayMessageDiv),r.updateDisplayedMessage=d,r.updateDisplayedMessage("Loading..."),r._container.append((o=r.tryToStartZooming,s=document.createElement("div"),c=document.createElement("input"),s.style.setProperty("position","absolute"),s.style.setProperty("top","10px"),s.style.setProperty("left","10px"),s.style.setProperty("width","120px"),s.style.setProperty("height","40px"),s.style.setProperty("background-color","green"),c.value="Earth",c.style.setProperty("width","100%"),c.style.setProperty("height","100%"),c.style.setProperty("font-size","20px"),c.style.setProperty("font-family","'Odibee Sans', cursive"),c.style.setProperty("font-size","20px"),c.classList.add("sbn-solar-system-viewer-input"),c.addEventListener("keypress",(function(e){"Enter"===e.key&&o(c.value)})),s.append(c),s)),r._container.append((u=[{label:"Toggle Toy Scale",cb:r.toggleIsToyScale},{label:"Toggle helpers",cb:r.toggleHelpersVisibility},{label:"Toggle Orbits",cb:r.toggleIsOrbitsVisible},{label:"Toggle Log Scale",cb:r.toggleIsLogScale},{label:"Toggle Asteroids",cb:r.toggleAsteroids}],(h=document.createElement("div")).style.setProperty("display","flex"),h.style.setProperty("flex-direction","column"),h.style.setProperty("gap","12px"),h.style.setProperty("position","absolute"),h.style.setProperty("top","100px"),h.style.setProperty("bottom","100px"),h.style.setProperty("right","0px"),h.style.setProperty("width","120px"),u.map((function(e){var t,n,r=document.createElement("div");return r.innerText=e.label,r.style.setProperty("display","flex"),r.style.setProperty("flex","1"),r.style.setProperty("justify-content","center"),r.style.setProperty("align-items","center"),n=e.cb,(t=r).style.setProperty("color","rgba(255,255,255,0.8)"),t.style.setProperty("background-color","rgba(255,255,255,0.2)"),t.style.setProperty("font-family","'Odibee Sans', cursive"),t.style.setProperty("font-size","20px"),t.style.setProperty("animation","sbn-solar-system-viewer-fade-in 1s ease-in-out"),t.style.setProperty("cursor","pointer"),t.style.setProperty("-webkit-touch-callout","none"),t.style.setProperty("-webkit-user-select","none"),t.style.setProperty("-khtml-user-select","none"),t.style.setProperty("-moz-user-select","none"),t.style.setProperty("-ms-user-select","none"),t.style.setProperty("user-select","none"),t.style.setProperty("transition","background-color 50ms ease-in-out"),t.addEventListener("click",(function(){t.style.setProperty("background-color","rgba(255,255,255,0.4)"),setTimeout((function(){t.style.setProperty("background-color","rgba(255,255,255,0.2)"),n()}),200)})),t})).forEach((function(e){h.append(e)})),h.id="buttons-wrapper",h));var m=function(){var e=document.createElement("div");e.id=bt,e.style.setProperty("position","absolute"),e.style.setProperty("top","0px"),e.style.setProperty("right",_t?"0%":"100%"),e.style.setProperty("left","0px"),e.style.setProperty("bottom","0px"),e.style.setProperty("transition","right 1s ease-in-out"),e.style.setProperty("overflow","hidden"),e.style.setProperty("font-family",'"Odibee Sans", cursive'),e.style.setProperty("font-size","22px"),e.style.setProperty("background-color","rgba(255,255,255,0.9)"),e.style.setProperty("color","black"),e.style.setProperty("display","flex"),e.style.setProperty("flex-direction","column"),e.style.setProperty("gap","5px"),e.style.setProperty("justify-content","start"),e.style.setProperty("align-items","center");var t=dt(),n=t.threeColumnContainerDiv;t.secondColumnDiv.innerHTML="<h1>Settings</h1>",n.style.setProperty("height","100px"),e.append(n),e.append(gt());var r=ft("Planet loading mode?","Load planets before animation begins","Begin animation then load planets","__sbnViewer__isPlanetsLoadedBeforeAnimationBegins");e.append(r),e.append(gt());var o=ft("Comet-Asteroid Loading Mode?","Start animation then load comets-asteroids","Wait for comets-asteroids before starting animation","__sbnViewer__isBeltLoadedBeforeAnimationBegins");e.append(o),e.append(gt());var i=ft("Comet-Asteroid Abundance Mode?","Toy Model","Real World Proportions","__sbnViewer__isBeltAbundanceToyModel",(function(e){var t=document.getElementById(vt);t&&t.style.setProperty("display",e?"none":"flex");var n=document.getElementById(wt);n&&n.style.setProperty("display",e?"none":"flex")}));e.append(i);var s=P().__sbnViewer__isBeltAbundanceToyModel,a=mt("Max number of objects","__sbnViewer__beltAbundanceMaxObjects");a.style.setProperty("display",s?"none":"flex"),a.id=vt,e.append(a);var c=mt("Minimum H Mag","__sbnViewer__beltAbundanceHThreshold");return c.id=wt,c.style.setProperty("display",s?"none":"flex"),e.append(c),e.append(gt()),{toggleSettingsPanelCb:function(){e.style.setProperty("right",(_t=!_t)?"0%":"100%")},settingsPanelDiv:e}}(),g=m.toggleSettingsPanelCb;r._container.append(m.settingsPanelDiv);var y=function(e){var t,n,r,o,s,a=document.createElement("div");return a.style.setProperty("position","absolute"),a.style.setProperty("top","0px"),a.style.setProperty("right","0px"),a.style.setProperty("height","70px"),a.style.setProperty("width","70px"),a.style.setProperty("display","flex"),a.style.setProperty("justify-content","center"),a.style.setProperty("align-items","center"),a.style.setProperty("z-index","2"),a.append((n=(t=i({sizePxls:18,color:"black",isOutlined:!1},{color:"white",sizePxls:50})).sizePxls,r=t.isOutlined,o=t.color,(s=document.createElement("span")).innerHTML="settings",s.classList.add(r?"material-icons-outlined":"material-icons"),s.style.setProperty("font-size",n+"px"),s.style.setProperty("color",o),s.style.setProperty("cursor","pointer"),s)),a.addEventListener("click",e),a}(g);return r._container.append(y),r.birdsEyes=[new nt,new nt("BIRDSEYELOG",5)],r.planets=[new Ze("MERCURY"),new Ze("VENUS"),new Ze("EARTH"),new Ze("MARS"),new Ze("CERES"),new Ze("JUPITER"),new Ze("SATURN"),new Ze("URANUS"),new Ze("NEPTUNE"),new Ze("PLUTO"),new Ze("HAUMEA"),new Ze("MAKEMAKE"),new Ze("ERIS")],r.asteroids=[],r.asteroidBelts=[new ht(["DISTANTOBJECT","MBA","NEO1KM","PHA","C"],a(r))],r.starField=new qe(f(999)),r.zoomables=[].concat(r.planets,r.asteroids,r.birdsEyes,[r.sun]),r.zoomableOrbitals=[].concat(r.planets,r.asteroids),r.toyScalables=[].concat(r.planets,r.asteroids,r.asteroidBelts,[r.sun]),r.logScalables=[].concat(r.planets,r.asteroids,r.asteroidBelts),_("Begin registering entities"),r.registerSceneEntities([new We,new Je(.4),new et(5,S.SUN.radiusMeters)].concat(r.planets,r.asteroids,r.asteroidBelts,[r.sun])),_("Finish registering entities"),r._preInitHook=function(){var e=f(4);r._initialViewingVector=new t.Vector3(0,0,e)},r._postInitHook=function(){r._controls.maxDistance=f(100),r.setHelpersVisibility(!1),r._camera.position.set(35426284497.8745,-725267146538.4939,-111665855099.58893)},setTimeout((function(){r.setIsToyScale(!0),r.tryToStartZooming("BIRDSEYE"),r.setIsLogScale(!0)}),3500),r._camera.up.set(1,1,1),r._destroyHook=function(){},r}return s(n,e),n.prototype.setIsScenePaused=function(e){this.isScenePaused=e,this.isScenePaused?(this._clock.stop(),this.setIsLoaderDivVisible(!0,0)):(this._clock.start(),this.setIsLoaderDivVisible(!1,0))},n}(x),Tt=[],xt=function(e){if(!Tt.includes(e)){Tt.push(e);var t=document.createElement("link");t.rel="stylesheet",t.href="https://fonts.googleapis.com/"+e,document.head.append(t)}},Mt=!1,St=function(){if(!Mt){Mt=!0;var e=document.createElement("style");e.innerHTML='\n    @keyframes sbn-solar-system-viewer-fade-in {\n      from { opacity: 0; }\n      to   { opacity: 1; }\n    }\n\n    @keyframes sbn-solar-system-viewer-loader-spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n\n    .sbn-solar-system-viewer-input:focus{\n        outline-width: 0;\n    }\n\n    /**\n     *\n     * This is for styling the switches\n     *\n     */\n    .three-column-container {\n      width: 100%;\n      height: 34px;\n      display: flex;\n      white-space: nowrap;\n    }\n\n    .three-column-container .switch {\n      position: relative;\n      display: inline-block;\n      width: 60px;\n      height: 34px;\n    }\n\n    /* Hide default HTML checkbox */\n    .three-column-container .switch input {\n      opacity: 0;\n      width: 0;\n      height: 0;\n    }\n\n    /* The slider */\n    .three-column-container .slider {\n      position: absolute;\n      cursor: pointer;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: #ccc;\n      background-color: red;\n      -webkit-transition: .4s;\n      transition: .4s;\n    }\n\n    .three-column-container .slider:before {\n      position: absolute;\n      content: "";\n      height: 26px;\n      width: 26px;\n      left: 4px;\n      bottom: 4px;\n      background-color: white;\n      -webkit-transition: .4s;\n      transition: .4s;\n    }\n\n    .three-column-container input:checked + .slider {\n      background-color: #2196F3;\n      background-color: blue;\n    }\n\n    .three-column-container input:focus + .slider {\n      box-shadow: 0 0 1px #2196F3;\n    }\n\n    .three-column-container input:checked + .slider:before {\n      -webkit-transform: translateX(26px);\n      -ms-transform: translateX(26px);\n      transform: translateX(26px);\n    }\n  ',document.head.append(e)}},At=!1,Pt=function(){var e=o(c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!At){e.next=2;break}return e.abrupt("return");case 2:At=!0,St(),xt("css2?family=Odibee+Sans"),xt("icon?family=Material+Icons"),xt("icon?family=Material+Icons+Outlined"),"128"!==window.__THREE__&&console.log("This is not supposed to happen!");case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e.initDate=new Date;var Lt=function(t){return e.initDate=t},Rt=function(){return e.initDate};e.destroy=function(){yt.destroy()},e.getInitDate=Rt,e.init=function(e){void 0===e&&(e="sbn-solar-system-viewer-id"),Pt().then((function(t){if(!document.getElementById(e))throw new Error("Can't find div of id "+e);(yt=new Et(e)).init()})).catch((function(e){console.log("Error loading stuff"),console.log(e)}))},e.setInitDate=Lt,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sbnsolarsystemviewer.umd.production.min.js.map
