!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("julian"),require("react")):"function"==typeof define&&define.amd?define(["exports","three","julian","react"],t):t((e=e||self).SbnSolarSystemViewer={},e.THREE,e.julian,e.React)}(this,(function(e,t,n,r){"use strict";function o(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){o(s,r,i,a,c,"next",e)}function c(e){o(s,r,i,a,c,"throw",e)}a(void 0)}))}}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;var c={isAsyncLoad:!0},l=function(){return c},u=function(e){return c=s({},c,e)},h=function(e,t){return function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var o=Object.create((t&&t.prototype instanceof h?t:h).prototype),i=new T(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var a=w(s,n);if(a){if(a===u)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,i),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function h(){}function p(){}function d(){}var m={};m[o]=function(){return this};var f=Object.getPrototypeOf,g=f&&f(f(M([])));g&&g!==t&&n.call(g,o)&&(m=g);var y=d.prototype=h.prototype=Object.create(m);function _(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){var r;this._invoke=function(o,i){function s(){return new t((function(r,s){!function r(o,i,s,a){var c=l(e[o],e,i);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,a)}))}a(c.arg)}(o,i,r,s)}))}return r=r?r.then(s,s):s()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function M(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:S}}function S(){return{value:void 0,done:!0}}return p.prototype=y.constructor=d,d.constructor=p,p.displayName=a(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},_(v.prototype),v.prototype[i]=function(){return this},e.AsyncIterator=v,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var s=new v(c(t,n,r,o),i);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},_(y),a(y,s,"Generator"),y[o]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var a=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(t={exports:{}}),t.exports}();const p={type:"change"},d={type:"start"},m={type:"end"};class f extends t.EventDispatcher{constructor(e,n){super(),void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=n,this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=Infinity,this.minZoom=0,this.maxZoom=Infinity,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-Infinity,this.maxAzimuthAngle=Infinity,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.touches={ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",z),this._domElementKeyEvents=e},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(p),r.update(),i=o.NONE},this.update=function(){const n=new t.Vector3,d=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),m=d.clone().invert(),f=new t.Vector3,g=new t.Quaternion,y=2*Math.PI;return function(){const e=r.object.position;n.copy(e).sub(r.target),n.applyQuaternion(d),a.setFromVector3(n),r.autoRotate&&i===o.NONE&&S(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(a.theta+=c.theta*r.dampingFactor,a.phi+=c.phi*r.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let t=r.minAzimuthAngle,_=r.maxAzimuthAngle;return isFinite(t)&&isFinite(_)&&(t<-Math.PI?t+=y:t>Math.PI&&(t-=y),_<-Math.PI?_+=y:_>Math.PI&&(_-=y),a.theta=t<=_?Math.max(t,Math.min(_,a.theta)):a.theta>(t+_)/2?Math.max(t,a.theta):Math.min(_,a.theta)),a.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=l,a.radius=Math.max(r.minDistance,Math.min(r.maxDistance,a.radius)),!0===r.enableDamping?r.target.addScaledVector(u,r.dampingFactor):r.target.add(u),n.setFromSpherical(a),n.applyQuaternion(m),e.copy(r.target).add(n),r.object.lookAt(r.target),!0===r.enableDamping?(c.theta*=1-r.dampingFactor,c.phi*=1-r.dampingFactor,u.multiplyScalar(1-r.dampingFactor)):(c.set(0,0,0),u.set(0,0,0)),l=1,!!(h||f.distanceToSquared(r.object.position)>s||8*(1-g.dot(r.object.quaternion))>s)&&(r.dispatchEvent(p),f.copy(r.object.position),g.copy(r.object.quaternion),h=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",Z),r.domElement.removeEventListener("pointerdown",j),r.domElement.removeEventListener("wheel",V),r.domElement.removeEventListener("touchstart",K),r.domElement.removeEventListener("touchend",X),r.domElement.removeEventListener("touchmove",Y),r.domElement.ownerDocument.removeEventListener("pointermove",G),r.domElement.ownerDocument.removeEventListener("pointerup",B),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",z)};const r=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=o.NONE;const s=1e-6,a=new t.Spherical,c=new t.Spherical;let l=1;const u=new t.Vector3;let h=!1;const f=new t.Vector2,g=new t.Vector2,y=new t.Vector2,_=new t.Vector2,v=new t.Vector2,w=new t.Vector2,b=new t.Vector2,E=new t.Vector2,T=new t.Vector2;function M(){return Math.pow(.95,r.zoomSpeed)}function S(e){c.theta-=e}function x(e){c.phi-=e}const A=function(){const e=new t.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),u.add(e)}}(),P=function(){const e=new t.Vector3;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),u.add(e)}}(),L=function(){const e=new t.Vector3;return function(t,n){const o=r.domElement;if(r.object.isPerspectiveCamera){e.copy(r.object.position).sub(r.target);let i=e.length();i*=Math.tan(r.object.fov/2*Math.PI/180),A(2*t*i/o.clientHeight,r.object.matrix),P(2*n*i/o.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(A(t*(r.object.right-r.object.left)/r.object.zoom/o.clientWidth,r.object.matrix),P(n*(r.object.top-r.object.bottom)/r.object.zoom/o.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function R(e){r.object.isPerspectiveCamera?l/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function O(e){r.object.isPerspectiveCamera?l*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function I(e){f.set(e.clientX,e.clientY)}function N(e){_.set(e.clientX,e.clientY)}function C(e){1==e.touches.length?f.set(e.touches[0].pageX,e.touches[0].pageY):f.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY))}function k(e){1==e.touches.length?_.set(e.touches[0].pageX,e.touches[0].pageY):_.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY))}function U(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);b.set(0,r)}function D(e){1==e.touches.length?g.set(e.touches[0].pageX,e.touches[0].pageY):g.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY)),y.subVectors(g,f).multiplyScalar(r.rotateSpeed);const t=r.domElement;S(2*Math.PI*y.x/t.clientHeight),x(2*Math.PI*y.y/t.clientHeight),f.copy(g)}function H(e){1==e.touches.length?v.set(e.touches[0].pageX,e.touches[0].pageY):v.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY)),w.subVectors(v,_).multiplyScalar(r.panSpeed),L(w.x,w.y),_.copy(v)}function F(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);E.set(0,o),T.set(0,Math.pow(E.y/b.y,r.zoomSpeed)),R(T.y),b.copy(E)}function j(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){let n;switch(e.preventDefault(),r.domElement.focus?r.domElement.focus():window.focus(),e.button){case 0:n=r.mouseButtons.LEFT;break;case 1:n=r.mouseButtons.MIDDLE;break;case 2:n=r.mouseButtons.RIGHT;break;default:n=-1}switch(n){case t.MOUSE.DOLLY:if(!1===r.enableZoom)return;!function(e){b.set(e.clientX,e.clientY)}(e),i=o.DOLLY;break;case t.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;N(e),i=o.PAN}else{if(!1===r.enableRotate)return;I(e),i=o.ROTATE}break;case t.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;I(e),i=o.ROTATE}else{if(!1===r.enablePan)return;N(e),i=o.PAN}break;default:i=o.NONE}i!==o.NONE&&(r.domElement.ownerDocument.addEventListener("pointermove",G),r.domElement.ownerDocument.addEventListener("pointerup",B),r.dispatchEvent(d))}(e)}}function G(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1!==r.enabled)switch(e.preventDefault(),i){case o.ROTATE:if(!1===r.enableRotate)return;!function(e){g.set(e.clientX,e.clientY),y.subVectors(g,f).multiplyScalar(r.rotateSpeed);const t=r.domElement;S(2*Math.PI*y.x/t.clientHeight),x(2*Math.PI*y.y/t.clientHeight),f.copy(g),r.update()}(e);break;case o.DOLLY:if(!1===r.enableZoom)return;!function(e){E.set(e.clientX,e.clientY),T.subVectors(E,b),T.y>0?R(M()):T.y<0&&O(M()),b.copy(E),r.update()}(e);break;case o.PAN:if(!1===r.enablePan)return;!function(e){v.set(e.clientX,e.clientY),w.subVectors(v,_).multiplyScalar(r.panSpeed),L(w.x,w.y),_.copy(v),r.update()}(e)}}(e)}}function B(e){switch(e.pointerType){case"mouse":case"pen":r.domElement.ownerDocument.removeEventListener("pointermove",G),r.domElement.ownerDocument.removeEventListener("pointerup",B),!1!==r.enabled&&(r.dispatchEvent(m),i=o.NONE)}}function V(e){!1===r.enabled||!1===r.enableZoom||i!==o.NONE&&i!==o.ROTATE||(e.preventDefault(),r.dispatchEvent(d),function(e){e.deltaY<0?O(M()):e.deltaY>0&&R(M()),r.update()}(e),r.dispatchEvent(m))}function z(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:L(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:L(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:L(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:L(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function K(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(r.touches.ONE){case t.TOUCH.ROTATE:if(!1===r.enableRotate)return;C(e),i=o.TOUCH_ROTATE;break;case t.TOUCH.PAN:if(!1===r.enablePan)return;k(e),i=o.TOUCH_PAN;break;default:i=o.NONE}break;case 2:switch(r.touches.TWO){case t.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&U(e),r.enablePan&&k(e)}(e),i=o.TOUCH_DOLLY_PAN;break;case t.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&U(e),r.enableRotate&&C(e)}(e),i=o.TOUCH_DOLLY_ROTATE;break;default:i=o.NONE}break;default:i=o.NONE}i!==o.NONE&&r.dispatchEvent(d)}}function Y(e){if(!1!==r.enabled)switch(e.preventDefault(),i){case o.TOUCH_ROTATE:if(!1===r.enableRotate)return;D(e),r.update();break;case o.TOUCH_PAN:if(!1===r.enablePan)return;H(e),r.update();break;case o.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&F(e),r.enablePan&&H(e)}(e),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&F(e),r.enableRotate&&D(e)}(e),r.update();break;default:i=o.NONE}}function X(e){!1!==r.enabled&&(r.dispatchEvent(m),i=o.NONE)}function Z(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",Z),r.domElement.addEventListener("pointerdown",j),r.domElement.addEventListener("wheel",V,{passive:!1}),r.domElement.addEventListener("touchstart",K,{passive:!1}),r.domElement.addEventListener("touchend",X),r.domElement.addEventListener("touchmove",Y,{passive:!1}),this.update()}}function g(e){return"\n\n   ______________________________    . \\  | / .\n  /                            / \\     \\ \\ / /\n |                            | ==========  - -\n  \\____________________________\\_/     / / \\ \\\n  ______________________________      \\  | / | \\\n /                            / \\     \\ \\ / /.   .\n|                            | ==========  - -\n \\____________________________\\_/     / / \\ \\    /\n   ______________________________   / |\\  | /  .\n  /                            / \\     \\ \\ / /\n |                            | ==========  -  - -\n  \\____________________________\\_/     / / \\ \\\n                                     .  / | \\  .\n\n  Are you trying to wreak havoc on the Universe!?!\n\n  "+e+"\n\n  Idiot.\n\n  "}function y(e){return 149597870700*e}var _=function(){var e=document.createElement("style");e.innerHTML="\n    @keyframes sbn-solar-system-viewer-fade-in {\n      from { opacity: 0; }\n      to   { opacity: 1; }\n    }\n\n    @keyframes sbn-solar-system-viewer-loader-spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n\n    .sbn-solar-system-viewer-input:focus{\n        outline-width: 0;\n    }\n  ",document.head.append(e)},v=function(e){_();var t=document.createElement("div"),n=document.createElement("div");e.append(t),t.append(n),t.id="sbn-solar-system-loader-div-id",t.style.setProperty("position","absolute"),t.style.setProperty("top","0px"),t.style.setProperty("left","0px"),t.style.setProperty("bottom","0px"),t.style.setProperty("right","0px"),t.style.setProperty("display","flex"),t.style.setProperty("align-items","center"),t.style.setProperty("justify-content","center");var r=t.offsetWidth,o=t.offsetHeight,i=r<o?r:o;return n.style.setProperty("width",.25*i+"px"),n.style.setProperty("height",.25*i+"px"),n.style.setProperty("border","5px solid #f3f3f3"),n.style.setProperty("border-top","5px solid #3498db"),n.style.setProperty("border-radius","100px"),n.style.setProperty("animation","sbn-solar-system-viewer-loader-spin 2000ms linear infinite"),t},w=function(){var e=document.getElementById("sbn-solar-system-loader-div-id");null==e||e.style.setProperty("transition","opacity 3000ms ease-in-out"),null==e||e.style.setProperty("opacity","0"),setTimeout((function(){null==e||e.style.setProperty("display","none")}),3e3)},b=y(1e-5),E=y(3e3),T=function(){function e(e){var n=this;this._containerId=e,this._scene=new t.Scene,this._canvas=document.createElement("canvas"),this._clock=new t.Clock(!1),this._initialViewingVector=new t.Vector3,this._isSceneReady=!1,this._isRendering=!1,this._isHelpersShown=!1,this._isInit=!1,this._fps=60,this._camera=new t.PerspectiveCamera(60,2,b,E),this._sceneEntities=[],this._preInitHook=function(){},this._postInitHook=function(){},this._destroyHook=function(){},this.updateCamera=function(){},this.registerSceneEntities=function(e){e.forEach((function(e){return n._sceneEntities.push(e)}))},this.setHelpersVisibility=function(e){n._isHelpersShown=!!e,n._scene.traverse((function(e){return e.userData.isHelper&&(e.visible=n._isHelpersShown)}))},this.toggleHelpersVisibility=function(){n._isHelpersShown=!n._isHelpersShown,n.setHelpersVisibility(n._isHelpersShown)},this._updateCameraAspect=function(){n._canvas.style.width="100%",n._canvas.style.height="100%";var e=n._canvas.offsetWidth||1,t=n._canvas.offsetHeight||1;n._camera.aspect=e/t,n._camera.updateProjectionMatrix(),n._renderer.setSize(e,t)},this.destroy=function(){window.removeEventListener("resize",n._updateCameraAspect),n._stopRendering(),n._destroyHook()},this._render=function(){n._isRendering&&setTimeout((function(){n._requestAnimationFrameId=requestAnimationFrame(n._render),n._update()}),1e3/n._fps)},this._startRendering=function(){console.log("Starting animation..."),n._isRendering=!0,n._clock.start(),n._render()},this._stopRendering=function(){console.log("Stopping animation..."),n._isRendering=!1,n._clock.stop()}}var n=e.prototype;return n.init=function(){var e=i(h.mark((function e(){var n,r,o=this;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isInit){e.next=2;break}return e.abrupt("return");case 2:if(this._isInit=!0,Je(new Date),this._preInitHook(),this._container=document.getElementById(this._containerId),this._container){e.next=8;break}throw new Error("No container found with id: "+this._containerId);case 8:if(this._canvas.style.width="100%",this._canvas.style.height="100%",this._container.append(this._canvas),this._container.style.setProperty("position","relative"),this._container.style.setProperty("background-color","black"),v(this._container),window.addEventListener("resize",this._updateCameraAspect),n=window.devicePixelRatio?window.devicePixelRatio:1,this._renderer=new t.WebGLRenderer({canvas:this._canvas,antialias:!0,alpha:!0}),this._renderer.setPixelRatio(n),this._renderer.sortObjects=!1,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=t.PCFSoftShadowMap,this._renderer.outputEncoding=t.GammaEncoding,this._camera.position.copy(this._initialViewingVector),this._camera.up=new t.Vector3(0,0,1),this._camera.lookAt(0,0,0),this._controls=new f(this._camera,this._renderer.domElement),this._controls.enableDamping=!0,this._controls.dampingFactor=.25,this._controls.target=new t.Vector3,this._sceneEntities.length){e.next=31;break}throw new Error(g("You have no scene entities!"));case 31:return e.next=33,Promise.all(this._sceneEntities.map(function(){var e=i(h.mark((function e(t){var n;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.init();case 2:if((n=e.sent)&&n.children.length){e.next=5;break}throw new Error(g('\n            -----------------------------------------------------------------------------\n            The scene entity "'+t.constructor.name+'" has empty sceneEntityGroup\n            after initialization!!!\n            -----------------------------------------------------------------------------\n            '));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return new Promise((function(t){return setTimeout((function(){return t(e)}),100)}))})).then((function(e){return e}));case 33:e.sent.forEach((function(e){return o._scene.add(e)})),this.setHelpersVisibility(!1),this._updateCameraAspect(),this._startRendering(),this._postInitHook(),w(),r=+new Date-+Qe(),console.log("Finished initiating",r);case 42:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.setFramesPerSecond=function(e){e<=0||e>100||(this._fps=e)},n._update=function(){if(this._sceneEntities.forEach((function(e){return e.update()})),this.updateCamera(),!this._camera||!this._renderer)throw new Error("Poor Logic");this._requestAnimationFrameId&&this._renderer.render(this._scene,this._camera)},e}(),M="https://sbn-solar-system-viewer.s3.amazonaws.com",S=function(e,t,n){_();var r=document.createElement("link");function o(){e.style.position="absolute",e.style.setProperty("padding","10px"),e.style.setProperty("color","rgba(255,255,255,0.8)"),e.style.setProperty("background-color","rgba(255,255,255,0.2)"),e.style.setProperty("font-family","'Odibee Sans', cursive"),e.style.setProperty("font-size","20px"),e.style.setProperty("animation","sbn-solar-system-viewer-fade-in 1s ease-in-out"),e.style.setProperty("cursor","pointer"),e.style.setProperty("-webkit-touch-callout","none"),e.style.setProperty("-webkit-user-select","none"),e.style.setProperty("-khtml-user-select","none"),e.style.setProperty("-moz-user-select","none"),e.style.setProperty("-ms-user-select","none"),e.style.setProperty("user-select","none"),e.style.setProperty("transition","background-color 50ms ease-in-out"),e.addEventListener("click",(function(){e.style.setProperty("background-color","rgba(255,255,255,0.4)"),setTimeout((function(){e.style.setProperty("background-color","rgba(255,255,255,0.2)"),n()}),200)})),t.append(e)}r.rel="stylesheet",r.onload=function(){o()},r.onerror=function(){console.log("Failed to load css url for fonts; continuing anyway..."),o()},r.href="https://fonts.googleapis.com/css2?family=Odibee+Sans",document.head.append(r)},x=function(e,n){return new Promise((function(r,o){(new t.TextureLoader).load(e,(function(e){e.encoding=t.GammaEncoding,setTimeout((function(){return r(e)}),5)}),(function(e){return console.log(n+" "+e.loaded/e.total*100+"%")}),(function(){console.log("Failed to load: ",e),o(new Error("Failed to load: "+e))}))}))},A={SUN:{radiusMeters:696342e3,periodDays:void 0},MERCURY:{radiusMeters:2439700,periodDays:87.9691},VENUS:{radiusMeters:6051800,periodDays:224.701},EARTH:{radiusMeters:6378e3,periodDays:365.256},MARS:{radiusMeters:3389500,periodDays:686.971},CERES:{radiusMeters:47e4,periodDays:1683.14570801},JUPITER:{radiusMeters:71492e3,periodDays:4332.59},SATURN:{radiusMeters:60268e3,periodDays:10759.22},URANUS:{radiusMeters:25362e3,periodDays:30688.5},NEPTUNE:{radiusMeters:24764e3,periodDays:60182},PLUTO:{radiusMeters:1188300,periodDays:90560},HAUMEA:{radiusMeters:62e4,periodDays:103410},MAKEMAKE:{radiusMeters:72e4,periodDays:111845},ERIS:{radiusMeters:1163e3,periodDays:204199},MOON:{radiusMeters:35e4,periodDays:29.5}},P=function e(){var n=this;this._isAsyncLoad=function(){return e._isAsyncLoad},this._sceneEntityGroup=new t.Group,this.getSceneEntityGroup=function(){return n._sceneEntityGroup}};P._isAsyncLoad=l().isAsyncLoad;var L,R=function(e){function t(t){var n;return(n=e.call(this)||this)._toyScale=t,n._realScale=1,n._isZoomToToyScale=!1,n}a(t,e);var n=t.prototype;return n.setIsZoomToToyScale=function(e){this._isZoomToToyScale=e},n.getScale=function(){return this._isZoomToToyScale?this._toyScale:this._realScale},n._setToToyScale=function(){if(this._toyModel){this._isZoomToToyScale=!0;var e=this._toyScale;this._toyModel.scale.set(e,e,e)}},n._updateModelScale=function(){if(this._toyModel){var e=this._isZoomToToyScale?this._toyScale:this._realScale,t=this._toyModel.scale,n=t.x,r=t.y,o=t.z;if(n!==e){var i=this._toyScale/100;n<e&&this._toyModel.scale.set(n+i,r+i,o+i),n>e&&this._toyModel.scale.set(n-i,r-i,o-i),Math.abs(n-e)<i&&this._toyModel.scale.set(e,e,e)}}},t}(P),O=function(e){function n(){var n;return(n=e.call(this,30)||this).NAME="SUN",n.position=new t.Vector3(0,0,0),n.sunRadiusMeters=A.SUN.radiusMeters,n.model=new t.Group,n.sprite=new t.Sprite(new t.SpriteMaterial({blending:t.AdditiveBlending,transparent:!0,visible:!1})),n.getRadius=function(){return n.sunRadiusMeters},n.getPosition=function(){return n.position},n.sprite.scale.multiplyScalar(20*n.sunRadiusMeters),n.model.add(n.sprite),n.helper=new t.LineSegments(new t.EdgesGeometry(new t.SphereGeometry(n.sunRadiusMeters,32)),new t.LineBasicMaterial({color:new t.Color("cyan")})),n.helper.userData.isHelper=!0,n.helper.rotateX(Math.PI/2),n.model.add(n.helper),n}a(n,e);var r=n.prototype;return r.init=function(){var e=i(h.mark((function e(){var t=this;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=i(h.mark((function e(n){var r,o;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=M+"/stars/sun3-sprite-512.png",o=function(e){t.sprite.material.map=e,t.sprite.material.needsUpdate=!0,t.sprite.material.visible=!0},!t._isAsyncLoad()){e.next=6;break}x(r,"SUN SPRITE IMAGE").then(o).catch((function(e){return null})),e.next=11;break;case 6:return e.t0=o,e.next=9,x(r).catch((function(e){return null}));case 9:e.t1=e.sent,(0,e.t0)(e.t1);case 11:t._toyModel=t.model,t._sceneEntityGroup.name=t.NAME,t._sceneEntityGroup.add(t.model),console.log("Sun resolved",+new Date-+Qe()),n(t._sceneEntityGroup);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.update=function(){this._updateModelScale()},n}(R);!function(e){e.PLANET="PLANET",e.DWARF_PLANET="DWARF_PLANET",e.SUN="SUN",e.ASTEROID="ASTEROID"}(L||(L={}));class I extends t.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new D(e)})),this.register((function(e){return new F(e)})),this.register((function(e){return new j(e)})),this.register((function(e){return new H(e)})),this.register((function(e){return new k(e)})),this.register((function(e){return new G(e)}))}load(e,n,r,o){const i=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:t.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){o?o(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},c=new t.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,(function(t){try{i.parse(t,s,(function(t){n(t),i.manager.itemEnd(e)}),a)}catch(e){a(e)}}),r,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,r,o){let i;const s={},a={};if("string"==typeof e)i=e;else if(t.LoaderUtils.decodeText(new Uint8Array(e,0,4))===B){try{s[C.KHR_BINARY_GLTF]=new V(e)}catch(e){return void(o&&o(e))}i=s[C.KHR_BINARY_GLTF].content}else i=t.LoaderUtils.decodeText(new Uint8Array(e));const c=JSON.parse(i);if(void 0===c.asset||c.asset.version[0]<2)return void(o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new ue(c,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);a[t.name]=t,s[t.name]=!0}if(c.extensionsUsed)for(let e=0;e<c.extensionsUsed.length;++e){const t=c.extensionsUsed[e],n=c.extensionsRequired||[];switch(t){case C.KHR_MATERIALS_UNLIT:s[t]=new U;break;case C.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[t]=new X;break;case C.KHR_DRACO_MESH_COMPRESSION:s[t]=new z(c,this.dracoLoader);break;case C.KHR_TEXTURE_TRANSFORM:s[t]=new K;break;case C.KHR_MESH_QUANTIZATION:s[t]=new Z;break;default:n.indexOf(t)>=0&&void 0===a[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(a),l.parse(r,o)}}function N(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const C={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class k{constructor(e){this.parser=e,this.name=C.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const n=this.parser,r="light:"+e;let o=n.cache.get(r);if(o)return o;const i=n.json,s=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let a;const c=new t.Color(16777215);void 0!==s.color&&c.fromArray(s.color);const l=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new t.DirectionalLight(c),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new t.PointLight(c),a.distance=l;break;case"spot":a=new t.SpotLight(c),a.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,void 0!==s.intensity&&(a.intensity=s.intensity),a.name=n.createUniqueName(s.name||"light_"+e),o=Promise.resolve(a),n.cache.add(r,o),o}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then((function(e){return n._getNodeRef(t.cache,o,e)}))}}class U{constructor(){this.name=C.KHR_MATERIALS_UNLIT}getMaterialType(){return t.MeshBasicMaterial}extendParams(e,n,r){const o=[];e.color=new t.Color(1,1,1),e.opacity=1;const i=n.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==i.baseColorTexture&&o.push(r.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(o)}}class D{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,n){const r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],s=o.extensions[this.name];if(void 0!==s.clearcoatFactor&&(n.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&i.push(r.assignTexture(n,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(n.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&i.push(r.assignTexture(n,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(i.push(r.assignTexture(n,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){const e=s.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new t.Vector2(e,-e)}return Promise.all(i)}}class H{constructor(e){this.parser=e,this.name=C.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],i=r.extensions[this.name];return void 0!==i.transmissionFactor&&(t.transmission=i.transmissionFactor),void 0!==i.transmissionTexture&&o.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(o)}}class F{constructor(e){this.parser=e,this.name=C.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const o=n.images[r.extensions[this.name].source],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o,i)}}class j{constructor(e){this.parser=e,this.name=C.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;const i=r.images[o.extensions[t].source];let s=n.textureLoader;if(i.uri){const e=n.options.manager.getHandler(i.uri);null!==e&&(s=e)}return this.detectSupport().then((function(o){if(o)return n.loadTextureImage(e,i,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class G{constructor(e){this.name=C.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,o.ready]).then((function(t){const n=e.byteOffset||0,r=e.byteLength||0,i=e.count,s=e.byteStride,a=new ArrayBuffer(i*s),c=new Uint8Array(t[0],n,r);return o.decodeGltfBuffer(new Uint8Array(a),i,s,c,e.mode,e.filter),a}))}return null}}const B="glTF";class V{constructor(e){this.name=C.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,12);if(this.header={magic:t.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==B)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,o=new DataView(e,12);let i=0;for(;i<r;){const n=o.getUint32(i,!0);i+=4;const r=o.getUint32(i,!0);if(i+=4,1313821514===r){const r=new Uint8Array(e,12+i,n);this.content=t.LoaderUtils.decodeText(r)}else if(5130562===r){const t=12+i;this.body=e.slice(t,t+n)}i+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class z{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=C.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,s={},a={},c={};for(const e in i){const t=ee[e]||e.toLowerCase();s[t]=i[e]}for(const t in e.attributes){const r=ee[t]||t.toLowerCase();if(void 0!==i[t]){const o=n.accessors[e.attributes[t]];c[r]=W[o.componentType],a[r]=!0===o.normalized}}return t.getDependency("bufferView",o).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],r=a[t];void 0!==r&&(n.normalized=r)}t(e)}),s,c)}))}))}}class K{constructor(){this.name=C.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e}}class Y extends t.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const n=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new t.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(e){for(const t in a)e.uniforms[t]=a[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",n).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(e){a.specular.value=e}},specularMap:{get:function(){return a.specularMap.value},set:function(e){a.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(e){a.glossiness.value=e}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(e){a.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class X{constructor(){this.name=C.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Y}extendParams(e,n,r){const o=n.extensions[this.name];e.color=new t.Color(1,1,1),e.opacity=1;const i=[];if(Array.isArray(o.diffuseFactor)){const t=o.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==o.diffuseTexture&&i.push(r.assignTexture(e,"map",o.diffuseTexture)),e.emissive=new t.Color(0,0,0),e.glossiness=void 0!==o.glossinessFactor?o.glossinessFactor:1,e.specular=new t.Color(1,1,1),Array.isArray(o.specularFactor)&&e.specular.fromArray(o.specularFactor),void 0!==o.specularGlossinessTexture){const t=o.specularGlossinessTexture;i.push(r.assignTexture(e,"glossinessMap",t)),i.push(r.assignTexture(e,"specularMap",t))}return Promise.all(i)}createMaterial(e){const n=new Y(e);return n.fog=!0,n.color=e.color,n.map=void 0===e.map?null:e.map,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=void 0===e.aoMap?null:e.aoMap,n.aoMapIntensity=1,n.emissive=e.emissive,n.emissiveIntensity=1,n.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,n.bumpMap=void 0===e.bumpMap?null:e.bumpMap,n.bumpScale=1,n.normalMap=void 0===e.normalMap?null:e.normalMap,n.normalMapType=t.TangentSpaceNormalMap,e.normalScale&&(n.normalScale=e.normalScale),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=void 0===e.specularMap?null:e.specularMap,n.specular=e.specular,n.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,n.glossiness=e.glossiness,n.alphaMap=null,n.envMap=void 0===e.envMap?null:e.envMap,n.envMapIntensity=1,n.refractionRatio=.98,n}}class Z{constructor(){this.name=C.KHR_MESH_QUANTIZATION}}class q extends t.Interpolant{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[o+e];return t}}q.prototype.beforeStart_=q.prototype.copySampleValue_,q.prototype.afterEnd_=q.prototype.copySampleValue_,q.prototype.interpolate_=function(e,t,n,r){const o=this.resultBuffer,i=this.sampleValues,s=this.valueSize,a=2*s,c=3*s,l=r-t,u=(n-t)/l,h=u*u,p=h*u,d=e*c,m=d-c,f=-2*p+3*h,g=p-h,y=1-f,_=g-h+u;for(let e=0;e!==s;e++)o[e]=y*i[m+e+s]+_*(i[m+e+a]*l)+f*i[d+e+s]+g*(i[d+e]*l);return o};const W={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},J={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},Q={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},$={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ee={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},te={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ne={CUBICSPLINE:void 0,LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete};function re(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function oe(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function ie(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function se(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ae(e){const t=e.extensions&&e.extensions[C.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+ce(t.attributes):e.indices+":"+ce(e.attributes)+":"+e.mode,n}function ce(e){let t="";const n=Object.keys(e).sort();for(let r=0,o=n.length;r<o;r++)t+=n[r]+":"+e[n[r]]+";";return t}function le(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class ue{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new N,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},this.textureLoader="undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?new t.ImageBitmapLoader(this.options.manager):new t.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new t.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const i={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};oe(o,i,r),ie(i,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(i)}))).then((function(){e(i)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n].joints;for(let t=0,n=r.length;t<n;t++)e[r[t]].isBone=!0}for(let t=0,r=e.length;t<r;t++){const r=e[t];void 0!==r.mesh&&(this._addNodeRef(this.meshCache,r.mesh),void 0!==r.skin&&(n[r.mesh].isSkinnedMesh=!0)),void 0!==r.camera&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone();return r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const o=e(t[r]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[C.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,o){n.load(re(t.uri,r.path),e,void 0,(function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteOffset||0;return e.slice(n,n+(t.byteLength||0))}))}loadAccessor(e){const n=this,r=this.json,o=this.json.accessors[e];if(void 0===o.bufferView&&void 0===o.sparse)return Promise.resolve(null);const i=[];return i.push(void 0!==o.bufferView?this.getDependency("bufferView",o.bufferView):null),void 0!==o.sparse&&(i.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(i).then((function(e){const i=e[0],s=$[o.type],a=W[o.componentType],c=a.BYTES_PER_ELEMENT,l=o.byteOffset||0,u=void 0!==o.bufferView?r.bufferViews[o.bufferView].byteStride:void 0,h=!0===o.normalized;let p,d;if(u&&u!==c*s){const e=Math.floor(l/u),r="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+e+":"+o.count;let m=n.cache.get(r);m||(p=new a(i,e*u,o.count*u/c),m=new t.InterleavedBuffer(p,u/c),n.cache.add(r,m)),d=new t.InterleavedBufferAttribute(m,s,l%u/c,h)}else p=null===i?new a(o.count*s):new a(i,l,o.count*s),d=new t.BufferAttribute(p,s,h);if(void 0!==o.sparse){const n=o.sparse.values.byteOffset||0,r=new(0,W[o.sparse.indices.componentType])(e[1],o.sparse.indices.byteOffset||0,o.sparse.count*$.SCALAR),c=new a(e[2],n,o.sparse.count*s);null!==i&&(d=new t.BufferAttribute(d.array.slice(),d.itemSize,d.normalized));for(let e=0,t=r.length;e<t;e++){const t=r[e];if(d.setX(t,c[e*s]),s>=2&&d.setY(t,c[e*s+1]),s>=3&&d.setZ(t,c[e*s+2]),s>=4&&d.setW(t,c[e*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d}))}loadTexture(e){const t=this.json,n=t.images[t.textures[e].source];let r=this.textureLoader;if(n.uri){const e=this.options.manager.getHandler(n.uri);null!==e&&(r=e)}return this.loadTextureImage(e,n,r)}loadTextureImage(e,n,r){const o=this,i=this.json,s=this.options,a=i.textures[e],c=self.URL||self.webkitURL;let l=n.uri,u=!1,h=!0;if("image/jpeg"===n.mimeType&&(h=!1),void 0!==n.bufferView)l=o.getDependency("bufferView",n.bufferView).then((function(e){if("image/png"===n.mimeType){const t=new DataView(e,25,1).getUint8(0,!1);h=6===t||4===t||3===t}u=!0;const t=new Blob([e],{type:n.mimeType});return l=c.createObjectURL(t),l}));else if(void 0===n.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");return Promise.resolve(l).then((function(e){return new Promise((function(n,o){let i=n;!0===r.isImageBitmapLoader&&(i=function(e){n(new t.CanvasTexture(e))}),r.load(re(e,s.path),i,void 0,o)}))})).then((function(n){!0===u&&c.revokeObjectURL(l),n.flipY=!1,a.name&&(n.name=a.name),h||(n.format=t.RGBFormat);const r=(i.samplers||{})[a.sampler]||{};return n.magFilter=J[r.magFilter]||t.LinearFilter,n.minFilter=J[r.minFilter]||t.LinearMipmapLinearFilter,n.wrapS=Q[r.wrapS]||t.RepeatWrapping,n.wrapT=Q[r.wrapT]||t.RepeatWrapping,o.associations.set(n,{type:"textures",index:e}),n}))}assignTexture(e,t,n){const r=this;return this.getDependency("texture",n.index).then((function(o){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[C.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[C.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(o);o=r.extensions[C.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),r.associations.set(o,t)}}e[t]=o}))}assignFinalMaterial(e){const n=e.geometry;let r=e.material;const o=void 0!==n.attributes.tangent,i=void 0!==n.attributes.color,s=void 0===n.attributes.normal,a=!0===e.isSkinnedMesh,c=Object.keys(n.morphAttributes).length>0,l=c&&void 0!==n.morphAttributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let n=this.cache.get(e);n||(n=new t.PointsMaterial,t.Material.prototype.copy.call(n,r),n.color.copy(r.color),n.map=r.map,n.sizeAttenuation=!1,this.cache.add(e,n)),r=n}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let n=this.cache.get(e);n||(n=new t.LineBasicMaterial,t.Material.prototype.copy.call(n,r),n.color.copy(r.color),this.cache.add(e,n)),r=n}if(o||i||s||a||c){let e="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),a&&(e+="skinning:"),o&&(e+="vertex-tangents:"),i&&(e+="vertex-colors:"),s&&(e+="flat-shading:"),c&&(e+="morph-targets:"),l&&(e+="morph-normals:");let t=this.cache.get(e);t||(t=r.clone(),a&&(t.skinning=!0),i&&(t.vertexColors=!0),s&&(t.flatShading=!0),c&&(t.morphTargets=!0),l&&(t.morphNormals=!0),o&&(t.vertexTangents=!0,t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}r.aoMap&&void 0===n.attributes.uv2&&void 0!==n.attributes.uv&&n.setAttribute("uv2",n.attributes.uv),e.material=r}getMaterialType(){return t.MeshStandardMaterial}loadMaterial(e){const n=this,r=this.extensions,o=this.json.materials[e];let i;const s={},a=o.extensions||{},c=[];if(a[C.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=r[C.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=e.getMaterialType(),c.push(e.extendParams(s,o,n))}else if(a[C.KHR_MATERIALS_UNLIT]){const e=r[C.KHR_MATERIALS_UNLIT];i=e.getMaterialType(),c.push(e.extendParams(s,o,n))}else{const r=o.pbrMetallicRoughness||{};if(s.color=new t.Color(1,1,1),s.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;s.color.fromArray(e),s.opacity=e[3]}void 0!==r.baseColorTexture&&c.push(n.assignTexture(s,"map",r.baseColorTexture)),s.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,s.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(c.push(n.assignTexture(s,"metalnessMap",r.metallicRoughnessTexture)),c.push(n.assignTexture(s,"roughnessMap",r.metallicRoughnessTexture))),i=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)}))))}!0===o.doubleSided&&(s.side=t.DoubleSide);const l=o.alphaMode||"OPAQUE";return"BLEND"===l?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,"MASK"===l&&(s.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&i!==t.MeshBasicMaterial&&(c.push(n.assignTexture(s,"normalMap",o.normalTexture)),s.normalScale=new t.Vector2(1,-1),void 0!==o.normalTexture.scale&&s.normalScale.set(o.normalTexture.scale,-o.normalTexture.scale)),void 0!==o.occlusionTexture&&i!==t.MeshBasicMaterial&&(c.push(n.assignTexture(s,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(s.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&i!==t.MeshBasicMaterial&&(s.emissive=(new t.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&i!==t.MeshBasicMaterial&&c.push(n.assignTexture(s,"emissiveMap",o.emissiveTexture)),Promise.all(c).then((function(){let a;return a=i===Y?r[C.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new i(s),o.name&&(a.name=o.name),a.map&&(a.map.encoding=t.sRGBEncoding),a.emissiveMap&&(a.emissiveMap.encoding=t.sRGBEncoding),ie(a,o),n.associations.set(a,{type:"materials",index:e}),o.extensions&&oe(r,a,o),a}))}createUniqueName(e){const n=t.PropertyBinding.sanitizeNodeName(e||"");let r=n;for(let e=1;this.nodeNamesUsed[r];++e)r=n+"_"+e;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){const n=this,r=this.extensions,o=this.primitiveCache;function i(e){return r[C.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,n).then((function(t){return pe(t,e,n)}))}const s=[];for(let r=0,a=e.length;r<a;r++){const a=e[r],c=ae(a),l=o[c];if(l)s.push(l.promise);else{let e;e=a.extensions&&a.extensions[C.KHR_DRACO_MESH_COMPRESSION]?i(a):pe(new t.BufferGeometry,a,n),o[c]={primitive:a,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const n=this,r=this.extensions,o=this.json.meshes[e],i=o.primitives,s=[];for(let e=0,n=i.length;e<n;e++){const n=void 0===i[e].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new t.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:t.FrontSide})),a.DefaultMaterial):this.getDependency("material",i[e].material);s.push(n)}var a;return s.push(n.loadGeometries(i)),Promise.all(s).then((function(s){const a=s.slice(0,s.length-1),c=s[s.length-1],l=[];for(let s=0,u=c.length;s<u;s++){const u=c[s],h=i[s];let p;const d=a[s];if(4===h.mode||5===h.mode||6===h.mode||void 0===h.mode)p=!0===o.isSkinnedMesh?new t.SkinnedMesh(u,d):new t.Mesh(u,d),!0!==p.isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),5===h.mode?p.geometry=de(p.geometry,t.TriangleStripDrawMode):6===h.mode&&(p.geometry=de(p.geometry,t.TriangleFanDrawMode));else if(1===h.mode)p=new t.LineSegments(u,d);else if(3===h.mode)p=new t.Line(u,d);else if(2===h.mode)p=new t.LineLoop(u,d);else{if(0!==h.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);p=new t.Points(u,d)}Object.keys(p.geometry.morphAttributes).length>0&&se(p,o),p.name=n.createUniqueName(o.name||"mesh_"+e),ie(p,o),h.extensions&&oe(r,p,h),n.assignFinalMaterial(p),l.push(p)}if(1===l.length)return l[0];const u=new t.Group;for(let e=0,t=l.length;e<t;e++)u.add(l[e]);return u}))}loadCamera(e){let n;const r=this.json.cameras[e],o=r[r.type];if(o)return"perspective"===r.type?n=new t.PerspectiveCamera(t.MathUtils.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):"orthographic"===r.type&&(n=new t.OrthographicCamera(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),r.name&&(n.name=this.createUniqueName(r.name)),ie(n,r),Promise.resolve(n);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const n=this.json.animations[e],r=[],o=[],i=[],s=[],a=[];for(let e=0,t=n.channels.length;e<t;e++){const t=n.channels[e],c=n.samplers[t.sampler],l=t.target,u=void 0!==n.parameters?n.parameters[c.input]:c.input,h=void 0!==n.parameters?n.parameters[c.output]:c.output;r.push(this.getDependency("node",void 0!==l.node?l.node:l.id)),o.push(this.getDependency("accessor",u)),i.push(this.getDependency("accessor",h)),s.push(c),a.push(l)}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(i),Promise.all(s),Promise.all(a)]).then((function(r){const o=r[0],i=r[1],s=r[2],a=r[3],c=r[4],l=[];for(let e=0,n=o.length;e<n;e++){const n=o[e],r=i[e],u=s[e],h=a[e],p=c[e];if(void 0===n)continue;let d;switch(n.updateMatrix(),n.matrixAutoUpdate=!0,te[p.path]){case te.weights:d=t.NumberKeyframeTrack;break;case te.rotation:d=t.QuaternionKeyframeTrack;break;case te.position:case te.scale:default:d=t.VectorKeyframeTrack}const m=n.name?n.name:n.uuid,f=void 0!==h.interpolation?ne[h.interpolation]:t.InterpolateLinear,g=[];te[p.path]===te.weights?n.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(m);let y=u.array;if(u.normalized){const e=le(y.constructor),t=new Float32Array(y.length);for(let n=0,r=y.length;n<r;n++)t[n]=y[n]*e;y=t}for(let e=0,t=g.length;e<t;e++){const t=new d(g[e]+"."+te[p.path],r.array,y,f);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){return new q(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(t)}}return new t.AnimationClip(n.name?n.name:"animation_"+e,void 0,l)}))}createNodeMesh(e){const t=this,n=this.json.nodes[e];return void 0===n.mesh?null:t.getDependency("mesh",n.mesh).then((function(e){const r=t._getNodeRef(t.meshCache,n.mesh,e);return void 0!==n.weights&&r.traverse((function(e){if(e.isMesh)for(let t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t]})),r}))}loadNode(e){const n=this.extensions,r=this,o=this.json.nodes[e],i=o.name?r.createUniqueName(o.name):"";return function(){const t=[],n=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==o.camera&&t.push(r.getDependency("camera",o.camera).then((function(e){return r._getNodeRef(r.cameraCache,o.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(s){let a;if(a=!0===o.isBone?new t.Bone:s.length>1?new t.Group:1===s.length?s[0]:new t.Object3D,a!==s[0])for(let e=0,t=s.length;e<t;e++)a.add(s[e]);if(o.name&&(a.userData.name=o.name,a.name=i),ie(a,o),o.extensions&&oe(n,a,o),void 0!==o.matrix){const e=new t.Matrix4;e.fromArray(o.matrix),a.applyMatrix4(e)}else void 0!==o.translation&&a.position.fromArray(o.translation),void 0!==o.rotation&&a.quaternion.fromArray(o.rotation),void 0!==o.scale&&a.scale.fromArray(o.scale);return r.associations.set(a,{type:"nodes",index:e}),a}))}loadScene(e){const n=this.json,r=this.extensions,o=this.json.scenes[e],i=this,s=new t.Group;o.name&&(s.name=i.createUniqueName(o.name)),ie(s,o),o.extensions&&oe(r,s,o);const a=o.nodes||[],c=[];for(let e=0,t=a.length;e<t;e++)c.push(he(a[e],s,n,i));return Promise.all(c).then((function(){return s}))}}function he(e,n,r,o){const i=r.nodes[e];return o.getDependency("node",e).then((function(e){if(void 0===i.skin)return e;let n;return o.getDependency("skin",i.skin).then((function(e){n=e;const t=[];for(let e=0,r=n.joints.length;e<r;e++)t.push(o.getDependency("node",n.joints[e]));return Promise.all(t)})).then((function(r){return e.traverse((function(e){if(!e.isMesh)return;const o=[],i=[];for(let e=0,s=r.length;e<s;e++){const s=r[e];if(s){o.push(s);const r=new t.Matrix4;void 0!==n.inverseBindMatrices&&r.fromArray(n.inverseBindMatrices.array,16*e),i.push(r)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[e])}e.bind(new t.Skeleton(o,i),e.matrixWorld)})),e}))})).then((function(e){n.add(e);const t=[];if(i.children){const n=i.children;for(let i=0,s=n.length;i<s;i++)t.push(he(n[i],e,r,o))}return Promise.all(t)}))}function pe(e,n,r){const o=n.attributes,i=[];function s(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in o){const n=ee[t]||t.toLowerCase();n in e.attributes||i.push(s(o[t],n))}if(void 0!==n.indices&&!e.index){const t=r.getDependency("accessor",n.indices).then((function(t){e.setIndex(t)}));i.push(t)}return ie(e,n),function(e,n,r){const o=n.attributes,i=new t.Box3;if(void 0===o.POSITION)return;{const e=r.json.accessors[o.POSITION],n=e.min,s=e.max;if(void 0===n||void 0===s)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new t.Vector3(n[0],n[1],n[2]),new t.Vector3(s[0],s[1],s[2])),e.normalized){const t=le(W[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}const s=n.targets;if(void 0!==s){const e=new t.Vector3,n=new t.Vector3;for(let t=0,o=s.length;t<o;t++){const o=s[t];if(void 0!==o.POSITION){const t=r.json.accessors[o.POSITION],i=t.min,s=t.max;if(void 0!==i&&void 0!==s){if(n.setX(Math.max(Math.abs(i[0]),Math.abs(s[0]))),n.setY(Math.max(Math.abs(i[1]),Math.abs(s[1]))),n.setZ(Math.max(Math.abs(i[2]),Math.abs(s[2]))),t.normalized){const e=le(W[t.componentType]);n.multiplyScalar(e)}e.max(n)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;const a=new t.Sphere;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=a}(e,n,r),Promise.all(i).then((function(){return void 0!==n.targets?function(e,t,n){let r=!1,o=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(r=!0),void 0!==n.NORMAL&&(o=!0),r&&o)break}if(!r&&!o)return Promise.resolve(e);const i=[],s=[];for(let a=0,c=t.length;a<c;a++){const c=t[a];if(r){const t=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;i.push(t)}if(o){const t=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal;s.push(t)}}return Promise.all([Promise.all(i),Promise.all(s)]).then((function(t){const n=t[1];return r&&(e.morphAttributes.position=t[0]),o&&(e.morphAttributes.normal=n),e.morphTargetsRelative=!0,e}))}(e,n.targets,r):e}))}function de(e,n){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const o=r.count-2,i=[];if(n===t.TriangleFanDrawMode)for(let e=1;e<=o;e++)i.push(r.getX(0)),i.push(r.getX(e)),i.push(r.getX(e+1));else for(let e=0;e<o;e++)e%2==0?(i.push(r.getX(e)),i.push(r.getX(e+1)),i.push(r.getX(e+2))):(i.push(r.getX(e+2)),i.push(r.getX(e+1)),i.push(r.getX(e)));i.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(i),s}function me(e,n,r,o){return new Promise((function(i,s){(new I).load(e,(function(e){var s=e.scene;n&&function(e,n){var r=Math.pow(10,-10);e.traverse((function(e){e instanceof t.Mesh&&(e.geometry.computeBoundingSphere(),e.geometry&&e.geometry.boundingSphere&&e.geometry.boundingSphere.radius>r&&(r=e.geometry.boundingSphere.radius))}));var o=n/r;e.scale.set(o,o,o)}(s,n),r&&function(e){var n=(new t.Box3).setFromObject(e).getCenter(new t.Vector3).toArray(),r=n[0],o=n[1],i=n[2],s=e.position.clone().toArray();e.position.set(s[0]-r,s[1]-o,s[2]-i)}(s),o&&function(e){e.traverse((function(e){"Mesh"===e.type&&(e.castShadow=!0,e.receiveShadow=!0)}))}(s),setTimeout((function(){return i(s)}),5)}),(function(e){return!1}),(function(e){console.log("Loading error occurred:",e.message),s()}))}))}var fe=new Set(["a","e","i","q","epoch","period","tp","ma","n","L","om","w","wBar","GM"]),ge=new Set(["i","ma","n","L","om","w","wBar"]);function ye(e){return void 0!==e}var _e=function(){function e(e,t,n){var r=this;void 0===t&&(t="rad"),void 0===n&&(n=!1),this._locked=!1,this._attrs=s({},e),this._locked=!1,e&&Object.keys(e).forEach((function(n){var o=ge.has(n)?t:void 0,i=e[n];i&&r.set(n,i,o)})),void 0===this._attrs.GM&&(this._attrs.GM=ve.SUN),this.fill(),this.get("e")>.9&&void 0===this.get("tp")&&console.warn('You must specify "tp" (time of perihelion) for highly eccentric orbits'),this._locked=n}var t=e.prototype;return t.set=function(e,t,n){if(void 0===n&&(n="rad"),this._locked)throw new Error("Attempted to modify locked (immutable) Ephem object");return fe.has(e)?(this._attrs[e]="deg"===n?t*Math.PI/180:t,!0):(console.warn("Invalid ephem attr: "+e),!1)},t.get=function(e,t){void 0===t&&(t="rad");var n=this._attrs[e];return"deg"===t?180*n/Math.PI:n},t.fill=function(){var e=this.get("e");if(!ye(e))throw new Error('Must define eccentricity "e" in an orbit');var t=this.get("a"),n=this.get("q");if(ye(t)){if(!ye(n)){if(e>=1)throw new Error('Must provide perihelion distance "q" if eccentricity "e" is greater than 1');this.set("q",n=t*(1-e))}}else{if(!ye(n))throw new Error('Must define semimajor axis "a" or perihelion distance "q" in an orbit');this.set("a",t=n/(1-e))}var r=this.get("w"),o=this.get("wBar"),i=this.get("om");ye(r)&&ye(i)&&!ye(o)?this.set("wBar",o=r+i):ye(o)&&ye(i)&&!ye(r)?this.set("w",r=o-i):ye(r)&&ye(o)&&!ye(i)&&this.set("om",i=o-r);var s=149597870700*t,a=this.get("n"),c=this.get("GM"),l=this.get("period");if(!ye(l)&&ye(t)&&(l=2*Math.PI*Math.sqrt(s*s*s/c)/86400,this.set("period",l)),e<1)if(ye(l)&&!ye(a)){var u=2*Math.PI/l;this.set("n",u)}else ye(a)&&!ye(l)&&this.set("period",2*Math.PI/a);var h=this.get("ma"),p=this.get("L");!ye(p)&&ye(i)&&ye(r)&&ye(h)&&this.set("L",p=i+r+h),ye(h)||this.set("ma",p-o)},t.lock=function(){this._locked=!0},t.copy=function(){return new e({GM:this.get("GM"),epoch:this.get("epoch"),a:this.get("a"),e:this.get("e"),i:this.get("i"),om:this.get("om"),ma:this.get("ma"),w:this.get("w")},"rad")},e}(),ve={SUN:0x731c14d13d71fc000,MERCURY:22031780000000.02,VENUS:324858592000000.06,EARTH_MOON:403503235502259.8,MARS:42828375214000.02,JUPITER:0x1c22c96966960d0,SATURN:379405852e8,URANUS:5794548600000008,NEPTUNE:6836527100580024,PLUTO_CHARON:977000000000.0007},we={MERCURY:new _e({epoch:2458426.5,a:.3870968969437096,e:.2056515875393916,i:7.003891682749818,om:48.30774804443502,w:29.17940253442659,ma:256.190975209273},"deg",!0),VENUS:new _e({epoch:2458426.5,a:.7233458663591554,e:.006762510759617694,i:3.394567787211735,om:76.62534150657346,w:54.74567447560867,ma:275.6687596099721},"deg",!0),EARTH:new _e({epoch:2451545,a:1.00000261,e:.01671123,i:-1531e-8,om:0,wBar:102.93768193,L:100.46457166},"deg",!0),MOON:new _e({GM:398600,epoch:2458621.5,a:.002582517063772124,e:.04582543645168888,i:5.102060246928811,om:108.5916732144811,w:61.80561793729225,ma:50.53270083636792},"deg",!0),MARS:new _e({epoch:2458426.5,a:1.52371401537107,e:.09336741335309606,i:1.848141099825311,om:49.50420572080223,w:286.6965847685386,ma:25.38237617924876},"deg",!0),CERES:new _e({epoch:2458600.5,a:2.7658,e:.078,i:10.607,om:80.7,w:73.1,ma:77.37209589},"deg",!0),JUPITER:new _e({epoch:2458426.5,a:5.20180355911023,e:.0489912558249006,i:1.303560894624275,om:100.5203828847816,w:273.736301845404,ma:231.939544389401},"deg",!0),SATURN:new _e({epoch:2458426.5,a:9.577177295536776,e:.05101889921719987,i:2.482782449972317,om:113.6154964073247,w:339.4422648650336,ma:187.0970898012944},"deg",!0),URANUS:new _e({epoch:2458426.5,a:19.14496966635462,e:.04832662948112808,i:.7697511134483724,om:74.14239045667875,w:99.42704504702185,ma:220.2603033874267},"deg",!0),NEPTUNE:new _e({epoch:2458426.5,a:30.0962226342805,e:.00736257118719377,i:1.774569249829094,om:131.8695882492132,w:258.6226409499831,ma:315.2804988924479},"deg",!0),PLUTO:new _e({epoch:2454000.5,a:39.4450697257,e:.250248713478,i:17.0890009196,om:110.376957955,w:112.597141677,ma:25.2471897122},"deg",!0),HAUMEA:new _e({epoch:2459200.5,a:43.116,e:.19642,i:28.2137,om:122.167,w:239.041,ma:218.205},"deg",!0),MAKEMAKE:new _e({epoch:2458900.5,a:45.43,e:.16126,i:28.9835,om:79.62,w:294.834,ma:165.514},"deg",!0),ERIS:new _e({epoch:2459000.5,a:67.864,e:.43607,i:44.04,om:35.951,w:151.639,ma:205.989},"deg",!0)};function be(e,t,n){return[1*e,1*t,1*n]}function Ee(e,t,n,r,o,i){if(void 0===e)throw"data object is undefined";if(!Array.isArray(e))throw"data object must be an array";if(n>=r)throw"first row must be greater than last row";if(n<0)throw"first row must be greater than zero";if(r>e.length-1)throw"last row must be ";if(!Array.isArray(e[n]))throw"data in rows must be array data";var s=e[0].length-1;if(o<0||o>s)throw"xIndex has to be between 0 and "+s+": "+o;if(i<0||i>s)throw"yIndex has to be between 0 and "+s+": "+i;for(var a=0,c=n;c<=r;c++){for(var l=1,u=n;u<=r;u++)u!==c&&(l*=(t-e[u][o])/(e[c][o]-e[u][o]));a+=l*e[c][i]}return a}var Te,Me=function(e,t){return e-t},Se=function(e,t){return e[0]-t},xe={distance:"au",time:"day"},Ae=new Set(["km","au"]),Pe=new Set(["cartesianposvel"]),Le=new Set(["lagrange"]),Re=new Set(["day","sec"]),Oe=function(){function e(e){if(this._units=s({},xe),this._ephemType="cartesianposvel",this._interpolationType="lagrange",this._interpolationOrder=5,!e)throw"EphemerisTable must be initialized with an ephemeris data structure";if(!e.data||!Array.isArray(e.data)||0===e.data.length||!Array.isArray(e.data[0]))throw"EphemerisTable must be initialized with a structure containing an array of arrays of ephemeris data";if(this._data=[].concat(e.data),e.distanceUnits){if(!Ae.has(e.distanceUnits))throw"Unknown distance units: "+e.distanceUnits;this._units.distance=e.distanceUnits}if(e.timeUnits){if(!Re.has(e.timeUnits))throw"Unknown time units: "+e.timeUnits;this._units.time=e.timeUnits}if(e.ephemerisType){if(!Pe.has(e.ephemerisType))throw"Unknown ephemeris type: "+e.ephemerisType;this._ephemType=e.ephemerisType}if(e.interpolationType){if(!Le.has(e.interpolationType))throw"Unknown interpolation type: "+e.interpolationType;this._interpolationType=e.interpolationType}if(void 0!==e.interpolationOrder){if(e.interpolationOrder<1||e.interpolationOrder>20)throw"Interpolation order must be >0 and <20: "+e.interpolationOrder;this._interpolationOrder=e.interpolationOrder}if(this._units.distance!==xe.distance||this._units.time!==xe.time){var t=this.calcDistanceMultiplier(this._units.distance),n=this.calcTimeMultiplier(this._units.time);this._data.forEach((function(e){e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t*n,e[5]*=t*n,e[6]*=t*n}))}}var t=e.prototype;return t.getPositionAtTime=function(e){if(e<=this._data[0][0])return[this._data[0][1],this._data[0][2],this._data[0][3]];var t=this._data[this._data.length-1];if(e>=t[0])return[t[1],t[2],t[3]];var n=this.calcBoundingIndices(e),r=n.startIndex,o=n.stopIndex;return[Ee(this._data,e,r,o,0,1),Ee(this._data,e,r,o,0,2),Ee(this._data,e,r,o,0,3)]},t.getPositions=function(e,t,n){if(e>t)throw"Requested start needs to be after requested stop";if(n<=0)throw"Step days needs to be greater than zero";for(var r=[],o=e;o<=t;o+=n)r.push(this.getPositionAtTime(o));return r},t.calcDistanceMultiplier=function(e){switch(e){case"au":return 1;case"km":return 1/149597870.7;default:throw new Error("Unknown distance unit type: "+e)}},t.calcTimeMultiplier=function(e){switch(e){case"day":return 1;case"sec":return 1/86400;default:throw new Error("Unknown time unit type: "+e)}},t.calcBoundingIndices=function(e){var t=Math.floor(this._interpolationOrder/2),n=function(e,t,n){if(void 0===n&&(n=Me),void 0===e)throw"data object is undefined";if(!Array.isArray(e))throw"data object must be an array";if(void 0===t)throw"value object must be defined";if(void 0===n)throw"comparer must be defined";for(var r=0,o=e.length;r<=o;){var i=Math.floor((r+o)/2);if(i===e.length)return i;var s=n(e[i],t);if(s<0)r=i+1;else{if(!(s>0))return i;o=i-1}}return~r}(this._data,e,Se);n<0&&(n=~n-1);var r=n-t;r<0&&(r=0);var o=r+Number(this._interpolationOrder);return o>=this._data.length&&(o=this._data.length-1,this._data.length>t&&(r=o-t)),{startIndex:r,stopIndex:o}},e}(),Ie=Math.sin,Ne=Math.cos,Ce=Math.sqrt;function ke(e){return Math.exp(Math.log(e)/3)}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PARABOLIC=1]="PARABOLIC",e[e.HYPERBOLIC=2]="HYPERBOLIC",e[e.ELLIPTICAL=3]="ELLIPTICAL",e[e.TABLE=4]="TABLE"}(Te||(Te={}));var Ue,De=function(){function e(e,t){this._ephem=e,this._orbitStart=0,this._orbitStop=0,this._options=s({color:"white",eclipticLineColor:"cyan"},t,{orbitPathSettings:s({leadDurationYears:10,trailDurationYears:10,numberSamplePoints:360},t.orbitPathSettings)}),this._orbitType=function(e){if(e instanceof Oe)return Te.TABLE;var t=e.get("e");return t>.9&&t<1.2?Te.PARABOLIC:t>1.2?Te.HYPERBOLIC:Te.ELLIPTICAL}(this._ephem)}var r=e.prototype;return r.getPositionAtTime=function(e,t){switch(void 0===t&&(t=!1),this._orbitType){case Te.PARABOLIC:return this.getPositionAtTimeNearParabolic(e,t);case Te.HYPERBOLIC:return this.getPositionAtTimeHyperbolic(e,t);case Te.ELLIPTICAL:return this.getPositionAtTimeElliptical(e,t);case Te.TABLE:return this.getPositionAtTimeTable(e,t)}throw new Error("No handler for this type of orbit")},r.getPositionAtTimeParabolic=function(e,t){var n=this._ephem;if(n instanceof Oe)throw new Error("Poor logic allowing table type here");var r=n.get("q"),o=(e-n.get("tp"))*(.01720209895/Ce(2))/Ce(r*r*r)*1.5,i=Ce(1+o*o),s=ke(i+o)-ke(i-o),a=2*Math.atan(s);return this.vectorToHeliocentric(a,r*(1+s*s))},r.getPositionAtTimeNearParabolic=function(e,t){var n=this._ephem;if(n instanceof Oe)throw new Error("Poor logic allowing table type here");var r=n.get("e"),o=n.get("q"),i=.75*(e-n.get("tp"))*.01720209895*Ce((1+r)/(o*o*o)),s=Ce(1+i*i),a=ke(s+i)-ke(s-i),c=(1-r)/(1+r),l=a*a/(1+a*a),u=c*l*l,h=a*(1+c*l*(2/3+.4*a*a+(1.4+33/35*a*a+37/175*Math.pow(a,4))*u+a*a*(432/175+956/1125*a*a+84/1575*Math.pow(a,4))*u*u)),p=2*Math.atan(h);return this.vectorToHeliocentric(p,o*(1+h*h)/(1+h*h*c))},r.getPositionAtTimeHyperbolic=function(e,t){var n=this._ephem;if(n instanceof Oe)throw new Error("Poor logic allowing table type here");for(var r=n.get("e"),o=n.get("a"),i=n.get("ma")+n.get("n","rad")*(e-n.get("epoch")),s=i,a=0;a<100;a++){var c=(i+r*(s*Math.cosh(s)-Math.sinh(s)))/(r*Math.cosh(s)-1),l=Math.abs(c-s);if(s=c,l<1e-7)break}var u=s,h=2*Math.atan(Ce((r+1)/(r-1)))*Math.tanh(u/2),p=o*(1-r*r)/(1+r*Ne(h));return this.vectorToHeliocentric(h,p)},r.getPositionAtTimeElliptical=function(e,t){void 0===t&&(t=!1);var n=this._ephem;if(n instanceof Oe)throw new Error("Poor logic allowing table type here");var r=n.get("e"),o=n.get("ma","rad"),i=n.get("n","rad"),s=e-n.get("epoch"),a=o+i*s;t&&(console.info("period=",n.get("period")),console.info("n=",i),console.info("ma=",o),console.info("d=",s),console.info("M=",a));for(var c=a,l=0;l<100;l++){var u=a+r*Ie(c),h=Math.abs(u-c);if(c=u,h<1e-7)break}var p=c,d=2*Math.atan(Ce((1+r)/(1-r))*Math.tan(p/2)),m=n.get("a")*(1-r*r)/(1+r*Ne(d));return this.vectorToHeliocentric(d,m)},r.getPositionAtTimeTable=function(e,t){if(this._ephem instanceof _e)throw new Error("Poor logic allowing non-table type here");var n=this._ephem.getPositionAtTime(e);return be(n[0],n[1],n[2])},r.vectorToHeliocentric=function(e,t){var n=this._ephem;if(n instanceof Oe)throw new Error("Poor logic allowing table type here");var r=n.get("i","rad"),o=n.get("om","rad"),i=n.get("wBar","rad");return be(t*(Ne(o)*Ne(e+i-o)-Ie(o)*Ie(e+i-o)*Ne(r)),t*(Ie(o)*Ne(e+i-o)+Ne(o)*Ie(e+i-o)*Ne(r)),t*(Ie(e+i-o)*Ie(r)))},r.needsUpdateForTime=function(e){return this._orbitType===Te.TABLE&&(e<this._orbitStart||e>this._orbitStop)},r.getOrbitShape=function(e,t){if(void 0===t&&(t=!1),t&&(this._orbitShape&&(this._orbitShape.geometry.dispose(),this._orbitShape.material.dispose()),this._orbitShape=void 0,this._orbitPoints&&this._orbitPoints.dispose(),this._orbitPoints=void 0,this._eclipticDropLines&&(this._eclipticDropLines.geometry.dispose(),this._eclipticDropLines.material.dispose()),this._eclipticDropLines=void 0),this._orbitShape)return this._orbitShape;if(this._orbitType===Te.ELLIPTICAL)return this.getEllipse();var r=(this._orbitType===Te.TABLE?e:this._ephem.get("tp"))||n.toJulianDay(new Date),o=r-365.25*this._options.orbitPathSettings.trailDurationYears,i=r+365.25*this._options.orbitPathSettings.leadDurationYears,s=(i-o)/this._options.orbitPathSettings.numberSamplePoints;switch(this._orbitStart=o,this._orbitStop=i,this._orbitType){case Te.HYPERBOLIC:return this.getLine(this.getPositionAtTimeHyperbolic.bind(this),o,i,s);case Te.PARABOLIC:return this.getLine(this.getPositionAtTimeNearParabolic.bind(this),o,i,s);case Te.TABLE:return this.getTableOrbit(o,i,s)}throw new Error("Unknown orbit shape")},r.getLine=function(e,n,r,o){for(var i=[],s=n;s<=r;s+=o){var a=e(s);a[0]=y(a[0]),a[1]=y(a[1]),a[2]=y(a[2]),i.push(new t.Vector3(a[0],a[1],a[2]))}var c=new t.BufferGeometry;return c.setFromPoints(i),this.generateAndCacheOrbitShape(c)},r.getTableOrbit=function(e,n,r){if(this._ephem instanceof _e)throw new Error("Poor logic allowing non-table type here");var o=this._ephem.getPositions(e,n,r).map((function(e){return[1*(t=e)[0],1*t[1],1*t[2]];var t})).map((function(e){return new t.Vector3(e[0],e[1],e[2])})),i=new t.BufferGeometry;return i.setFromPoints(o),this.generateAndCacheOrbitShape(i)},r.getEllipse=function(){var e=this.getEllipseGeometry();return this.generateAndCacheOrbitShape(e)},r.getEllipseGeometry=function(){var e=this._ephem;if(e instanceof Oe)throw new Error("Poor logic allowing table type here");e.get("period");for(var n=e.get("a"),r=e.get("e"),o=2*Math.PI,i=o/90,s=[],a=0;a<o;a+=i){var c=2*Math.atan(Ce((1+r)/(1-r))*Math.tan(a/2)),l=n*(1-r*r)/(1+r*Ne(c)),u=this.vectorToHeliocentric(c,l);(isNaN(u[0])||isNaN(u[1])||isNaN(u[2]))&&(console.error("NaN position value - you may have bad or incomplete data in the following ephemeris:"),console.error(e)),s.push(new t.Vector3(y(u[0]),y(u[1]),y(u[2])))}s.push(s[0]);var h=new t.BufferGeometry;return h.setFromPoints(s),h},r.generateAndCacheOrbitShape=function(e){return this._orbitPoints=e,this._orbitShape=new t.Line(e,new t.LineBasicMaterial({color:new t.Color(this._options.color||4473924)})),this._orbitShape},r.getLinesToEcliptic=function(){if(this._eclipticDropLines)return this._eclipticDropLines;this._orbitPoints||this.getOrbitShape();var e=this._orbitPoints,n=new t.BufferGeometry;if(!e)throw new Error("Poor logic letting point be undefined here");return this._eclipticDropLines=new t.LineSegments(n,new t.LineBasicMaterial({color:this._options.eclipticLineColor||3355443,blending:t.AdditiveBlending})),this._eclipticDropLines},r.getHexColor=function(){var e;return null==(e=this._orbitShape)?void 0:e.material.color.getHex()},r.setHexColor=function(e){var n,r;null!=(n=this._orbitShape)&&null!=(r=n.material)&&r.color&&(this._orbitShape.material.color=new t.Color(e))},r.getVisibility=function(){var e;return null==(e=this._orbitShape)?void 0:e.visible},r.setVisibility=function(e){this._orbitShape&&(this._orbitShape.visible=e)},e}(),He=function(){function e(e,t){var n=this;switch(void 0===t&&(t=L.PLANET),this.name=e,this.orbitalType=t,this.loadPlanet=function(){n.SKEph=we[n.name],n.SKOrbit=new De(n.SKEph,{color:n.orbitalType===L.PLANET?"white":"pink",eclipticLineColor:void 0,orbitPathSettings:void 0}),n.SKprojectedOrbitLine=n.SKOrbit.getOrbitShape()},this.loadAsteroid=function(){n.SKEph=new _e({epoch:2458600.5,a:5.38533,e:.19893,i:22.11137,om:294.42992,w:314.2889,ma:229.14238},"deg"),n.SKOrbit=new De(n.SKEph,{color:"cyan",eclipticLineColor:void 0,orbitPathSettings:void 0}),n.SKprojectedOrbitLine=n.SKOrbit.getOrbitShape()},this.getProjectedOrbitLine=function(){return n.SKprojectedOrbitLine},this.orbitalType){case L.ASTEROID:this.loadAsteroid();break;case L.PLANET:case L.DWARF_PLANET:default:this.loadPlanet()}}return e.prototype.getXyzMeters=function(e){var t;void 0===e&&(e=0);var n=null==(t=this.SKOrbit)?void 0:t.getPositionAtTime(e);return n?{x:y(n[0]),y:y(n[1]),z:y(n[2])}:{x:0,y:0,z:0}},e}(),Fe=["MERCURY","VENUS","EARTH","MARS","CERES","PLUTO"],je=["HAUMEA","MAKEMAKE","ERIS"],Ge=["CERES","PLUTO","HAUMEA","MAKEMAKE","ERIS"],Be=function(e){function n(n){var r,o;return(r=e.call(this,"PLUTO"===(o=n)||"CERES"===o?1e4:"HAUMEA"===o||"MAKEMAKE"===o||"ERIS"===o?15e3:3e3)||this).NAME=n,r.model=new t.Group,r.loadPlanetAsObject=i(h.mark((function e(){var n,o,i,s;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.NAME.toLowerCase(),o=M+"/planets/"+n+"/"+n+".glb",(i=new t.Mesh(new t.SphereGeometry(r.radius,32,32),new t.MeshPhongMaterial)).rotateX(Math.PI/2),r.model.add(i),s=function(e){i.visible=!1,e&&r.model.add(e)},!r._isAsyncLoad()){e.next=10;break}me(o,r.radius).then(s).catch((function(e){return s(null)})),e.next=15;break;case 10:return e.t0=s,e.next=13,me(o,r.radius).catch((function(e){return null}));case 13:e.t1=e.sent,(0,e.t0)(e.t1);case 15:case"end":return e.stop()}}),e)}))),r.loadPlanetAsTexturedSphere=i(h.mark((function e(){var n,o,i,s,a,c,l,u,p;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.NAME.toLowerCase(),o=M+"/planets/"+n+"/"+n+"-map-1024.jpg",i=M+"/planets/"+n+"/"+n+"-bump-1024.png",s=Fe.includes(r.NAME),a="EARTH"===r.NAME,c=Promise.resolve(null),(l=new t.Mesh(new t.SphereGeometry(r.radius,32,32),new t.MeshPhongMaterial({shininess:a?25:2}))).rotateX(Math.PI/2),r.model.add(l),u=function(e){var n=e[0],o=e[1],i=e[2],s="fulfilled"===o.status?o.value:null,a="fulfilled"===i.status?i.value:null;l.material.map="fulfilled"===n.status?n.value:null,l.material.bumpMap=s,l.material.bumpScale=50*r.radius,l.material.needsUpdate=!0,a&&(r.clouds=new t.Mesh(new t.SphereGeometry(1.05*r.radius,32,32),new t.MeshPhongMaterial({map:a,side:t.DoubleSide,transparent:!0,opacity:.6})),r.model.add(r.clouds))},p=[x(o,n).catch((function(e){return null})),s?x(i,n).catch((function(e){return null})):c,a?new Promise((function(e,n){var r=document.createElement("canvas");r.width=1024,r.height=512;var o=r.getContext("2d"),i=new Image;i.crossOrigin="Anonymous",i.onerror=function(e){console.log("Error: ",e),n()},i.onload=function(){var s=document.createElement("canvas");s.width=i.width,s.height=i.height;var a=s.getContext("2d");a.drawImage(i,0,0);var c=a.getImageData(0,0,s.width,s.height),l=new Image;l.crossOrigin="Anonymous",l.addEventListener("load",(function(){var u=document.createElement("canvas");u.width=l.width,u.height=l.height;var h=u.getContext("2d");h.drawImage(l,0,0);try{for(var p=h.getImageData(0,0,u.width,u.height),d=a.createImageData(s.width,s.height),m=0,f=0;m<i.height;m++)for(var g=0;g<i.width;g++,f+=4)d.data[f+0]=c.data[f+0],d.data[f+1]=c.data[f+1],d.data[f+2]=c.data[f+2],d.data[f+3]=255-p.data[f+0];o.putImageData(d,0,0)}catch(e){console.log("Error: ",e),n()}e(new t.CanvasTexture(r))})),l.src=M+"/planets/earth/earth-clouds-trans-1024.png"},i.src=M+"/planets/earth/earth-clouds-color-1024.png"})).catch((function(e){return null})):c],!r._isAsyncLoad()){e.next=15;break}Promise.allSettled(p).then(u),e.next=20;break;case 15:return e.t0=u,e.next=18,Promise.allSettled(p);case 18:e.t1=e.sent,(0,e.t0)(e.t1);case 20:case"end":return e.stop()}}),e)}))),r.getPosition=function(){return r.model.position},r.getRadius=function(){return r.radius},r.radius=function(e){return A[e].radiusMeters}(n),r.orbit=new He(r.NAME,function(e){return Ge.includes(e)?L.DWARF_PLANET:L.PLANET}(n)),r._sceneEntityGroup.add(r.orbit.getProjectedOrbitLine()),r._toyModel=r.model,r.helper=new t.LineSegments(new t.EdgesGeometry(new t.SphereGeometry(1.2*r.radius,32)),new t.LineBasicMaterial({color:new t.Color("cyan")})),r.helper.userData.isHelper=!0,r.helper.rotateX(Math.PI/2),r.model.add(r.helper),r}a(n,e);var r=n.prototype;return r.init=function(){var e=i(h.mark((function e(){var t=this;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=i(h.mark((function e(n){return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!je.includes(t.NAME)){e.next=5;break}return e.next=3,t.loadPlanetAsObject();case 3:e.next=7;break;case 5:return e.next=7,t.loadPlanetAsTexturedSphere();case 7:console.log(t.NAME," RESOLVED",+new Date-+Qe()),t._sceneEntityGroup.add(t.model),n(t._sceneEntityGroup);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.update=function(){var e=this.orbit.getXyzMeters();this.model.position.set(e.x,e.y,e.z),this._updateModelScale(),this.model.rotateZ(.0015),this.clouds&&(this.clouds.rotateY(-1e-4),this.clouds.rotateZ(-4e-4))},n}(R),Ve=function(e){function n(n){var r;return(r=e.call(this)||this).NAME="STARFIELD",r.texture=null,r.invertColor=function(){r.texture&&(r.texture=function(e,n){void 0===n&&(n=!1);var r=e.image,o=document.createElement("canvas"),i=r.width,s=r.height;o.width=i,o.height=s;var a=o.getContext("2d");a.drawImage(r,0,0);for(var c=a.getImageData(0,0,i,s),l=0,u=0;l<s;l++)for(var h=0;h<i;h++,u+=4)c.data[u+0]=255-c.data[u+0],c.data[u+1]=255-c.data[u+1],c.data[u+2]=255-c.data[u+2],n&&(c.data[u+3]=255-c.data[u+3]);return a.putImageData(c,0,0),new t.CanvasTexture(o)}(r.texture),r.material.map=r.texture,r.material.needsUpdate=!0)},r.material=new t.MeshPhongMaterial({side:t.DoubleSide,transparent:!0,color:"black",opacity:0,shininess:0}),r.mesh=new t.Mesh(new t.SphereGeometry(n,32,32),r.material),r.mesh.rotation.y=Math.PI/2,r._sceneEntityGroup.name="STARFIELD",r}a(n,e);var r=n.prototype;return r.init=function(){var e=i(h.mark((function e(){var n=this;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=i(h.mark((function e(r){return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n._isAsyncLoad()){e.next=4;break}x(M+"/stars/galaxy_starfield6.png","star-field").then((function(e){n.texture=e,e.encoding=t.GammaEncoding,n.material.needsUpdate=!0})),e.next=10;break;case 4:return e.next=6,x(M+"/stars/galaxy_starfield6.png","star-field");case 6:n.texture=e.sent,n.material.map=n.texture,n.material.color=new t.Color,n.material.needsUpdate=!0;case 10:n._sceneEntityGroup.add(n.mesh),console.log("Starfield resolved",+new Date-+Qe()),r(n._sceneEntityGroup);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.update=function(){},n}(P),ze=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).NAME="Misc Helpers",t.update=function(){},t}return a(n,e),n.prototype.init=function(){var e=i(h.mark((function e(){var n=this;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=new t.AxesHelper(y(100));r.userData.isHelper=!0,n._sceneEntityGroup.add(r),e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n}(P),Ke=function(e){function n(t){var n;return void 0===t&&(t=.3),(n=e.call(this)||this)._defaultIntensity=t,n.NAME="Simple Light",n.setPower=function(e){n._light.intensity=e||n._defaultIntensity},n.update=function(){},n}a(n,e);var r=n.prototype;return r.init=function(){var e=i(h.mark((function e(){var n=this;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n._light=new t.AmbientLight(3355443,n._defaultIntensity),n._light.userData.isAmbientLight=!0,n._sceneEntityGroup.add(n._light),e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.setIsOn=function(e){this._light.visible=e},n}(P),Ye=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).NAME="Directional Light",t.update=function(){},t}a(n,e);var r=n.prototype;return r.init=function(){var e=i(h.mark((function e(){var n=this;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n._light=new t.DirectionalLight(16777215,1);var r=y(4);n._light.position.set(r,r,r),n._light.lookAt(0,0,0),n._light.castShadow=!0,n._sceneEntityGroup.add(n._light);var o=new t.SpotLightHelper(n._light.clone(),5);o.userData.isHelper=!0,o.visible=!0,o.userData.name="my-directional-light-helper",n._sceneEntityGroup.add(n._light),n._sceneEntityGroup.add(o),e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.setIsOn=function(e){this._light.visible=e},n}(P),Xe=function(e){for(var n=new t.DodecahedronGeometry(e,1),r=n.getAttribute("position"),o=new t.Vector3,i={},s=0;s<r.count;s++){o.fromBufferAttribute(r,s);var a=[o.x,o.y,o.z].join(",");i[a]||(i[a]={x:o.x+=Math.random()*e*.25,y:o.y+=Math.random()*e*.25,z:o.z+=Math.random()*e*.25})}for(var c=0;c<r.count;c++){o.fromBufferAttribute(r,c);var l=i[[o.x,o.y,o.z].join(",")];r.setXYZ(c,l.x,l.y,l.z)}return n},Ze=function(e){function n(n,r){var o;return void 0===r&&(r=1e4),(o=e.call(this,3e6)||this).NAME=n,o.radius=r,o.model=new t.Group,o.getPosition=function(){var e=o.orbit.getXyzMeters();return new t.Vector3(e.x,e.y,e.z)},o.getRadius=function(){return o.radius},o.orbit=new He(n,L.ASTEROID),o}a(n,e);var r=n.prototype;return r.init=function(){var e=i(h.mark((function e(){var n=this;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=i(h.mark((function e(r){var o,i;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Xe(n.radius),e.t0=t.Mesh,e.t1=o.clone(),e.t2=t.MeshPhongMaterial,e.next=7,x("https://sbn-solar-system-viewer.s3.amazonaws.com/misc/asteroid-texture-1024.jpg");case 7:e.t3=e.sent,e.t4={map:e.t3,shininess:0},e.t5=new e.t2(e.t4),i=new e.t0(e.t1,e.t5),n.model.add(i),n._toyModel=n.model,n._sceneEntityGroup.add(n.model),n._sceneEntityGroup.add(n.orbit.getProjectedOrbitLine()),r(n._sceneEntityGroup);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.update=function(){var e=this.orbit.getXyzMeters();this.model.position.set(e.x,e.y,e.z),this._updateModelScale()},n}(R),qe=function(e){function n(t,n){var r;return void 0===t&&(t=.3),void 0===n&&(n=1),(r=e.call(this)||this)._defaultIntensity=t,r._radius=n,r.NAME="Point Light",r.setPower=function(e){r._light.intensity=e||r._defaultIntensity},r.update=function(){},r}a(n,e);var r=n.prototype;return r.init=function(){var e=i(h.mark((function e(){var n=this;return h.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n._light=new t.PointLight(3355443,n._defaultIntensity);var r=new t.PointLightHelper(n._light,n._radius,new t.Color("red"));r.userData.isHelper=!0,n._sceneEntityGroup.add(n._light),n._sceneEntityGroup.add(r),e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r.setIsOn=function(e){this._light.visible=e},n}(P),We=function(e){function n(n){var r;return(r=e.call(this,n)||this).sun=new O,r.isToyScale=!0,r.tCenturiesSinceJ2000=((new Date).getTime()/1e3-946727935.816+5)/3155692597.474,r.zoomableBodies=[],r.zoomTarget=r.sun,r.isZoomingPosition=!1,r.isZoomingAngle=!1,r.zoomTraversalFraction=0,r.destinationCameraPosition=new t.Vector3,r.zoomClock=new t.Clock,r.lookDirection=new t.Vector3,r.setIsToyScale=function(e){r.isToyScale=!!e,r.sun.setIsZoomToToyScale(r.isToyScale),r.planets.forEach((function(e){return e.setIsZoomToToyScale(r.isToyScale)})),r.asteroids.forEach((function(e){return e.setIsZoomToToyScale(r.isToyScale)}))},r.toggleIsToyScale=function(){r.isToyScale=!r.isToyScale,r.setIsToyScale(r.isToyScale)},r.tryToStartZooming=function(e){var n=e.toUpperCase(),o=r.zoomableBodies.find((function(e){return e.NAME===n}));o&&(r.isZoomingPosition=!0,r.isZoomingAngle=!0,r.zoomTarget=o,r.zoomClock=new t.Clock(!0),r._controls.enabled=!0)},r.tryToStopZooming=function(){r.isZoomingAngle||r.isZoomingPosition||(r._controls.target=r.zoomTarget.getPosition(),r._controls.enabled=!0)},r.updateCamera=function(){if(r.isZoomingPosition||r.isZoomingAngle){if(r.zoomTraversalFraction=(f=r.zoomClock.getElapsedTime(),(g=Math.pow(f,6)/1e3)<0&&(g=0),g>1&&(g=1),g),r.isZoomingPosition&&(r.isZoomingPosition=(i=r._camera,s=r.zoomTraversalFraction,a=function(e){var n=e.getScale(),r=e.getRadius();if("SUN"===e.NAME){var o=e.getPosition();return new t.Vector3(o.x+3*r*n,o.y+3*r*n,o.z)}var i=e.getPosition().clone(),s=2*r*n/i.length(),a=Math.asin(s);i.applyAxisAngle(new t.Vector3(0,0,1),a);var c=(i.length()+4*r*n)/i.length();return i.multiplyScalar(c),i}(r.zoomTarget),p=new t.Vector3((c=a.x)-(h=i.position).x,(l=a.y)-h.y,(u=a.z)-h.z),m=!0,(n=d=new t.Vector3(h.x+p.x*s,h.y+p.y*s,h.z+p.z*s),o=new t.Vector3(c,l,u),new t.Vector3(o.x-n.x,o.y-n.y,o.z-n.z)).length()<.001&&(m=!1,d=new t.Vector3(c,l,u)),i.position.set(d.x,d.y,d.z),m)),r.isZoomingAngle)r.isZoomingAngle=function(e,n,r){var o=e.position,i=n.getPosition(),s=new t.Vector3(i.x-o.x,i.y-o.y,i.z-o.z),a=e.getWorldDirection(new t.Vector3);a.multiplyScalar(s.length());var c=new t.Vector3(s.x-a.x,s.y-a.y,s.z-a.z),l=new t.Vector3(e.position.x+a.x+c.x*r,e.position.y+a.y+c.y*r,e.position.z+a.z+c.z*r),u=!0;return s.angleTo(a)<.0025&&(u=!1,l=i),e.lookAt(l.x,l.y,l.z),u}(r._camera,r.zoomTarget,r.zoomTraversalFraction);else{var e=r.zoomTarget.getPosition();r._camera.lookAt(e.x,e.y,e.z)}r.tryToStopZooming()}else r._controls.update();var n,o,i,s,a,c,l,u,h,p,d,m,f,g},r._camera.getWorldDirection(r.lookDirection),r.planets=[new Be("MERCURY"),new Be("VENUS"),new Be("EARTH"),new Be("MARS"),new Be("CERES"),new Be("JUPITER"),new Be("SATURN"),new Be("URANUS"),new Be("NEPTUNE"),new Be("PLUTO"),new Be("HAUMEA"),new Be("MAKEMAKE"),new Be("ERIS")],r.asteroids=[new Ze("65P")],r.starField=new Ve(y(999)),r.zoomableBodies=[].concat(r.planets,r.asteroids,[r.sun]),r.registerSceneEntities([r.starField].concat(r.planets,[new Ye,new ze,new Ke(.4),new qe(5,A.SUN.radiusMeters)],r.asteroids,[r.sun])),r._preInitHook=function(){var e=y(4);r._initialViewingVector=new t.Vector3(0,0,e)},r._postInitHook=function(){!function(e,t){_();var n=document.createElement("div"),r=document.createElement("input");n.style.setProperty("position","absolute"),n.style.setProperty("top","10px"),n.style.setProperty("left","10px"),n.style.setProperty("width","250px"),n.style.setProperty("height","40px"),n.style.setProperty("background-color","green"),r.value="Earth",r.style.setProperty("width","100%"),r.style.setProperty("height","100%"),r.style.setProperty("font-size","20px"),r.style.setProperty("font-family","'Odibee Sans', cursive"),r.style.setProperty("font-size","20px"),r.classList.add("sbn-solar-system-viewer-input"),r.addEventListener("keypress",(function(e){"Enter"===e.key&&t(r.value)})),n.append(r),e.append(n)}(r._container,r.tryToStartZooming),function(e,t){if(!e)throw new Error("Canvas Container is Falsy!");var n=document.createElement("div");n.innerText="Toggle Toy Scale",n.style.setProperty("top","10px"),n.style.setProperty("left","50%"),n.style.setProperty("transform","translateX(-50%)"),S(n,e,t)}(r._container,r.toggleIsToyScale),function(e,t){if(!e)throw new Error("Canvas Container is Falsy!");var n=document.createElement("div");n.innerText="Toggle Helpers",n.style.setProperty("top","10px"),n.style.setProperty("right","10px"),S(n,e,t)}(r._container,r.toggleHelpersVisibility),r._controls.maxDistance=y(100),r.setIsToyScale(!0),r._camera.position.set(35426284497.8745,-725267146538.4939,-111665855099.58893)},r._destroyHook=function(){},r}return a(n,e),n}(T);e.initDate=new Date;var Je=function(t){return e.initDate=t},Qe=function(){return e.initDate};function $e(e,t){if(void 0===e&&(e="threejs-canvas-container"),t&&u(t),!document.getElementById(e))throw new Error("Can't find div of id "+e);(Ue=new We(e)).init(),new _e({epoch:2458426.5,a:.3870968969437096,e:.2056515875393916,i:7.003891682749818,om:48.30774804443502,w:29.17940253442659,ma:256.190975209273},"deg",!0)}function et(){Ue.destroy()}e.SbnSolarSystemViewer=function(e){var t=s({width:"100%",height:"100%",backgroundColor:"grey"},e),n=t.width,o=t.height,i=t.backgroundColor,a="this-id-will-never-be-duplicated-says-007";return r.useEffect((function(){return $e(a),function(){et(),console.log("Widget app removed!!!")}}),[]),r.createElement("div",{id:a,style:{width:n,height:o,backgroundColor:i}})},e.destroy=et,e.getInitDate=Qe,e.init=$e,e.setInitDate=Je,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sbnsolarsystemviewer.umd.production.min.js.map
